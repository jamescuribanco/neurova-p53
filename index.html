<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Neurova P53 - Premium</title>
  <style>
    :root { --primary: #1e40af; --accent: #3b82f6; --bg: #f8fafc; --white: #ffffff; }
    body { margin:0; font-family:'Segoe UI', system-ui, sans-serif; background: var(--bg); color: #1e293b; }
    
    /* LOGO Y HEADER */
    header { background: var(--white); border-bottom: 2px solid #e2e8f0; padding: 15px 40px; display: flex; align-items: center; justify-content: space-between; position: sticky; top:0; z-index: 1000; }
    .logo-container { display: flex; align-items: center; gap: 12px; cursor: pointer; }
    .logo-img { width: 45px; height: 45px; border-radius: 10px; background: var(--primary); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 22px; border: 2px solid #bfdbfe; }
    
    nav a { margin-left: 20px; text-decoration: none; color: #64748b; font-weight: 600; cursor: pointer; }
    .container { max-width: 1000px; margin: 30px auto; padding: 0 20px; }
    .card { background: var(--white); border-radius: 15px; padding: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 20px; border: 1px solid #e2e8f0; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
    
    /* BOTONES */
    button { cursor: pointer; border: none; border-radius: 8px; padding: 10px 18px; font-weight: 600; transition: 0.3s; }
    button:active { transform: scale(0.98); }
    .btn-pdf { background: #10b981; color: white; }
    .btn-vid { background: #06b6d4; color: white; }
    .btn-ban { background: #8b5cf6; color: white; }
    .btn-admin { background: #f59e0b; color: white; width: 100%; margin-top: 10px; }
    
    /* CREADOR DE BANQUEO */
    .pregunta-card { background: #f1f5f9; padding: 15px; border-radius: 10px; margin-bottom: 10px; border-left: 5px solid var(--accent); }
    input[type="text"], select { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #cbd5e1; border-radius: 6px; }
    .hidden { display: none; }
  </style>
</head>
<body>

<header>
  <div class="logo-container" onclick="nav('vista-cursos')">
    <div class="logo-img">N</div>
    <h1 style="font-size: 22px; margin:0;">NEUROVA <span style="color:var(--accent)">P53</span></h1>
  </div>
  <nav id="menu-nav"></nav>
</header>

<input type="file" id="archivo-pdf-input" class="hidden" accept="application/pdf">

<div id="vista-inicio" class="container">
  <div class="card" style="text-align:center;">
    <h2>Plataforma Educativa</h2>
    <button onclick="login()" style="background:var(--primary); color:white; padding:15px 30px;">Entrar con Google</button>
  </div>
</div>

<div id="vista-cursos" class="container hidden">
  <h2>Mis Cursos</h2>
  <div id="grid-cursos" class="grid"></div>
</div>

<div id="vista-semanas" class="container hidden">
  <button onclick="nav('vista-cursos')" style="background:#64748b; color:white; margin-bottom:10px;">‚Üê Volver</button>
  <h2 id="titulo-materia-actual"></h2>

  <div id="panel-admin-james" class="card hidden" style="background: #fff7ed; border: 2px solid #f97316;">
    <h3 style="margin:0 0 15px 0;">üõ† Herramientas de James (Semana <span id="num-sem-edit"></span>)</h3>
    <div class="grid">
      <button class="btn-pdf" onclick="document.getElementById('archivo-pdf-input').click()">üìÅ Subir PDF</button>
      <button class="btn-vid" onclick="adminSubirLink()">üé¨ Link Grabaci√≥n</button>
      <button class="btn-ban" onclick="abrirCreadorBanqueo()">üìù Crear Banqueo</button>
    </div>
  </div>

  <div id="lista-semanas-8"></div>
</div>

<div id="vista-creador-banco" class="container hidden">
  <div class="card">
    <h2>üìù Creador de Banqueo</h2>
    <p>Curso: <span id="ban-cur"></span> | Sem: <span id="ban-sem"></span></p>
    <div id="contenedor-preguntas"></div>
    <button onclick="agregarPreguntaNueva()" style="background:#10b981; color:white;">+ A√±adir Pregunta</button>
    <hr>
    <button onclick="guardarBanqueoFinal()" style="background:var(--primary); color:white; width:100%; padding:15px;">PUBLICAR BANQUEO</button>
    <button onclick="nav('vista-semanas')" style="background:#ef4444; color:white; margin-top:10px; width:100%;">Cancelar</button>
  </div>
</div>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc, collection } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDAmEVU8J-uk2Yg6bL5n28xbP1771cHGME",
    authDomain: "neurovap53-cdbcf.firebaseapp.com",
    projectId: "neurovap53-cdbcf",
    storageBucket: "neurovap53-cdbcf.appspot.com"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth();
  const db = getFirestore(app);
  const storage = getStorage(app);
  const provider = new GoogleAuthProvider();

  const JAMES_EMAIL = "jamesucribanco333@gmail.com";
  let cursoAct = ""; let subAct = ""; let semAct = 1;

  // TEMARIO 100% COMPLETO - NO SE OLVIDA NADA
  const TEMARIOS = {
    "Morfofisiolog√≠a 1": {
      "Fisiolog√≠a": ["Semana 1: Membrana y Potenciales", "Semana 2: Se√±ales y √ìsmosis", "Semana 3: Neurotransmisores", "Semana 4: Parcial", "Semana 5: Sangre y Hemograma", "Semana 6: Hemostasia", "Semana 7: Inmunidad", "Semana 8: Final"],
      "Histolog√≠a": ["Semana 1: Organelas", "Semana 2: Tejido √ìseo", "Semana 3: Tejido Nervioso", "Semana 4: Parcial", "Semana 5: Epitelios", "Semana 6: Conectivo", "Semana 7: Linfoides", "Semana 8: Final"]
    },
    "Morfofisiolog√≠a 2": {
      "Anatom√≠a": ["Semana 1: T√≥rax", "Semana 2: Mediastino", "Semana 3: Coraz√≥n", "Semana 4: Parcial", "Semana 5: Pulmones", "Semana 6: Columna", "Semana 7: Ri√±√≥n", "Semana 8: Final"],
      "Fisiolog√≠a": ["Semana 1: Hemodinamia", "Semana 2: EKG y Ciclo", "Semana 3: Presi√≥n Arterial", "Semana 4: Parcial", "Semana 5: Respiratorio", "Semana 6: Renal", "Semana 7: √Åcido-Base", "Semana 8: Final"],
      "Histolog√≠a y Embriolog√≠a": ["Semana 1: Embrio Coraz√≥n", "Semana 2: Histo Vascular", "Semana 3: Integraci√≥n", "Semana 4: Parcial", "Semana 5: Respiratorio", "Semana 6: Urinario", "Semana 7: Vejiga", "Semana 8: Final"]
    },
    "Bioqu√≠mica": {
      "Teor√≠a": ["S1: pH", "S2: Amino√°cidos", "S3: Enzimas", "S4: Parcial", "S5: Carbohidratos", "S6: L√≠pidos", "S7: ADN", "S8: Final"]
    },
    "Biolog√≠a Celular": {
      "Teor√≠a": ["S1: C√©lula", "S2: Mol√©culas", "S3: Membrana", "S4: Parcial", "S5: Organelas", "S6: Mitocondria", "S7: N√∫cleo", "S8: Final"]
    }
  };

  // NAVEGACI√ìN
  window.nav = (id) => {
    document.querySelectorAll('.container').forEach(c => c.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
  };

  // CARGAR CURSOS
  function renderCursos() {
    const grid = document.getElementById('grid-cursos');
    grid.innerHTML = "";
    Object.keys(TEMARIOS).forEach(curso => {
      const card = document.createElement('div');
      card.className = "card";
      card.innerHTML = `<h3>${curso}</h3><div id="subs-${curso.replace(/ /g,'')}"></div>`;
      grid.appendChild(card);
      
      Object.keys(TEMARIOS[curso]).forEach(sub => {
        const btn = document.createElement('button');
        btn.innerText = sub;
        btn.style.margin = "5px";
        btn.style.background = "var(--accent)";
        btn.style.color = "white";
        btn.onclick = () => abrirSemanas(curso, sub);
        document.getElementById(`subs-${curso.replace(/ /g,'')}`).appendChild(btn);
      });
    });
  }

  window.abrirSemanas = (curso, sub) => {
    cursoAct = curso; subAct = sub;
    document.getElementById('titulo-materia-actual').innerText = `${curso} > ${sub}`;
    renderListaSemanas();
    nav('vista-semanas');
  };

  async function renderListaSemanas() {
    const lista = document.getElementById('lista-semanas-8');
    lista.innerHTML = "";
    const temas = TEMARIOS[cursoAct][subAct];

    for (let i = 0; i < temas.length; i++) {
      const n = i + 1;
      const idDoc = `${cursoAct}_${subAct}_S${n}`;
      const snap = await getDoc(doc(db, "recursos", idDoc));
      const data = snap.exists() ? snap.data() : {};

      const div = document.createElement('div');
      div.className = "card";
      div.innerHTML = `
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <div><b>Semana ${n}:</b> ${temas[i]}</div>
          <div>
            <button class="btn-pdf" onclick="window.open('${data.pdf}')" ${!data.pdf?'disabled':''}>PDF</button>
            <button class="btn-vid" onclick="window.open('${data.video}')" ${!data.video?'disabled':''}>üé•</button>
            <button class="btn-ban" onclick="alert('Abriendo Banqueo...')" ${!data.banco?'disabled':''}>‚úçÔ∏è</button>
          </div>
        </div>
        ${auth.currentUser.email === JAMES_EMAIL ? `<button class="btn-admin" onclick="activarAdmin(${n})">‚öôÔ∏è Gestionar Semana ${n}</button>` : ''}
      `;
      lista.appendChild(div);
    }
  }

  // LOGICA JAMES (PDF, LINK Y BANQUEO)
  window.activarAdmin = (n) => {
    semAct = n;
    document.getElementById('num-sem-edit').innerText = n;
    document.getElementById('panel-admin-james').classList.remove('hidden');
    window.scrollTo(0,0);
  };

  // SUBIR PDF (ABRE TUS ARCHIVOS)
  document.getElementById('archivo-pdf-input').onchange = async (e) => {
    const file = e.target.files[0];
    if(!file) return;
    const storageRef = ref(storage, `material/${cursoAct}/${subAct}/S${semAct}_${file.name}`);
    alert("Subiendo PDF...");
    await uploadBytes(storageRef, file);
    const url = await getDownloadURL(storageRef);
    await setDoc(doc(db, "recursos", `${cursoAct}_${subAct}_S${semAct}`), { pdf: url }, { merge: true });
    alert("¬°PDF Guardado!");
    renderListaSemanas();
  };

  window.adminSubirLink = async () => {
    const link = prompt("Pega el link de la grabaci√≥n (Drive/Zoom):");
    if(link) {
      await setDoc(doc(db, "recursos", `${cursoAct}_${subAct}_S${semAct}`), { video: link }, { merge: true });
      renderListaSemanas();
    }
  };

  // SISTEMA DE CREADOR DE BANQUEO
  window.abrirCreadorBanqueo = () => {
    document.getElementById('ban-cur').innerText = cursoAct;
    document.getElementById('ban-sem').innerText = semAct;
    document.getElementById('contenedor-preguntas').innerHTML = "";
    nav('vista-creador-banco');
  };

  window.agregarPreguntaNueva = () => {
    const id = Date.now();
    const div = document.createElement('div');
    div.className = "pregunta-card";
    div.id = `preg-${id}`;
    div.innerHTML = `
      <input type="text" placeholder="Pregunta" id="q-${id}">
      <input type="text" placeholder="Opci√≥n A" id="oa-${id}">
      <input type="text" placeholder="Opci√≥n B" id="ob-${id}">
      <select id="cor-${id}"><option value="A">Correcta: A</option><option value="B">Correcta: B</option></select>
    `;
    document.getElementById('contenedor-preguntas').appendChild(div);
  };

  window.guardarBanqueoFinal = async () => {
    // Aqu√≠ se guardar√≠a en una colecci√≥n de 'ex√°menes'
    await setDoc(doc(db, "recursos", `${cursoAct}_${subAct}_S${semAct}`), { banco: "activo" }, { merge: true });
    alert("¬°Banqueo publicado!");
    nav('vista-semanas');
    renderListaSemanas();
  };

  window.login = () => signInWithPopup(auth, provider);
  onAuthStateChanged(auth, (user) => { if(user) { renderCursos(); nav('vista-cursos'); } });
</script>
</body>
</html>
