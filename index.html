<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Neurova P53 - Plataforma M칠dica</title>
  <style>
    :root { --primary: #1e40af; --accent: #3b82f6; --bg: #f8fafc; --white: #ffffff; }
    body { margin:0; font-family:'Segoe UI', system-ui, sans-serif; background: var(--bg); color: #1e293b; }
    header { background: var(--white); border-bottom: 2px solid #e2e8f0; padding: 15px 40px; display: flex; align-items: center; justify-content: space-between; position: sticky; top:0; z-index: 1000; }
    
    .logo-container { display: flex; align-items: center; gap: 12px; cursor: pointer; }
    .logo-img { width: 45px; height: 45px; border-radius: 10px; background: var(--primary); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 24px; border: 2px solid #bfdbfe; }
    
    nav a { margin-left: 20px; text-decoration: none; color: #64748b; font-weight: 600; cursor: pointer; }
    .container { max-width: 1100px; margin: 30px auto; padding: 0 20px; }
    .card { background: var(--white); border-radius: 15px; padding: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 20px; border: 1px solid #e2e8f0; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
    
    button { background: var(--primary); color: white; border: none; padding: 10px 18px; border-radius: 8px; cursor: pointer; font-weight: 600; }
    .btn-admin { background: #f59e0b; margin-top: 10px; }
    .hidden { display: none; }
    
    .semana-card { border-left: 6px solid var(--accent); padding: 15px; margin-bottom: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    .tema-titulo { font-weight: bold; display: block; color: #1e3a8a; }
    .tema-detalle { font-size: 0.9em; color: #64748b; font-style: italic; }
  </style>
</head>
<body>
<header>
  <div class="logo-container" onclick="nav('inicio')">
    <div class="logo-img">N</div>
    <h1 style="font-size: 22px; margin:0; letter-spacing:-1px;">NEUROVA <span style="color:var(--accent)">P53</span></h1>
  </div>
  <nav>
    <a onclick="nav('inicio')">Inicio</a>
    <a onclick="nav('cursos-container')">Mis Cursos</a>
    <a id="link-admin" class="hidden" onclick="nav('admin-respuestas')">Panel James</a>
  </nav>
</header>

<input type="file" id="subir-pdf-input" class="hidden" accept="application/pdf">

<div id="inicio" class="container">
  <div class="card" style="text-align:center; padding: 50px;">
    <h2>Plataforma Educativa de Medicina</h2>
    <div id="login-section">
      <button onclick="login()" style="padding:15px 40px; font-size:18px;">Ingresar con Google</button>
    </div>
    <div id="user-section" class="hidden">
      <h3 id="user-greeting"></h3>
      <button onclick="logout()" style="background:#ef4444;">Cerrar Sesi칩n</button>
    </div>
  </div>
</div>

<div id="cursos-container" class="container hidden">
  <div id="grid-cursos" class="grid"></div>
</div>

<div id="submaterias-container" class="container hidden">
  <h2 id="titulo-curso"></h2>
  <div id="grid-submaterias" class="grid"></div>
</div>

<div id="semanas-container" class="container hidden">
  <h2 id="titulo-submateria"></h2>
  <div id="panel-editor" class="card hidden" style="background: #fff7ed; border: 2px dashed #f97316;">
    <h4>游 Editor para Semana <span id="num-sem-edit"></span></h4>
    <div style="display:flex; gap:10px; flex-wrap:wrap;">
      <button onclick="document.getElementById('subir-pdf-input').click()">游늬 Cargar PDF</button>
      <button onclick="abrirModalLink()" style="background:#06b6d4;">游꿟 Link Grabaci칩n</button>
      <button onclick="irCrearBanqueo()" style="background:#8b5cf6;">九꽲잺 Crear Banqueo</button>
    </div>
  </div>
  <div id="lista-semanas"></div>
</div>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDAmEVU8J-uk2Yg6bL5n28xbP1771cHGME",
    authDomain: "neurovap53-cdbcf.firebaseapp.com",
    projectId: "neurovap53-cdbcf",
    storageBucket: "neurovap53-cdbcf.appspot.com"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth();
  const db = getFirestore(app);
  const storage = getStorage(app);
  const provider = new GoogleAuthProvider();

  const DB_MASTER = {
    "Morfofisiolog칤a 1": {
      "Fisiolog칤a": [
        "Semana 1: Membrana celular, receptores y potenciales.",
        "Semana 2: Transmisi칩n de se침ales y 칩smosis.",
        "Semana 3: Neurotransmisores y contracci칩n muscular.",
        "Semana 4: Metabolismo 칩seo y Examen Parcial.",
        "Semana 5: Sangre, hematopoyesis y hemograma.",
        "Semana 6: Fisiolog칤a eritrocitaria y hemostasia.",
        "Semana 7: Sistema inmunol칩gico y respuesta innata.",
        "Semana 8: Respuesta inflamatoria y Examen Final."
      ],
      "Histolog칤a": [
        "Semana 1: Procesamiento histol칩gico y organelas.",
        "Semana 2: Tejido 칩seo y osificaci칩n.",
        "Semana 3: Tejido muscular y nervioso.",
        "Semana 4: Sistema vascular y Examen Parcial.",
        "Semana 5: Epitelios de revestimiento.",
        "Semana 6: Tejido conectivo y sangu칤neo.",
        "Semana 7: 칍rganos linfoides.",
        "Semana 8: Sistema tegumentario y Examen Final."
      ]
    },
    "Morfofisiolog칤a 2": {
      "Anatom칤a": [
        "Semana 1: Pared tor치cica y regi칩n mamaria.",
        "Semana 2: Mediastino superior y anterior.",
        "Semana 3: Morfolog칤a interna cardiaca.",
        "Semana 4: Mediastino posterior y Examen Parcial.",
        "Semana 5: Pulmones y segmentaci칩n.",
        "Semana 6: Columna vertebral dorsal.",
        "Semana 7: Ri침칩n y v칤as urinarias.",
        "Semana 8: Radioanatom칤a renal y Examen Final."
      ],
      "Fisiolog칤a": [
        "Semana 1: Hemodinamia y electrofisiolog칤a.",
        "Semana 2: Electrocardiograma y ciclo cardiaco.",
        "Semana 3: Presi칩n arterial y gasto cardiaco.",
        "Semana 4: Mec치nica respiratoria y Examen Parcial.",
        "Semana 5: Intercambio y transporte de gases.",
        "Semana 6: Filtraci칩n glomerular y secreci칩n.",
        "Semana 7: Equilibrio 치cido-base.",
        "Semana 8: Fisiolog칤a de altura y Examen Final."
      ],
      "Histolog칤a y Embriolog칤a": [
        "Semana 1: Embriolog칤a e histolog칤a cardiaca.",
        "Semana 2: Histolog칤a vascular.",
        "Semana 3: Integraci칩n embrio-histo cardiaca.",
        "Semana 4: Patolog칤a vascular y Examen Parcial.",
        "Semana 5: Embrio-histo del aparato respiratorio.",
        "Semana 6: Embrio-histo renal.",
        "Semana 7: Ur칠ter, vejiga y uretra.",
        "Semana 8: Histopatolog칤a renal y Examen Final."
      ]
    },
    "Bioqu칤mica": {
      "Teor칤a": ["S1: Agua y pH", "S2: Amino치cidos", "S3: Enzimas", "S4: Parcial", "S5: Carbohidratos", "S6: L칤pidos", "S7: ADN", "S8: Final"],
      "Laboratorio": ["S1: Bioseguridad", "S2: Espectroscop칤a", "S3: Amino치cidos", "S4: Parcial", "S5: Glucosa", "S6: Perfil Lip칤dico", "S7: Orina", "S8: Final"]
    },
    "Biolog칤a Celular": {
      "Teor칤a": ["S1: C칠lula", "S2: Mol칠culas", "S3: Membrana", "S4: Parcial", "S5: Organelas", "S6: Mitocondria", "S7: N칰cleo", "S8: Final"],
      "Laboratorio": ["S1: Microscopio", "S2: C칠lula", "S3: 칍smosis", "S4: Parcial", "S5: Mitosis", "S6: Meiosis", "S7: ADN", "S8: Final"]
    }
  };
  let cursoSel = ""; let subSel = ""; let semSel = 1;
  const JAMES_EMAIL = "jamesucribanco333@gmail.com";

  window.nav = (id) => {
    ['inicio', 'cursos-container', 'submaterias-container', 'semanas-container'].forEach(v => document.getElementById(v).classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
  };

  function cargarCursos() {
    const box = document.getElementById('grid-cursos');
    box.innerHTML = "";
    Object.keys(DB_MASTER).forEach(c => {
      box.innerHTML += `<div class="card"><h3>${c}</h3><button onclick="abrirSub('${c}')">Explorar</button></div>`;
    });
  }

  window.abrirSub = (c) => {
    cursoSel = c; document.getElementById('titulo-curso').innerText = c;
    const box = document.getElementById('grid-submaterias');
    box.innerHTML = "";
    Object.keys(DB_MASTER[c]).forEach(s => {
      box.innerHTML += `<div class="card" style="border-top:5px solid var(--primary)"><h3>${s}</h3><button onclick="abrirSemanas('${s}')">Ver 8 Semanas</button></div>`;
    });
    nav('submaterias-container');
  };

  window.abrirSemanas = (s) => {
    subSel = s; document.getElementById('titulo-submateria').innerText = `${cursoSel} > ${subSel}`;
    const box = document.getElementById('lista-semanas');
    box.innerHTML = "";
    nav('semanas-container');

    DB_MASTER[cursoSel][subSel].forEach((tema, i) => {
      const n = i+1;
      const div = document.createElement('div');
      div.className = "semana-card";
      div.innerHTML = `
        <span class="tema-titulo">SEMANA ${n}</span>
        <span class="tema-detalle">${tema}</span>
        <div id="links-s${n}" style="margin-top:10px; display:flex; gap:8px;"></div>
        ${auth.currentUser.email === JAMES_EMAIL ? `<button class="btn-admin" onclick="editarSem(${n})">丘뙖잺 Editar S${n}</button>` : ''}
      `;
      box.appendChild(div);
      getRecursos(n);
    });
  };

  window.editarSem = (n) => {
    semSel = n;
    document.getElementById('num-sem-edit').innerText = n;
    document.getElementById('panel-editor').classList.remove('hidden');
    window.scrollTo(0,0);
  };

  // SUBIR PDF REAL A STORAGE
  document.getElementById('subir-pdf-input').onchange = async (e) => {
    const file = e.target.files[0];
    if(!file) return;
    const refPath = `material/${cursoSel}/${subSel}/S${semSel}_${file.name}`;
    const storageRef = ref(storage, refPath);
    alert("Subiendo archivo...");
    await uploadBytes(storageRef, file);
    const url = await getDownloadURL(storageRef);
    await setDoc(doc(db, "recursos", `${cursoSel}_${subSel}_S${semSel}`), { pdf: url }, { merge: true });
    alert("PDF listo!");
    abrirSemanas(subSel);
  };
  window.abrirModalLink = async () => {
    const url = prompt("Pega el link de la grabaci칩n (Drive/Zoom):");
    if(url) {
      await setDoc(doc(db, "recursos", `${cursoSel}_${subSel}_S${semSel}`), { video: url }, { merge: true });
      alert("Link guardado");
      abrirSemanas(subSel);
    }
  };

  async function getRecursos(n) {
    const snap = await getDoc(doc(db, "recursos", `${cursoSel}_${subSel}_S${n}`));
    const d = snap.exists() ? snap.data() : {};
    const target = document.getElementById(`links-s${n}`);
    target.innerHTML = `
      <button onclick="window.open('${d.pdf}')" ${!d.pdf ? 'disabled' : ''} style="background:#10b981; font-size:12px;">游늯 PDF</button>
      <button onclick="window.open('${d.video}')" ${!d.video ? 'disabled' : ''} style="background:#06b6d4; font-size:12px;">游꿟 Video</button>
      <button onclick="verBanqueo(${n})" ${!d.banco ? 'disabled' : ''} style="background:#8b5cf6; font-size:12px;">九꽲잺 Banqueo</button>
    `;
  }

  // L칩gica de Login
  window.login = () => signInWithPopup(auth, provider);
  window.logout = () => signOut(auth);

  onAuthStateChanged(auth, (user) => {
    if (user) {
      document.getElementById('login-section').classList.add('hidden');
      document.getElementById('user-section').classList.remove('hidden');
      document.getElementById('user-greeting').innerText = `Hola, ${user.displayName}`;
      if(user.email === JAMES_EMAIL) document.getElementById('link-admin').classList.remove('hidden');
      cargarCursos();
      nav('cursos-container');
    } else {
      document.getElementById('login-section').classList.remove('hidden');
      document.getElementById('user-section').classList.add('hidden');
      nav('inicio');
    }
  });
</script>
</body>
</html>
