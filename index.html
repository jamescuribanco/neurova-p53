<!doctype html>
<html lang="es" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Academia Neurova p53</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&amp;family=Space+Grotesk:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    
    * {
      font-family: 'Outfit', sans-serif;
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #0a1929 0%, #1e3a5f 50%, #0d47a1 100%);
    }
    
    .glass-card {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(59, 130, 246, 0.2);
    }
    
    .neon-glow {
      box-shadow: 0 0 40px rgba(56, 189, 248, 0.4), 0 0 80px rgba(59, 130, 246, 0.2);
    }
    
    .course-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 20px 40px rgba(14, 165, 233, 0.3);
    }
    
    .course-card {
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%);
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
      transform: scale(1.05);
      box-shadow: 0 10px 30px rgba(14, 165, 233, 0.5);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    }
    
    .btn-secondary:hover {
      transform: scale(1.05);
      box-shadow: 0 10px 30px rgba(59, 130, 246, 0.5);
    }
    
    .week-card {
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid rgba(255, 255, 255, 0.05);
      transition: all 0.3s ease;
    }
    
    .week-card:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(14, 165, 233, 0.4);
    }
    
    .social-btn {
      transition: all 0.3s ease;
    }
    
    .social-btn:hover {
      transform: translateY(-3px);
    }
    
    .animate-float {
      animation: float 6s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-20px); }
    }
    
    .animate-pulse-slow {
      animation: pulse-slow 3s ease-in-out infinite;
    }
    
    @keyframes pulse-slow {
      0%, 100% { opacity: 0.6; }
      50% { opacity: 1; }
    }
    
    .scrollbar-thin::-webkit-scrollbar {
      width: 6px;
    }
    
    .scrollbar-thin::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
    }
    
    .scrollbar-thin::-webkit-scrollbar-thumb {
      background: rgba(14, 165, 233, 0.6);
      border-radius: 3px;
    }
    
    .tab-btn.active {
      background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%);
      color: white;
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .modal.show {
      display: flex;
    }
    
    .novi-chat {
      position: fixed;
      bottom: 24px;
      right: 24px;
      z-index: 999;
    }
    
    .novi-bubble {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: linear-gradient(135deg, #06b6d4 0%, #0ea5e9 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 8px 32px rgba(14, 165, 233, 0.4);
      transition: all 0.3s ease;
    }
    
    .novi-bubble:hover {
      transform: scale(1.1);
      box-shadow: 0 12px 40px rgba(14, 165, 233, 0.6);
    }
    
    .novi-window {
      display: none;
      position: fixed;
      bottom: 110px;
      right: 24px;
      width: 380px;
      height: 500px;
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(14, 165, 233, 0.3);
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      flex-direction: column;
      overflow: hidden;
    }
    
    .novi-window.show {
      display: flex;
    }
    
    .loading-spinner {
      border: 3px solid rgba(14, 165, 233, 0.3);
      border-top: 3px solid #0ea5e9;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .flashcard-wrapper {
      width: 100%;
      min-height: 300px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    
    .flashcard {
      width: 100%;
      max-width: 600px;
      min-height: 300px;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(14, 165, 233, 0.3);
      border-radius: 20px;
      padding: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .flashcard.flipped {
      background: rgba(14, 165, 233, 0.1);
      border-color: rgba(14, 165, 233, 0.5);
    }
    
    .question-option:hover {
      transform: translateX(5px);
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full gradient-bg text-white overflow-auto scrollbar-thin"><!-- Login Page -->
  <div id="loginPage" class="min-h-full flex flex-col"><!-- Decorative Elements -->
   <div class="fixed inset-0 overflow-hidden pointer-events-none">
    <div class="absolute top-20 left-10 w-72 h-72 bg-cyan-400/10 rounded-full blur-3xl animate-float"></div>
    <div class="absolute bottom-20 right-10 w-96 h-96 bg-blue-400/10 rounded-full blur-3xl animate-float" style="animation-delay: -3s;"></div>
    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] bg-sky-500/5 rounded-full blur-3xl"></div>
   </div><!-- Header -->
   <header class="relative z-10 p-6">
    <div class="max-w-7xl mx-auto flex justify-between items-center">
     <div class="flex items-center gap-3">
      <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-cyan-400 to-blue-500 flex items-center justify-center neon-glow relative overflow-hidden cursor-pointer" onclick="showLogoMenu(event)"><!-- Foca con bata -->
       <svg class="w-10 h-10" viewbox="0 0 64 64" fill="none"><ellipse cx="32" cy="36" rx="16" ry="14" fill="#6B7280" /> <circle cx="32" cy="20" r="10" fill="#6B7280" /> <path d="M20 30 Q32 28 44 30 L44 45 Q32 47 20 45 Z" fill="white" opacity="0.9" /> <line x1="32" y1="28" x2="32" y2="46" stroke="#E5E7EB" stroke-width="1" /> <circle cx="32" cy="32" r="1" fill="#93C5FD" /> <circle cx="32" cy="36" r="1" fill="#93C5FD" /> <circle cx="32" cy="40" r="1" fill="#93C5FD" /> <circle cx="28" cy="18" r="1.5" fill="#1F2937" /> <circle cx="36" cy="18" r="1.5" fill="#1F2937" /> <line x1="22" y1="22" x2="18" y2="21" stroke="#4B5563" stroke-width="0.5" /> <line x1="22" y1="23" x2="18" y2="24" stroke="#4B5563" stroke-width="0.5" /> <line x1="42" y1="22" x2="46" y2="21" stroke="#4B5563" stroke-width="0.5" /> <line x1="42" y1="23" x2="46" y2="24" stroke="#4B5563" stroke-width="0.5" /> <circle cx="32" cy="22" r="1" fill="#374151" /> <ellipse cx="18" cy="38" rx="4" ry="6" fill="#6B7280" transform="rotate(-30 18 38)" /> <ellipse cx="46" cy="38" rx="4" ry="6" fill="#6B7280" transform="rotate(30 46 38)" />
       </svg>
      </div><!-- Logo Menu (outside the logo div) -->
      <div id="logoMenu" class="hidden absolute top-20 left-6 mt-2 glass-card rounded-xl p-2 shadow-xl z-50 min-w-[150px]" onclick="event.stopPropagation()"><button onclick="viewLogo()" class="w-full text-left px-3 py-2 rounded-lg hover:bg-white/10 text-sm flex items-center gap-2">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
        </svg> Ver Logo </button> <button id="changeLogoBtn" onclick="openChangeLogoModal()" class="w-full text-left px-3 py-2 rounded-lg hover:bg-white/10 text-sm flex items-center gap-2">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg> Cambiar Logo </button>
      </div>
      <div>
       <h1 id="headerTitle" class="text-2xl font-bold bg-gradient-to-r from-cyan-400 via-blue-400 to-cyan-300 bg-clip-text text-transparent">Neurova p53</h1>
       <p class="text-xs text-cyan-300/70">Academia de Ciencias M√©dicas</p>
      </div>
     </div>
    </div>
   </header><!-- Main Content -->
   <main class="relative z-10 flex-1 flex items-center justify-center px-6 py-12">
    <div class="w-full max-w-md">
     <div class="glass-card rounded-3xl p-8 neon-glow"><!-- Welcome Icon -->
      <div class="flex justify-center mb-6">
       <div class="w-24 h-24 rounded-2xl bg-gradient-to-br from-cyan-500/20 to-blue-500/20 flex items-center justify-center border border-cyan-500/30">
        <svg class="w-12 h-12 text-cyan-400 animate-pulse-slow" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
        </svg>
       </div>
      </div>
      <h2 id="welcomeTitle" class="text-3xl font-bold text-center mb-2">¬°Bienvenido!</h2>
      <p id="welcomeSubtitle" class="text-cyan-200/70 text-center mb-8">Tu plataforma de aprendizaje en ciencias m√©dicas</p><!-- Login Options -->
      <div class="space-y-3 mb-6">
       <div id="googleSignInButton" class="w-full flex items-center justify-center"></div><!-- Test Mode Login Buttons -->
       <div id="testModeButtons" class="hidden space-y-2">
        <p class="text-xs text-center text-cyan-300/60 mb-3">üß™ Modo de Prueba - Selecciona un rol:</p><button onclick="testLogin('admin')" class="w-full flex items-center justify-center gap-3 px-4 py-3 rounded-xl bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 transition-all font-medium">
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
         </svg> Iniciar como Administrador </button> <button onclick="testLogin('student')" class="w-full flex items-center justify-center gap-3 px-4 py-3 rounded-xl bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 transition-all font-medium">
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
         </svg> Iniciar como Estudiante (Prueba) </button>
       </div>
      </div><!-- Divider -->
      <div class="flex items-center gap-4 mb-6">
       <div class="flex-1 h-px bg-gradient-to-r from-transparent via-cyan-500/30 to-transparent"></div><span class="text-cyan-300/60 text-sm">Cont√°ctanos</span>
       <div class="flex-1 h-px bg-gradient-to-r from-transparent via-cyan-500/30 to-transparent"></div>
      </div><!-- Social Links -->
      <div class="flex justify-center gap-4"><a href="https://wa.me/51977666427" target="_blank" rel="noopener noreferrer" class="social-btn w-14 h-14 rounded-xl bg-green-500/10 border border-green-500/30 flex items-center justify-center hover:bg-green-500/20">
        <svg class="w-7 h-7 text-green-400" fill="currentColor" viewbox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z" />
        </svg></a> <a href="https://instagram.com/neurovap53" target="_blank" rel="noopener noreferrer" class="social-btn w-14 h-14 rounded-xl bg-pink-500/10 border border-pink-500/30 flex items-center justify-center hover:bg-pink-500/20">
        <svg class="w-7 h-7 text-pink-400" fill="currentColor" viewbox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z" />
        </svg></a> <a href="https://tiktok.com/@ilovetiii" target="_blank" rel="noopener noreferrer" class="social-btn w-14 h-14 rounded-xl bg-white/10 border border-white/30 flex items-center justify-center hover:bg-white/20">
        <svg class="w-7 h-7 text-white" fill="currentColor" viewbox="0 0 24 24"><path d="M19.59 6.69a4.83 4.83 0 01-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 01-5.2 1.74 2.89 2.89 0 012.31-4.64 2.93 2.93 0 01.88.13V9.4a6.84 6.84 0 00-1-.05A6.33 6.33 0 005 20.1a6.34 6.34 0 0010.86-4.43v-7a8.16 8.16 0 004.77 1.52v-3.4a4.85 4.85 0 01-1-.1z" />
        </svg></a>
      </div>
     </div><!-- Footer Info -->
     <p class="text-center text-cyan-300/40 text-sm mt-6">¬© 2024 Neurova p53 - Todos los derechos reservados</p>
    </div>
   </main>
  </div><!-- Dashboard Page -->
  <div id="dashboardPage" class="hidden min-h-full flex flex-col"><!-- Header -->
   <header class="relative z-10 p-6 border-b border-white/5">
    <div class="max-w-7xl mx-auto flex justify-between items-center">
     <div class="flex items-center gap-3 cursor-pointer" onclick="showPage('dashboard')">
      <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-cyan-400 to-blue-500 flex items-center justify-center relative overflow-hidden">
       <svg class="w-8 h-8" viewbox="0 0 64 64" fill="none"><ellipse cx="32" cy="36" rx="16" ry="14" fill="#6B7280" /> <circle cx="32" cy="20" r="10" fill="#6B7280" /> <path d="M20 30 Q32 28 44 30 L44 45 Q32 47 20 45 Z" fill="white" opacity="0.9" /> <line x1="32" y1="28" x2="32" y2="46" stroke="#E5E7EB" stroke-width="1" /> <circle cx="32" cy="32" r="1" fill="#93C5FD" /> <circle cx="32" cy="36" r="1" fill="#93C5FD" /> <circle cx="32" cy="40" r="1" fill="#93C5FD" /> <circle cx="28" cy="18" r="1.5" fill="#1F2937" /> <circle cx="36" cy="18" r="1.5" fill="#1F2937" /> <line x1="22" y1="22" x2="18" y2="21" stroke="#4B5563" stroke-width="0.5" /> <line x1="22" y1="23" x2="18" y2="24" stroke="#4B5563" stroke-width="0.5" /> <line x1="42" y1="22" x2="46" y2="21" stroke="#4B5563" stroke-width="0.5" /> <line x1="42" y1="23" x2="46" y2="24" stroke="#4B5563" stroke-width="0.5" /> <circle cx="32" cy="22" r="1" fill="#374151" /> <ellipse cx="18" cy="38" rx="4" ry="6" fill="#6B7280" transform="rotate(-30 18 38)" /> <ellipse cx="46" cy="38" rx="4" ry="6" fill="#6B7280" transform="rotate(30 46 38)" />
       </svg>
      </div>
      <h1 id="dashboardHeaderTitle" class="text-xl font-bold bg-gradient-to-r from-cyan-400 to-blue-400 bg-clip-text text-transparent">Neurova p53</h1>
     </div>
     <div class="flex items-center gap-4"><button id="adminScheduleBtn" onclick="showSchedulePage()" class="hidden px-4 py-2 rounded-lg bg-amber-500/10 border border-amber-500/30 text-amber-400 text-sm hover:bg-amber-500/20 transition-all flex items-center gap-2">
       <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
       </svg> Horarios </button> <button id="adminStudentsBtn" onclick="showStudentsPage()" class="hidden px-4 py-2 rounded-lg bg-cyan-500/10 border border-cyan-500/30 text-cyan-400 text-sm hover:bg-cyan-500/20 transition-all flex items-center gap-2">
       <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
       </svg> Alumnos </button>
      <div id="userInfo" class="flex items-center gap-3"><span id="userName" class="text-sm text-cyan-200/80"></span>
       <div id="userAvatar" class="w-10 h-10 rounded-full bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center text-sm font-bold"></div>
      </div><button onclick="handleSignOut()" class="px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm hover:bg-white/10 transition-all"> Cerrar sesi√≥n </button>
     </div>
    </div>
   </header><!-- Dashboard Content -->
   <main class="flex-1 p-6 overflow-auto">
    <div class="max-w-7xl mx-auto">
     <div class="mb-8">
      <h2 class="text-3xl font-bold mb-2">Mis Cursos</h2>
      <p class="text-cyan-200/70">Selecciona un curso para comenzar a estudiar</p>
     </div><!-- Courses Grid -->
     <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><!-- Recursos de Aprendizaje -->
      <div class="course-card glass-card rounded-2xl overflow-hidden">
       <div class="h-40 bg-gradient-to-br from-indigo-500/20 to-purple-500/20 flex items-center justify-center relative overflow-hidden">
        <div class="absolute inset-0 opacity-20">
         <svg class="w-full h-full" viewbox="0 0 100 100" fill="none"><circle cx="30" cy="30" r="15" stroke="currentColor" stroke-width="2" class="text-indigo-300" /> <circle cx="70" cy="30" r="15" stroke="currentColor" stroke-width="2" class="text-indigo-300" /> <circle cx="30" cy="70" r="15" stroke="currentColor" stroke-width="2" class="text-indigo-300" /> <circle cx="70" cy="70" r="15" stroke="currentColor" stroke-width="2" class="text-indigo-300" />
         </svg>
        </div>
        <div class="relative z-10 w-20 h-20 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center"><!-- √çcono de Recursos -->
         <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /> <circle cx="12" cy="12" r="2" fill="currentColor" /> <circle cx="7" cy="10" r="1.5" fill="currentColor" /> <circle cx="17" cy="10" r="1.5" fill="currentColor" />
         </svg>
        </div>
       </div>
       <div class="p-6">
        <h3 class="text-xl font-bold mb-2">Recursos de Aprendizaje</h3>
        <p class="text-cyan-200/60 text-sm mb-4">Herramientas para maximizar tu aprendizaje</p>
        <div class="flex items-center justify-between"><span class="text-xs text-cyan-300/50">Gratis para todos</span> <button onclick="showCourse('recursos')" class="btn-primary px-4 py-2 rounded-lg text-sm font-medium"> Explorar ‚Üí </button>
        </div>
       </div>
      </div><!-- Anatom√≠a General -->
      <div class="course-card glass-card rounded-2xl overflow-hidden">
       <div class="h-40 bg-gradient-to-br from-rose-500/20 to-orange-500/20 flex items-center justify-center relative overflow-hidden">
        <div class="absolute inset-0 opacity-20">
         <svg class="w-full h-full" viewbox="0 0 100 100" fill="none"><path d="M50 10 L50 90 M30 30 Q50 50 70 30 M30 50 L70 50 M35 70 L50 90 L65 70" stroke="currentColor" stroke-width="2" class="text-rose-300" />
         </svg>
        </div>
        <div class="relative z-10 w-20 h-20 rounded-2xl bg-gradient-to-br from-rose-500 to-orange-500 flex items-center justify-center"><!-- Esqueleto Humano -->
         <svg class="w-12 h-12 text-white" fill="currentColor" viewbox="0 0 24 24"><circle cx="12" cy="4" r="2" /> <path d="M10.5 6c-.28 0-.5.22-.5.5v3c0 .28.22.5.5.5h3c.28 0 .5-.22.5-.5v-3c0-.28-.22-.5-.5-.5h-3z" /> <rect x="11" y="10" width="2" height="8" rx="0.5" /> <path d="M9 11l-1.5 3.5 1 5.5h1.5l.5-4 .5 4h1.5l1-5.5L11 11H9z" /> <line x1="10" y1="7" x2="8" y2="10" stroke="currentColor" stroke-width="1.5" fill="none" /> <line x1="14" y1="7" x2="16" y2="10" stroke="currentColor" stroke-width="1.5" fill="none" /> <line x1="11" y1="18" x2="9" y2="23" stroke="currentColor" stroke-width="1.5" fill="none" /> <line x1="13" y1="18" x2="15" y2="23" stroke="currentColor" stroke-width="1.5" fill="none" />
         </svg>
        </div>
       </div>
       <div class="p-6">
        <h3 class="text-xl font-bold mb-2">Anatom√≠a General</h3>
        <p class="text-cyan-200/60 text-sm mb-4">Sistema musculoesquel√©tico, regiones corporales y estructuras anat√≥micas</p>
        <div class="flex items-center justify-between"><span class="text-xs text-cyan-300/50">8 semanas</span> <button onclick="showCourse('anatomia')" class="btn-primary px-4 py-2 rounded-lg text-sm font-medium"> Ver curso ‚Üí </button>
        </div>
       </div>
      </div><!-- Morfofisiolog√≠a 1 -->
      <div class="course-card glass-card rounded-2xl overflow-hidden">
       <div class="h-40 bg-gradient-to-br from-blue-500/20 to-cyan-500/20 flex items-center justify-center relative overflow-hidden">
        <div class="absolute inset-0 opacity-20">
         <svg class="w-full h-full" viewbox="0 0 100 100" fill="none"><circle cx="50" cy="50" r="30" stroke="currentColor" stroke-width="2" class="text-blue-300" /> <circle cx="50" cy="50" r="15" stroke="currentColor" stroke-width="2" class="text-blue-300" /> <circle cx="50" cy="50" r="5" fill="currentColor" class="text-blue-300" />
         </svg>
        </div>
        <div class="relative z-10 w-20 h-20 rounded-2xl bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center"><!-- Membrana Celular / Tejido -->
         <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><circle cx="12" cy="12" r="9" stroke-width="2" /> <circle cx="12" cy="8" r="2" fill="currentColor" /> <circle cx="8" cy="14" r="1.5" fill="currentColor" /> <circle cx="16" cy="14" r="1.5" fill="currentColor" /> <ellipse cx="10" cy="10" rx="1" ry="2" fill="currentColor" opacity="0.6" /> <ellipse cx="14" cy="10" rx="1" ry="2" fill="currentColor" opacity="0.6" /> <path d="M7 12c0-1 1-2 2-2m8 2c0-1-1-2-2-2" stroke-width="1.5" stroke-linecap="round" />
         </svg>
        </div>
       </div>
       <div class="p-6">
        <h3 class="text-xl font-bold mb-2">Morfofisiolog√≠a 1</h3>
        <p class="text-cyan-200/60 text-sm mb-4">Fisiolog√≠a celular, tejidos y sistemas de integraci√≥n corporal</p>
        <div class="flex items-center justify-between"><span class="text-xs text-cyan-300/50">8 semanas</span> <button onclick="showCourse('morfo1')" class="btn-primary px-4 py-2 rounded-lg text-sm font-medium"> Ver curso ‚Üí </button>
        </div>
       </div>
      </div><!-- Morfofisiolog√≠a 2 -->
      <div class="course-card glass-card rounded-2xl overflow-hidden">
       <div class="h-40 bg-gradient-to-br from-emerald-500/20 to-teal-500/20 flex items-center justify-center relative overflow-hidden">
        <div class="absolute inset-0 opacity-20">
         <svg class="w-full h-full" viewbox="0 0 100 100" fill="none"><path d="M30 50 Q50 30 70 50 Q50 70 30 50" stroke="currentColor" stroke-width="2" class="text-emerald-300" /> <path d="M40 50 Q50 40 60 50 Q50 60 40 50" fill="currentColor" class="text-emerald-300" />
         </svg>
        </div>
        <div class="relative z-10 w-20 h-20 rounded-2xl bg-gradient-to-br from-emerald-500 to-teal-500 flex items-center justify-center"><!-- Coraz√≥n y Pulmones -->
         <svg class="w-12 h-12 text-white" fill="currentColor" viewbox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" /> <ellipse cx="8" cy="10" rx="2" ry="3" opacity="0.3" fill="white" /> <ellipse cx="16" cy="10" rx="2" ry="3" opacity="0.3" fill="white" />
         </svg>
        </div>
       </div>
       <div class="p-6">
        <h3 class="text-xl font-bold mb-2">Morfofisiolog√≠a 2</h3>
        <p class="text-cyan-200/60 text-sm mb-4">Sistemas cardiovascular, respiratorio, renal y digestivo</p>
        <div class="flex items-center justify-between"><span class="text-xs text-cyan-300/50">8 semanas</span> <button onclick="showCourse('morfo2')" class="btn-primary px-4 py-2 rounded-lg text-sm font-medium"> Ver curso ‚Üí </button>
        </div>
       </div>
      </div><!-- Biolog√≠a Celular y Molecular -->
      <div class="course-card glass-card rounded-2xl overflow-hidden">
       <div class="h-40 bg-gradient-to-br from-violet-500/20 to-purple-500/20 flex items-center justify-center relative overflow-hidden">
        <div class="absolute inset-0 opacity-20">
         <svg class="w-full h-full" viewbox="0 0 100 100" fill="none"><path d="M30 30 Q50 50 30 70 M70 30 Q50 50 70 70 M30 50 L70 50" stroke="currentColor" stroke-width="2" class="text-violet-300" />
         </svg>
        </div>
        <div class="relative z-10 w-20 h-20 rounded-2xl bg-gradient-to-br from-violet-500 to-purple-500 flex items-center justify-center"><!-- C√©lulas -->
         <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><circle cx="9" cy="9" r="6" stroke-width="1.5" /> <circle cx="9" cy="9" r="2" fill="currentColor" /> <circle cx="16" cy="16" r="5" stroke-width="1.5" /> <circle cx="16" cy="16" r="1.5" fill="currentColor" /> <ellipse cx="7" cy="8" rx="1.5" ry="2.5" opacity="0.4" fill="currentColor" /> <ellipse cx="14.5" cy="15" rx="1" ry="2" opacity="0.4" fill="currentColor" />
         </svg>
        </div>
       </div>
       <div class="p-6">
        <h3 class="text-xl font-bold mb-2">Biolog√≠a Celular y Molecular</h3>
        <p class="text-cyan-200/60 text-sm mb-4">Estructura celular, gen√©tica molecular y procesos bioqu√≠micos</p>
        <div class="flex items-center justify-between"><span class="text-xs text-cyan-300/50">8 semanas</span> <button onclick="showCourse('biologia')" class="btn-primary px-4 py-2 rounded-lg text-sm font-medium"> Ver curso ‚Üí </button>
        </div>
       </div>
      </div><!-- Bioqu√≠mica -->
      <div class="course-card glass-card rounded-2xl overflow-hidden">
       <div class="h-40 bg-gradient-to-br from-amber-500/20 to-yellow-500/20 flex items-center justify-center relative overflow-hidden">
        <div class="absolute inset-0 opacity-20">
         <svg class="w-full h-full" viewbox="0 0 100 100" fill="none"><circle cx="35" cy="40" r="8" stroke="currentColor" stroke-width="2" class="text-amber-300" /> <circle cx="65" cy="40" r="8" stroke="currentColor" stroke-width="2" class="text-amber-300" /> <circle cx="50" cy="65" r="8" stroke="currentColor" stroke-width="2" class="text-amber-300" /> <line x1="42" y1="44" x2="58" y2="44" stroke="currentColor" stroke-width="2" class="text-amber-300" /> <line x1="40" y1="48" x2="45" y2="60" stroke="currentColor" stroke-width="2" class="text-amber-300" /> <line x1="60" y1="48" x2="55" y2="60" stroke="currentColor" stroke-width="2" class="text-amber-300" />
         </svg>
        </div>
        <div class="relative z-10 w-20 h-20 rounded-2xl bg-gradient-to-br from-amber-500 to-yellow-500 flex items-center justify-center"><!-- Tubo de Ensayo / Qu√≠mica -->
         <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path d="M9 3v15a3 3 0 0 0 6 0V3" stroke-width="2" stroke-linecap="round" /> <line x1="9" y1="3" x2="15" y2="3" stroke-width="2" stroke-linecap="round" /> <path d="M9.5 15c.5 1 1.5 2 2.5 2s2-.5 2.5-1.5" stroke-width="1.5" stroke-linecap="round" fill="currentColor" opacity="0.3" /> <circle cx="10.5" cy="10" r="0.8" fill="currentColor" opacity="0.6" /> <circle cx="13" cy="12" r="0.8" fill="currentColor" opacity="0.6" /> <circle cx="11.5" cy="14" r="0.8" fill="currentColor" opacity="0.6" />
         </svg>
        </div>
       </div>
       <div class="p-6">
        <h3 class="text-xl font-bold mb-2">Bioqu√≠mica</h3>
        <p class="text-cyan-200/60 text-sm mb-4">Metabolismo, enzimas, rutas metab√≥licas y regulaci√≥n</p>
        <div class="flex items-center justify-between"><span class="text-xs text-cyan-300/50">8 semanas</span> <button onclick="showCourse('bioquimica')" class="btn-primary px-4 py-2 rounded-lg text-sm font-medium"> Ver curso ‚Üí </button>
        </div>
       </div>
      </div>
     </div>
    </div>
   </main>
  </div><!-- Course Page Template -->
  <div id="coursePage" class="hidden min-h-full flex flex-col">
   <header class="relative z-10 p-6 border-b border-white/5">
    <div class="max-w-7xl mx-auto flex justify-between items-center">
     <div class="flex items-center gap-4"><button onclick="showPage('dashboard')" class="w-10 h-10 rounded-xl bg-white/5 border border-white/10 flex items-center justify-center hover:bg-white/10 transition-all">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
       </svg></button>
      <div>
       <h1 id="courseTitle" class="text-xl font-bold"></h1>
       <p id="courseSubtitle" class="text-sm text-cyan-200/60"></p>
      </div>
     </div>
     <div class="flex items-center gap-4"><span id="courseUserName" class="text-sm text-cyan-200/80"></span> <button onclick="handleSignOut()" class="px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm hover:bg-white/10 transition-all"> Cerrar sesi√≥n </button>
     </div>
    </div>
   </header>
   <main class="flex-1 p-6 overflow-auto">
    <div class="max-w-5xl mx-auto">
     <div id="courseTabs" class="hidden mb-6 flex gap-2 flex-wrap"></div>
     <div id="weeksContainer" class="space-y-4"></div>
    </div>
   </main>
  </div><!-- Schedule Page -->
  <div id="schedulePage" class="hidden min-h-full flex flex-col">
   <header class="relative z-10 p-6 border-b border-white/5">
    <div class="max-w-7xl mx-auto flex justify-between items-center">
     <div class="flex items-center gap-4"><button onclick="showPage('dashboard')" class="w-10 h-10 rounded-xl bg-white/5 border border-white/10 flex items-center justify-center hover:bg-white/10 transition-all">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
       </svg></button>
      <div>
       <h1 class="text-xl font-bold">Horarios de Clases</h1>
       <p class="text-sm text-cyan-200/60">Gesti√≥n de horarios para estudiantes</p>
      </div>
     </div><button onclick="openAddScheduleModal()" class="btn-primary px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
      </svg> Agregar Horario </button>
    </div>
   </header>
   <main class="flex-1 p-6 overflow-auto">
    <div class="max-w-7xl mx-auto">
     <div id="scheduleGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"><!-- Schedule cards will be rendered here -->
     </div>
    </div>
   </main>
  </div><!-- Students Management Page -->
  <div id="studentsPage" class="hidden min-h-full flex flex-col">
   <header class="relative z-10 p-6 border-b border-white/5">
    <div class="max-w-7xl mx-auto flex justify-between items-center">
     <div class="flex items-center gap-4"><button onclick="showPage('dashboard')" class="w-10 h-10 rounded-xl bg-white/5 border border-white/10 flex items-center justify-center hover:bg-white/10 transition-all">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
       </svg></button>
      <div>
       <h1 class="text-xl font-bold">Gesti√≥n de Alumnos</h1>
       <p class="text-sm text-cyan-200/60">Administrar alumnos y sus cursos matriculados</p>
      </div>
     </div><button onclick="openAddStudentModal()" class="btn-primary px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
      </svg> Agregar Alumno </button>
    </div>
   </header>
   <main class="flex-1 p-6 overflow-auto">
    <div class="max-w-7xl mx-auto">
     <div id="studentsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"><!-- Student cards will be rendered here -->
     </div>
    </div>
   </main>
  </div><!-- NOVI Chat Assistant -->
  <div class="novi-chat" id="noviChat">
   <div class="novi-bubble" onclick="toggleNoviChat()">
    <svg class="w-10 h-10" viewbox="0 0 64 64" fill="none"><ellipse cx="32" cy="36" rx="16" ry="14" fill="white" /> <circle cx="32" cy="20" r="10" fill="white" /> <path d="M20 30 Q32 28 44 30 L44 45 Q32 47 20 45 Z" fill="#E0F2FE" opacity="0.9" /> <circle cx="28" cy="18" r="1.5" fill="#1F2937" /> <circle cx="36" cy="18" r="1.5" fill="#1F2937" /> <circle cx="32" cy="22" r="1" fill="#374151" />
    </svg>
   </div>
   <div class="novi-window" id="noviWindow">
    <div class="p-4 border-b border-cyan-500/30 flex items-center justify-between bg-gradient-to-r from-cyan-500/10 to-blue-500/10">
     <div class="flex items-center gap-3">
      <div class="w-10 h-10 rounded-full bg-gradient-to-br from-cyan-400 to-blue-500 flex items-center justify-center">
       <svg class="w-6 h-6" viewbox="0 0 64 64" fill="none"><ellipse cx="32" cy="36" rx="16" ry="14" fill="white" /> <circle cx="32" cy="20" r="10" fill="white" /> <circle cx="28" cy="18" r="1.5" fill="#1F2937" /> <circle cx="36" cy="18" r="1.5" fill="#1F2937" />
       </svg>
      </div>
      <div>
       <h3 class="font-bold text-sm">NOVI</h3>
       <p class="text-xs text-cyan-300/70">Tu asistente virtual</p>
      </div>
     </div><button onclick="toggleNoviChat()" class="w-8 h-8 rounded-lg hover:bg-white/10 flex items-center justify-center transition-all">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div>
    <div id="noviMessages" class="flex-1 p-4 overflow-y-auto space-y-3 scrollbar-thin">
     <div class="flex gap-2">
      <div class="w-8 h-8 rounded-full bg-gradient-to-br from-cyan-400 to-blue-500 flex items-center justify-center flex-shrink-0">
       <svg class="w-5 h-5" viewbox="0 0 64 64" fill="none"><ellipse cx="32" cy="36" rx="16" ry="14" fill="white" /> <circle cx="32" cy="20" r="10" fill="white" />
       </svg>
      </div>
      <div class="glass-card rounded-2xl rounded-tl-none p-3 max-w-[80%]">
       <p class="text-sm">¬°Hola! üëã Soy NOVI, tu asistente virtual. ¬øEn qu√© puedo ayudarte hoy?</p>
      </div>
     </div>
    </div>
    <div class="p-4 border-t border-cyan-500/30">
     <div class="flex gap-2 mb-2 flex-wrap"><button onclick="askNovi('¬øC√≥mo navego por la plataforma?')" class="text-xs px-3 py-1 rounded-full bg-cyan-500/10 border border-cyan-500/30 text-cyan-300 hover:bg-cyan-500/20 transition-all"> üì± Navegaci√≥n </button> <button onclick="askNovi('¬øC√≥mo accedo a los materiales?')" class="text-xs px-3 py-1 rounded-full bg-cyan-500/10 border border-cyan-500/30 text-cyan-300 hover:bg-cyan-500/20 transition-all"> üìö Materiales </button> <button onclick="askNovi('¬øC√≥mo veo mis horarios?')" class="text-xs px-3 py-1 rounded-full bg-cyan-500/10 border border-cyan-500/30 text-cyan-300 hover:bg-cyan-500/20 transition-all"> üïê Horarios </button>
     </div>
     <form onsubmit="sendNoviMessage(event)" class="flex gap-2"><input type="text" id="noviInput" placeholder="Escribe tu pregunta..." class="flex-1 px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50"> <button type="submit" class="btn-primary px-4 py-2 rounded-lg">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
       </svg></button>
     </form>
    </div>
   </div>
  </div><!-- Modals --> <!-- Upload PDF Modal -->
  <div id="uploadPdfModal" class="modal">
   <div class="glass-card rounded-2xl p-6 max-w-md w-full mx-4">
    <div class="flex justify-between items-center mb-4">
     <h3 class="text-xl font-bold">Subir PDF</h3><button onclick="closeModal('uploadPdfModal')" class="w-8 h-8 rounded-lg hover:bg-white/10 flex items-center justify-center">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div>
    <form onsubmit="handlePdfUpload(event)" class="space-y-4">
     <div><label for="pdfFile" class="block text-sm font-medium mb-2">Seleccionar archivo PDF</label> <input type="file" id="pdfFile" accept=".pdf" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50" required>
     </div>
     <div class="flex gap-2"><button type="button" onclick="closeModal('uploadPdfModal')" class="flex-1 px-4 py-2 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 transition-all"> Cancelar </button> <button type="submit" class="flex-1 btn-primary px-4 py-2 rounded-lg"> <span id="uploadPdfBtnText">Subir</span>
       <div id="uploadPdfSpinner" class="loading-spinner hidden mx-auto"></div></button>
     </div>
    </form>
   </div>
  </div><!-- Add Recording Link Modal -->
  <div id="addRecordingModal" class="modal">
   <div class="glass-card rounded-2xl p-6 max-w-md w-full mx-4">
    <div class="flex justify-between items-center mb-4">
     <h3 class="text-xl font-bold">Agregar Enlace de Grabaci√≥n</h3><button onclick="closeModal('addRecordingModal')" class="w-8 h-8 rounded-lg hover:bg-white/10 flex items-center justify-center">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div>
    <form onsubmit="handleRecordingSubmit(event)" class="space-y-4">
     <div><label for="recordingUrl" class="block text-sm font-medium mb-2">URL de la grabaci√≥n</label> <input type="url" id="recordingUrl" placeholder="https://..." class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50" required>
     </div>
     <div class="flex gap-2"><button type="button" onclick="closeModal('addRecordingModal')" class="flex-1 px-4 py-2 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 transition-all"> Cancelar </button> <button type="submit" class="flex-1 btn-primary px-4 py-2 rounded-lg"> <span id="addRecordingBtnText">Guardar</span>
       <div id="addRecordingSpinner" class="loading-spinner hidden mx-auto"></div></button>
     </div>
    </form>
   </div>
  </div><!-- Banco Options Modal -->
  <div id="bancoModal" class="modal">
   <div class="glass-card rounded-2xl p-6 max-w-md w-full mx-4">
    <div class="flex justify-between items-center mb-4">
     <h3 class="text-xl font-bold">Banco de Preguntas</h3><button onclick="closeModal('bancoModal')" class="w-8 h-8 rounded-lg hover:bg-white/10 flex items-center justify-center">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div>
    <div class="space-y-3"><button onclick="openCreateFormModal()" class="w-full flex items-center gap-3 px-4 py-3 rounded-lg bg-cyan-500/10 border border-cyan-500/30 hover:bg-cyan-500/20 transition-all">
      <svg class="w-5 h-5 text-cyan-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
      </svg><span>Crear Formulario</span> </button> <button onclick="viewFormsList()" class="w-full flex items-center gap-3 px-4 py-3 rounded-lg bg-purple-500/10 border border-purple-500/30 hover:bg-purple-500/20 transition-all">
      <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
      </svg><span>Ver Formularios</span> </button> <button onclick="viewStudentResponses()" class="w-full flex items-center gap-3 px-4 py-3 rounded-lg bg-emerald-500/10 border border-emerald-500/30 hover:bg-emerald-500/20 transition-all">
      <svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
      </svg><span>Ver Respuestas de Estudiantes</span> </button>
    </div>
   </div>
  </div><!-- Create Form Modal -->
  <div id="createFormModal" class="modal">
   <div class="glass-card rounded-2xl p-6 max-w-2xl w-full mx-4 max-h-[80%] overflow-y-auto scrollbar-thin">
    <div class="flex justify-between items-center mb-4">
     <h3 class="text-xl font-bold">Crear Formulario</h3><button onclick="closeModal('createFormModal')" class="w-8 h-8 rounded-lg hover:bg-white/10 flex items-center justify-center">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div>
    <form onsubmit="handleCreateForm(event)" class="space-y-4">
     <div><label for="formTitle" class="block text-sm font-medium mb-2">T√≠tulo del Formulario</label> <input type="text" id="formTitle" placeholder="Ej: Banco Semana 1 - Anatom√≠a" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50" required>
     </div>
     <div><label class="block text-sm font-medium mb-2">Preguntas (una por l√≠nea)</label> <textarea id="formQuestions" rows="10" placeholder="Escribe cada pregunta en una l√≠nea nueva
Ejemplo:
ÔøΩÔøΩÔøΩÔøΩCu√°l es la funci√≥n principal del coraz√≥n?
¬øQu√© es la hemodinamia?" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50" required></textarea>
     </div>
     <div class="flex gap-2"><button type="button" onclick="closeModal('createFormModal')" class="flex-1 px-4 py-2 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 transition-all"> Cancelar </button> <button type="submit" class="flex-1 btn-primary px-4 py-2 rounded-lg"> <span id="createFormBtnText">Crear Formulario</span>
       <div id="createFormSpinner" class="loading-spinner hidden mx-auto"></div></button>
     </div>
    </form>
   </div>
  </div><!-- Add Schedule Modal -->
  <div id="addScheduleModal" class="modal">
   <div class="glass-card rounded-2xl p-6 max-w-md w-full mx-4">
    <div class="flex justify-between items-center mb-4">
     <h3 class="text-xl font-bold">Agregar Horario</h3><button onclick="closeModal('addScheduleModal')" class="w-8 h-8 rounded-lg hover:bg-white/10 flex items-center justify-center">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div>
    <form onsubmit="handleAddSchedule(event)" class="space-y-4">
     <div><label for="scheduleDay" class="block text-sm font-medium mb-2">D√≠a</label> <select id="scheduleDay" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50" required> <option value="Lunes">Lunes</option> <option value="Martes">Martes</option> <option value="Mi√©rcoles">Mi√©rcoles</option> <option value="Jueves">Jueves</option> <option value="Viernes">Viernes</option> <option value="S√°bado">S√°bado</option> <option value="Domingo">Domingo</option> </select>
     </div>
     <div><label for="scheduleTime" class="block text-sm font-medium mb-2">Hora</label> <input type="time" id="scheduleTime" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50" required>
     </div>
     <div><label for="scheduleCourse" class="block text-sm font-medium mb-2">Curso</label> <input type="text" id="scheduleCourse" placeholder="Ej: Anatom√≠a General" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50" required>
     </div>
     <div><label for="scheduleType" class="block text-sm font-medium mb-2">Tipo</label> <select id="scheduleType" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50" required> <option value="Clase">Clase</option> <option value="Laboratorio">Laboratorio</option> <option value="Tutor√≠a">Tutor√≠a</option> <option value="Examen">Examen</option> </select>
     </div>
     <div><label for="scheduleRoom" class="block text-sm font-medium mb-2">Aula/Sala (opcional)</label> <input type="text" id="scheduleRoom" placeholder="Ej: Aula 201" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50">
     </div>
     <div class="flex gap-2"><button type="button" onclick="closeModal('addScheduleModal')" class="flex-1 px-4 py-2 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 transition-all"> Cancelar </button> <button type="submit" class="flex-1 btn-primary px-4 py-2 rounded-lg"> <span id="addScheduleBtnText">Guardar</span>
       <div id="addScheduleSpinner" class="loading-spinner hidden mx-auto"></div></button>
     </div>
    </form>
   </div>
  </div><!-- Add Student Modal -->
  <div id="addStudentModal" class="modal">
   <div class="glass-card rounded-2xl p-6 max-w-2xl w-full mx-4 max-h-[80%] overflow-y-auto scrollbar-thin">
    <div class="flex justify-between items-center mb-4">
     <h3 class="text-xl font-bold">Agregar Alumno</h3><button onclick="closeModal('addStudentModal')" class="w-8 h-8 rounded-lg hover:bg-white/10 flex items-center justify-center">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div>
    <form onsubmit="handleAddStudent(event)" class="space-y-4">
     <div><label for="studentName" class="block text-sm font-medium mb-2">Nombre Completo</label> <input type="text" id="studentName" placeholder="Nombre del alumno" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50" required>
     </div>
     <div><label for="studentEmail" class="block text-sm font-medium mb-2">Correo Electr√≥nico</label> <input type="email" id="studentEmail" placeholder="correo@ejemplo.com" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50" required>
     </div>
     <div><label class="block text-sm font-medium mb-2">Cursos Matriculados</label>
      <div class="space-y-2"><label class="flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 cursor-pointer"> <input type="checkbox" value="anatomia" class="course-checkbox"> <span class="text-sm">Anatom√≠a General</span> </label> <label class="flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 cursor-pointer"> <input type="checkbox" value="morfo1" class="course-checkbox"> <span class="text-sm">Morfofisiolog√≠a 1</span> </label> <label class="flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 cursor-pointer"> <input type="checkbox" value="morfo2" class="course-checkbox"> <span class="text-sm">Morfofisiolog√≠a 2</span> </label> <label class="flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 cursor-pointer"> <input type="checkbox" value="biologia" class="course-checkbox"> <span class="text-sm">Biolog√≠a Celular y Molecular</span> </label> <label class="flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 cursor-pointer"> <input type="checkbox" value="bioquimica" class="course-checkbox"> <span class="text-sm">Bioqu√≠mica</span> </label>
      </div>
     </div>
     <div class="flex gap-2"><button type="button" onclick="closeModal('addStudentModal')" class="flex-1 px-4 py-2 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 transition-all"> Cancelar </button> <button type="submit" class="flex-1 btn-primary px-4 py-2 rounded-lg"> <span id="addStudentBtnText">Agregar Alumno</span>
       <div id="addStudentSpinner" class="loading-spinner hidden mx-auto"></div></button>
     </div>
    </form>
   </div>
  </div><!-- Change Logo Modal -->
  <div id="changeLogoModal" class="modal">
   <div class="glass-card rounded-2xl p-6 max-w-md w-full mx-4">
    <div class="flex justify-between items-center mb-4">
     <h3 class="text-xl font-bold">Cambiar Logo</h3><button onclick="closeModal('changeLogoModal')" class="w-8 h-8 rounded-lg hover:bg-white/10 flex items-center justify-center">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div>
    <form onsubmit="handleLogoChange(event)" class="space-y-4">
     <div><label for="logoFile" class="block text-sm font-medium mb-2">Seleccionar imagen del logo</label> <input type="file" id="logoFile" accept="image/*" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50" required>
      <p class="text-xs text-cyan-300/50 mt-2">Formatos aceptados: JPG, PNG, SVG</p>
     </div>
     <div class="flex gap-2"><button type="button" onclick="closeModal('changeLogoModal')" class="flex-1 px-4 py-2 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 transition-all"> Cancelar </button> <button type="submit" class="flex-1 btn-primary px-4 py-2 rounded-lg"> <span id="changeLogoBtnText">Cambiar Logo</span>
       <div id="changeLogoSpinner" class="loading-spinner hidden mx-auto"></div></button>
     </div>
    </form>
   </div>
  </div><!-- View Logo Modal -->
  <div id="viewLogoModal" class="modal">
   <div class="glass-card rounded-2xl p-6 max-w-md w-full mx-4">
    <div class="flex justify-between items-center mb-4">
     <h3 class="text-xl font-bold">Logo Actual</h3><button onclick="closeModal('viewLogoModal')" class="w-8 h-8 rounded-lg hover:bg-white/10 flex items-center justify-center">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div>
    <div class="flex justify-center p-8 bg-white/5 rounded-xl">
     <div class="w-32 h-32 rounded-xl bg-gradient-to-br from-cyan-400 to-blue-500 flex items-center justify-center neon-glow">
      <svg class="w-24 h-24" viewbox="0 0 64 64" fill="none"><ellipse cx="32" cy="36" rx="16" ry="14" fill="#6B7280" /> <circle cx="32" cy="20" r="10" fill="#6B7280" /> <path d="M20 30 Q32 28 44 30 L44 45 Q32 47 20 45 Z" fill="white" opacity="0.9" /> <line x1="32" y1="28" x2="32" y2="46" stroke="#E5E7EB" stroke-width="1" /> <circle cx="32" cy="32" r="1" fill="#93C5FD" /> <circle cx="32" cy="36" r="1" fill="#93C5FD" /> <circle cx="32" cy="40" r="1" fill="#93C5FD" /> <circle cx="28" cy="18" r="1.5" fill="#1F2937" /> <circle cx="36" cy="18" r="1.5" fill="#1F2937" /> <circle cx="32" cy="22" r="1" fill="#374151" />
      </svg>
     </div>
    </div>
   </div>
  </div><!-- Flashcard Import Modal -->
  <div id="flashcardImportModal" class="modal">
   <div class="glass-card rounded-2xl p-6 max-w-md w-full mx-4">
    <div class="flex justify-between items-center mb-4">
     <h3 class="text-xl font-bold">üé¥ Crear Flashcards</h3><button onclick="closeModal('flashcardImportModal')" class="w-8 h-8 rounded-lg hover:bg-white/10 flex items-center justify-center">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div>
    <form onsubmit="handleFlashcardImport(event)" class="space-y-4">
     <div><label for="flashcardFile" class="block text-sm font-medium mb-2">Seleccionar archivo PDF</label> <input type="file" id="flashcardFile" accept=".pdf,image/*" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50" required>
     </div>
     <div><label for="flashcardQuantity" class="block text-sm font-medium mb-2">Cantidad de Flashcards</label> <select id="flashcardQuantity" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50"> <option value="few">Pocos (5)</option> <option value="necessary">Necesarios (10)</option> <option value="many">Muchos (15)</option> </select>
     </div>
     <div><label for="flashcardDifficulty" class="block text-sm font-medium mb-2">Dificultad</label> <select id="flashcardDifficulty" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50"> <option value="easy">F√°cil</option> <option value="medium">Medio</option> <option value="hard">Dif√≠cil</option> </select>
     </div>
     <div class="flex gap-2"><button type="button" onclick="closeModal('flashcardImportModal')" class="flex-1 px-4 py-2 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 transition-all"> Cancelar </button> <button type="submit" class="flex-1 btn-primary px-4 py-2 rounded-lg"> <span id="flashcardImportBtn">Generar Flashcards</span>
       <div id="flashcardImportSpinner" class="loading-spinner hidden mx-auto"></div></button>
     </div>
    </form>
   </div>
  </div><!-- Flashcard Study Modal -->
  <div id="flashcardStudyModal" class="modal">
   <div class="glass-card rounded-2xl p-6 max-w-2xl w-full mx-4">
    <div class="flex justify-between items-center mb-4">
     <h3 class="text-lg font-bold" id="flashcardCounter">1 / 10</h3><button onclick="closeModal('flashcardStudyModal')" class="w-8 h-8 rounded-lg hover:bg-white/10 flex items-center justify-center">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div>
    <div id="flashcardContainer" class="mb-6 min-h-[300px] flex items-center justify-center"></div>
    <div class="flex gap-3 justify-center"><button onclick="markFlashcard(false)" class="flex items-center gap-2 px-6 py-3 rounded-xl bg-red-500/20 border border-red-500/50 text-red-300 hover:bg-red-500/30 transition-all">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg> No s√© </button> <button onclick="markFlashcard(true)" class="flex items-center gap-2 px-6 py-3 rounded-xl bg-emerald-500/20 border border-emerald-500/50 text-emerald-300 hover:bg-emerald-500/30 transition-all">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
      </svg> S√≠ s√© </button>
    </div>
    <p class="text-xs text-center text-cyan-300/60 mt-4">üí° Toca los lados para cambiar de flashcard, toca el centro para voltear</p>
   </div>
  </div><!-- Question Generator Import Modal -->
  <div id="questionGeneratorImportModal" class="modal">
   <div class="glass-card rounded-2xl p-6 max-w-md w-full mx-4 max-h-[85%] overflow-y-auto scrollbar-thin">
    <div class="flex justify-between items-center mb-4">
     <h3 class="text-xl font-bold">ü§ñ Generar Preguntas IA</h3><button onclick="closeModal('questionGeneratorImportModal')" class="w-8 h-8 rounded-lg hover:bg-white/10 flex items-center justify-center">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div>
    <form onsubmit="handleQuestionImport(event)" class="space-y-4">
     <div><label class="block text-sm font-medium mb-2">Importar contenido</label>
      <div class="space-y-2"><input type="file" id="questionFile" accept=".pdf" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50"> <input type="url" id="questionYoutubeLink" placeholder="Link de YouTube (opcional)" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50"> <textarea id="questionText" rows="3" placeholder="O pega texto aqu√≠..." class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50"></textarea>
      </div>
     </div>
     <div><label for="questionQuantity" class="block text-sm font-medium mb-2">Cantidad de Preguntas</label> <select id="questionQuantity" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50"> <option value="few">Pocas (5)</option> <option value="necessary">Necesarias (10)</option> <option value="many">Muchas (15)</option> </select>
     </div>
     <div><label for="questionDifficulty" class="block text-sm font-medium mb-2">Dificultad</label> <select id="questionDifficulty" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50"> <option value="easy">F√°cil</option> <option value="medium">Medio</option> <option value="hard">Avanzado</option> </select>
     </div>
     <div><label for="questionCustomPrompt" class="block text-sm font-medium mb-2">Personaliza tus preguntas</label> <textarea id="questionCustomPrompt" rows="2" placeholder="Ej: Enf√≥cate en conceptos clave..." class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50"></textarea>
     </div>
     <div class="flex gap-2"><button type="button" onclick="closeModal('questionGeneratorImportModal')" class="flex-1 px-4 py-2 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 transition-all"> Cancelar </button> <button type="submit" class="flex-1 btn-primary px-4 py-2 rounded-lg"> <span id="questionImportBtn">Generar Preguntas</span>
       <div id="questionImportSpinner" class="loading-spinner hidden mx-auto"></div></button>
     </div>
    </form>
   </div>
  </div><!-- Question Study Modal -->
  <div id="questionStudyModal" class="modal">
   <div class="glass-card rounded-2xl p-6 max-w-2xl w-full mx-4">
    <div class="flex justify-between items-center mb-4">
     <h3 class="text-lg font-bold" id="questionCounter">Pregunta 1 de 10</h3><button onclick="closeModal('questionStudyModal')" class="w-8 h-8 rounded-lg hover:bg-white/10 flex items-center justify-center">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div>
    <div id="questionContainer" class="min-h-[300px]"></div>
   </div>
  </div><!-- Notes Main Modal -->
  <div id="notesMainModal" class="modal">
   <div class="glass-card rounded-2xl p-6 max-w-2xl w-full mx-4 max-h-[85%] overflow-y-auto scrollbar-thin">
    <div class="flex justify-between items-center mb-4">
     <h3 class="text-xl font-bold">üìù Apuntes</h3><button onclick="closeModal('notesMainModal')" class="w-8 h-8 rounded-lg hover:bg-white/10 flex items-center justify-center">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div><button onclick="openCreateNoteModal()" class="w-full mb-6 btn-primary px-4 py-3 rounded-xl font-medium flex items-center justify-center gap-2">
     <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
     </svg> Crear Nuevo Apunte </button>
    <div id="notesListContainer"></div>
   </div>
  </div><!-- Create Note Modal -->
  <div id="createNoteModal" class="modal">
   <div class="glass-card rounded-2xl p-6 max-w-3xl w-full mx-4 max-h-[85%] overflow-y-auto scrollbar-thin">
    <div class="flex justify-between items-center mb-4">
     <h3 class="text-xl font-bold">‚úèÔ∏è Nuevo Apunte</h3><button onclick="closeModal('createNoteModal')" class="w-8 h-8 rounded-lg hover:bg-white/10 flex items-center justify-center">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div>
    <div class="space-y-4">
     <div><label for="noteTitle" class="block text-sm font-medium mb-2">T√≠tulo del apunte</label> <input type="text" id="noteTitle" placeholder="T√≠tulo..." class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50">
     </div>
     <div><label for="noteContent" class="block text-sm font-medium mb-2">Contenido</label> <textarea id="noteContent" rows="15" placeholder="Escribe tus apuntes aqu√≠... 

Puedes:
‚Ä¢ Escribir texto
‚Ä¢ Hacer listas
‚Ä¢ Agregar notas
‚Ä¢ Organizar informaci√≥n" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50 font-mono"></textarea>
     </div>
     <div class="flex gap-2"><button type="button" onclick="closeModal('createNoteModal')" class="flex-1 px-4 py-2 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 transition-all"> Cancelar </button> <button onclick="saveNote()" class="flex-1 btn-primary px-4 py-2 rounded-lg"> <span id="saveNoteBtn">Guardar Apunte</span>
       <div id="saveNoteSpinner" class="loading-spinner hidden mx-auto"></div></button>
     </div>
    </div>
   </div>
  </div><!-- Exams Main Modal -->
  <div id="examsMainModal" class="modal">
   <div class="glass-card rounded-2xl p-6 max-w-2xl w-full mx-4 max-h-[85%] overflow-y-auto scrollbar-thin">
    <div class="flex justify-between items-center mb-4">
     <h3 class="text-xl font-bold">üìã Ex√°menes</h3><button onclick="closeModal('examsMainModal')" class="w-8 h-8 rounded-lg hover:bg-white/10 flex items-center justify-center">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div><button onclick="openCreateExamModal()" class="w-full mb-6 btn-primary px-4 py-3 rounded-xl font-medium flex items-center justify-center gap-2">
     <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
     </svg> Crear Nuevo Examen </button>
    <div id="examsListContainer"></div>
   </div>
  </div><!-- Create Exam Modal -->
  <div id="createExamModal" class="modal">
   <div class="glass-card rounded-2xl p-6 max-w-md w-full mx-4 max-h-[85%] overflow-y-auto scrollbar-thin">
    <div class="flex justify-between items-center mb-4">
     <h3 class="text-xl font-bold">üéØ Crear Examen</h3><button onclick="closeModal('createExamModal')" class="w-8 h-8 rounded-lg hover:bg-white/10 flex items-center justify-center">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div>
    <form onsubmit="handleCreateExam(event)" class="space-y-4">
     <div><label class="block text-sm font-medium mb-2">Importar contenido</label>
      <div class="space-y-2"><input type="file" id="examFile" accept=".pdf" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50"> <input type="url" id="examYoutubeLink" placeholder="Link de YouTube (opcional)" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50"> <textarea id="examText" rows="2" placeholder="O pega texto aqu√≠..." class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50"></textarea>
      </div>
     </div>
     <div><label for="examTime" class="block text-sm font-medium mb-2">Tiempo (minutos)</label> <select id="examTime" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50"> <option value="5">5 minutos</option> <option value="10">10 minutos</option> <option value="15">15 minutos</option> <option value="20">20 minutos</option> <option value="30">30 minutos</option> <option value="45">45 minutos</option> <option value="60">1 hora</option> </select>
     </div>
     <div><label for="examNumQuestions" class="block text-sm font-medium mb-2">N√∫mero de preguntas</label> <input type="number" id="examNumQuestions" min="10" max="50" value="20" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50">
     </div>
     <div><label for="examDifficulty" class="block text-sm font-medium mb-2">Dificultad</label> <select id="examDifficulty" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50"> <option value="easy">F√°cil</option> <option value="medium">Medio</option> <option value="hard">Dif√≠cil</option> </select>
     </div>
     <div><label for="examType" class="block text-sm font-medium mb-2">Tipo de preguntas</label> <select id="examType" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50"> <option value="multiple">Opci√≥n M√∫ltiple</option> <option value="short">Respuestas Cortas</option> </select>
     </div>
     <div class="flex gap-2"><button type="button" onclick="closeModal('createExamModal')" class="flex-1 px-4 py-2 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 transition-all"> Cancelar </button> <button type="submit" class="flex-1 btn-primary px-4 py-2 rounded-lg"> <span id="createExamBtn">Crear y Comenzar</span>
       <div id="createExamSpinner" class="loading-spinner hidden mx-auto"></div></button>
     </div>
    </form>
   </div>
  </div><!-- Exam Study Modal -->
  <div id="examStudyModal" class="modal">
   <div class="glass-card rounded-2xl p-6 max-w-2xl w-full mx-4">
    <div class="flex justify-between items-center mb-4">
     <h3 class="text-lg font-bold" id="questionCounter">Pregunta 1 de 20</h3>
     <div class="flex items-center gap-4"><span class="text-lg font-bold text-amber-400" id="examTimerDisplay">‚è±Ô∏è 30:00</span> <button onclick="finishExam()" class="px-4 py-2 rounded-lg bg-amber-500/20 border border-amber-500/50 text-amber-300 hover:bg-amber-500/30 transition-all text-sm"> Finalizar </button>
     </div>
    </div>
    <div id="questionContainer" class="min-h-[300px]"></div>
   </div>
  </div><!-- Change Course Icon Modal -->
  <div id="changeCourseIconModal" class="modal">
   <div class="glass-card rounded-2xl p-6 max-w-md w-full mx-4">
    <div class="flex justify-between items-center mb-4">
     <h3 class="text-xl font-bold">Cambiar √çcono del Curso</h3><button onclick="closeModal('changeCourseIconModal')" class="w-8 h-8 rounded-lg hover:bg-white/10 flex items-center justify-center">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div>
    <form onsubmit="handleCourseIconChange(event)" class="space-y-4"><input type="hidden" id="iconCourseId">
     <div><label class="block text-sm font-medium mb-2">Curso: <span id="iconCourseName" class="text-cyan-400"></span></label>
     </div>
     <div><label for="courseIconFile" class="block text-sm font-medium mb-2">Seleccionar √≠cono</label> <input type="file" id="courseIconFile" accept="image/*" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50" required>
      <p class="text-xs text-cyan-300/50 mt-2">Formatos aceptados: JPG, PNG, SVG</p>
     </div>
     <div class="flex gap-2"><button type="button" onclick="closeModal('changeCourseIconModal')" class="flex-1 px-4 py-2 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 transition-all"> Cancelar </button> <button type="submit" class="flex-1 btn-primary px-4 py-2 rounded-lg"> <span id="changeCourseIconBtnText">Cambiar √çcono</span>
       <div id="changeCourseIconSpinner" class="loading-spinner hidden mx-auto"></div></button>
     </div>
    </form>
   </div>
  </div><!-- Edit Student Modal -->
  <div id="editStudentModal" class="modal">
   <div class="glass-card rounded-2xl p-6 max-w-2xl w-full mx-4 max-h-[80%] overflow-y-auto scrollbar-thin">
    <div class="flex justify-between items-center mb-4">
     <h3 class="text-xl font-bold">Editar Alumno</h3><button onclick="closeModal('editStudentModal')" class="w-8 h-8 rounded-lg hover:bg-white/10 flex items-center justify-center">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div>
    <form onsubmit="handleEditStudent(event)" class="space-y-4"><input type="hidden" id="editStudentId">
     <div><label for="editStudentName" class="block text-sm font-medium mb-2">Nombre Completo</label> <input type="text" id="editStudentName" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50" required>
     </div>
     <div><label for="editStudentEmail" class="block text-sm font-medium mb-2">Correo Electr√≥nico</label> <input type="email" id="editStudentEmail" class="w-full px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-sm focus:outline-none focus:border-cyan-500/50" disabled>
     </div>
     <div><label class="block text-sm font-medium mb-2">Cursos Matriculados</label>
      <div class="space-y-2"><label class="flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 cursor-pointer"> <input type="checkbox" value="anatomia" class="edit-course-checkbox"> <span class="text-sm">Anatom√≠a General</span> </label> <label class="flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 cursor-pointer"> <input type="checkbox" value="morfo1" class="edit-course-checkbox"> <span class="text-sm">Morfofisiolog√≠a 1</span> </label> <label class="flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 cursor-pointer"> <input type="checkbox" value="morfo2" class="edit-course-checkbox"> <span class="text-sm">Morfofisiolog√≠a 2</span> </label> <label class="flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 cursor-pointer"> <input type="checkbox" value="biologia" class="edit-course-checkbox"> <span class="text-sm">Biolog√≠a Celular y Molecular</span> </label> <label class="flex items-center gap-2 px-3 py-2 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 cursor-pointer"> <input type="checkbox" value="bioquimica" class="edit-course-checkbox"> <span class="text-sm">Bioqu√≠mica</span> </label>
      </div>
     </div>
     <div class="flex gap-2"><button type="button" onclick="closeModal('editStudentModal')" class="flex-1 px-4 py-2 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 transition-all"> Cancelar </button> <button type="submit" class="flex-1 btn-primary px-4 py-2 rounded-lg"> <span id="editStudentBtnText">Guardar Cambios</span>
       <div id="editStudentSpinner" class="loading-spinner hidden mx-auto"></div></button>
     </div>
    </form>
   </div>
  </div><!-- Learning Resources Modal -->
  <div id="learningResourcesModal" class="modal">
   <div class="glass-card rounded-2xl p-6 max-w-2xl w-full mx-4 max-h-[85%] overflow-y-auto scrollbar-thin">
    <div class="flex justify-between items-center mb-6">
     <div>
      <h3 class="text-2xl font-bold">üìö Recursos de Aprendizaje</h3>
      <p class="text-sm text-cyan-300/60 mt-1" id="resourcesSubtitle">Herramientas para tu estudio</p>
     </div><button onclick="closeModal('learningResourcesModal')" class="w-8 h-8 rounded-lg hover:bg-white/10 flex items-center justify-center">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg></button>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><!-- Flashcards --> <button onclick="openFlashcardsSection()" class="group glass-card rounded-xl p-5 hover:bg-cyan-500/10 transition-all text-left">
      <div class="flex items-start gap-4">
       <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center flex-shrink-0 group-hover:scale-110 transition-transform">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
        </svg>
       </div>
       <div class="flex-1">
        <h4 class="font-bold mb-1">Flashcards</h4>
        <p class="text-xs text-cyan-200/60">Crea y estudia con tarjetas de memoria</p>
       </div>
      </div></button> <!-- Generador de Preguntas --> <button onclick="openQuestionGeneratorSection()" class="group glass-card rounded-xl p-5 hover:bg-purple-500/10 transition-all text-left">
      <div class="flex items-start gap-4">
       <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-violet-500 flex items-center justify-center flex-shrink-0 group-hover:scale-110 transition-transform">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
       </div>
       <div class="flex-1">
        <h4 class="font-bold mb-1">Banco de Preguntas IA</h4>
        <p class="text-xs text-cyan-200/60">Genera preguntas desde PDFs o im√°genes</p>
       </div>
      </div></button> <!-- Apuntes --> <button onclick="openNotesSection()" class="group glass-card rounded-xl p-5 hover:bg-emerald-500/10 transition-all text-left">
      <div class="flex items-start gap-4">
       <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-emerald-500 to-teal-500 flex items-center justify-center flex-shrink-0 group-hover:scale-110 transition-transform">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
        </svg>
       </div>
       <div class="flex-1">
        <h4 class="font-bold mb-1">Apuntes</h4>
        <p class="text-xs text-cyan-200/60">Crea y consulta apuntes de clase</p>
       </div>
      </div></button> <!-- Ex√°menes --> <button onclick="openExamsSection()" class="group glass-card rounded-xl p-5 hover:bg-amber-500/10 transition-all text-left">
      <div class="flex items-start gap-4">
       <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-amber-500 to-orange-500 flex items-center justify-center flex-shrink-0 group-hover:scale-110 transition-transform">
        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
        </svg>
       </div>
       <div class="flex-1">
        <h4 class="font-bold mb-1">Ex√°menes</h4>
        <p class="text-xs text-cyan-200/60">Practica con ex√°menes anteriores</p>
       </div>
      </div></button>
    </div>
   </div>
  </div>
  <script>
    // Configuration
    const defaultConfig = {
      academy_name: 'Neurova p53',
      welcome_message: 'Tu plataforma de aprendizaje en ciencias m√©dicas',
      whatsapp_number: '977666427',
      primary_color: '#0ea5e9',
      secondary_color: '#06b6d4',
      background_color: '#0a1929',
      text_color: '#ffffff',
      accent_color: '#10b981'
    };

    let config = { ...defaultConfig };
    let currentUser = null;
    let currentCourse = null;
    let currentTab = null;
    let currentUploadContext = null;
    let allData = [];
    let currentEditingStudent = null;

    // Admin emails
    const ADMIN_EMAILS = [
      'jamescuribanco333@gmail.com',
      'curibancovilajamesmatias@gmail.com'
    ];

    // Google Client ID - Debes reemplazar esto con tu propio Client ID de Google Cloud Console
    // Instrucciones para obtener tu Client ID:
    // 1. Ve a https://console.cloud.google.com/
    // 2. Crea un proyecto nuevo
    // 3. Ve a "APIs y servicios" > "Credenciales"
    // 4. Clic en "Crear credenciales" > "ID de cliente de OAuth 2.0"
    // 5. Configura la pantalla de consentimiento
    // 6. Agrega los or√≠genes autorizados de JavaScript
    // 7. Copia el Client ID y reempl√°zalo aqu√≠
    const GOOGLE_CLIENT_ID = 'YOUR_GOOGLE_CLIENT_ID_HERE.apps.googleusercontent.com';
    
    // MODO DE PRUEBA: Cambia esto a true para usar login temporal sin Google
    const TEST_MODE = true;

    // Course prices and promotions
    const coursePrices = {
      anatomia: { price: 100, promoPrice: 90, promoEndDate: '2025-02-06' },
      morfo1: { price: 180, promoPrice: 160, promoEndDate: '2025-02-06' },
      morfo2: { price: 240, promoPrice: 220, promoEndDate: '2025-02-06' },
      biologia: { price: 100, promoPrice: 90, promoEndDate: '2025-02-06' },
      bioquimica: { price: 100, promoPrice: 90, promoEndDate: '2025-02-06' }
    };

    // Course Data
    const coursesData = {
      recursos: {
        title: 'Recursos de Aprendizaje',
        subtitle: 'Flashcards, banco de preguntas IA, apuntes y ex√°menes',
        color: 'from-indigo-500 to-purple-500',
        hasTabs: false,
        isResourceCenter: true
      },
      anatomia: {
        title: 'Anatom√≠a General',
        subtitle: 'Sistema musculoesquel√©tico y regiones corporales',
        color: 'from-rose-500 to-orange-500',
        hasTabs: false,
        weeks: [
          { num: 1, topic: 'Hombro, Axila, Brazo y Codo.' },
          { num: 2, topic: 'Antebrazo, Mu√±eca y Mano.' },
          { num: 3, topic: 'Regi√≥n Gl√∫tea, Cadera, Muslo y Rodilla.' },
          { num: 4, topic: 'Pierna, Regi√≥n Popl√≠tea, Tobillo y Pie. (Parciales)' },
          { num: 5, topic: 'V√©rtebras cervicales, regiones y tri√°ngulos del cuello.' },
          { num: 6, topic: 'VÔøΩÔøΩsceras del cuello, Cabeza √≥sea (Neuro/Viscerocr√°neo).' },
          { num: 7, topic: 'MÔøΩÔøΩÔøΩÔøΩsculos mÔøΩÔøΩmica/masticaci√≥n y Regiones profundas de la cara.' },
          { num: 8, topic: 'Cavidad oral, fosas nasales y paredes de tronco. (Finales)' }
        ]
      },
      morfo1: {
        title: 'Morfofisiolog√≠a 1',
        subtitle: 'Fisiolog√≠a celular y sistemas de integraci√≥n',
        color: 'from-blue-500 to-cyan-500',
        hasTabs: true,
        tabs: ['Fisiolog√≠a', 'Histolog√≠a'],
        weeks: [
          {
            num: 1,
            topics: {
              'Fisiolog√≠a': 'Membrana celular, receptores, canales, transporte y potenciales de membrana/acci√≥n. Regularizaci√≥n y se√±alizaci√≥n celular.',
              'Histolog√≠a': 'Procesamiento histol√≥gico, membrana celular, organelas y n√∫cleo. Desarrollo embrionario del esqueleto y tejido cartilaginoso.'
            }
          },
          {
            num: 2,
            topics: {
              'Fisiolog√≠a': 'Transmisi√≥n de se√±ales celulares. Composici√≥n y regulaci√≥n del medio interno, √≥smosis y l√≠quidos corporales.',
              'Histolog√≠a': 'Tejido √≥seo y osificaci√≥n. Origen embrionario del sistema muscular y Tejido muscular I.'
            }
          },
          {
            num: 3,
            topics: {
              'Fisiolog√≠a': 'Neurotransmisores, receptores y sinapsis. Contracci√≥n y excitaci√≥n muscular.',
              'Histolog√≠a': 'Tejido muscular II. Neurohistog√©nesis y tejido nervioso.'
            }
          },
          {
            num: 4,
            topics: {
              'Fisiolog√≠a': 'Metabolismo √≥seo. Evaluaci√≥n Parcial.',
              'Histolog√≠a': 'Introducci√≥n al sistema vascular. Evaluaci√≥n Parcial.'
            }
          },
          {
            num: 5,
            topics: {
              'Fisiolog√≠a': 'Sangre y sus propiedades, hematopoyesis, eritropoyesis y hemograma. Fisiolog√≠a eritrocitaria I (membrana, metabolismo y hemoglobina).',
              'Histolog√≠a': 'Tejido epitelial de revestimiento. Tejido epitelial glandular.'
            }
          },
          {
            num: 6,
            topics: {
              'Fisiolog√≠a': 'Fisiolog√≠a eritrocitaria II (hierro, vitamina B12 y B9). Fisiolog√≠a plaquetaria, hemostasia y fibrin√≥lisis.',
              'Histolog√≠a': 'Matriz extracelular, tejido conectivo y tejido adiposo. Tejido sangu√≠neo y hematopoyesis.'
            }
          },
          {
            num: 7,
            topics: {
              'Fisiolog√≠a': 'Generalidades del sistema inmunol√≥gico, respuesta innata y fagocitosis. Inmunidad adquirida, linfocitos T y B, y grupos sangu√≠neos.',
              'Histolog√≠a': 'Tejido linfoide y MALT. √ìrganos linfoides.'
            }
          },
          {
            num: 8,
            topics: {
              'FisiologÔøΩÔøΩa': 'Respuesta inflamatoria, tolerancia e hipersensibilidad. Evaluaci√≥n Final.',
              'Histolog√≠a': 'Sistema tegumentario y sus anexos. Evaluaci√≥n Final.'
            }
          }
        ]
      },
      morfo2: {
        title: 'Morfofisiolog√≠a 2',
        subtitle: 'Sistemas cardiovascular, respiratorio y renal',
        color: 'from-emerald-500 to-teal-500',
        hasTabs: true,
        tabs: ['Anatom√≠a', 'Fisiolog√≠a', 'Histolog√≠a/Embriolog√≠a'],
        weeks: [
          {
            num: 1,
            topics: {
              'Anatom√≠a': 'Pared tor√°cica, regi√≥n mamaria y radioanatom√≠a de t√≥rax.',
              'Fisiolog√≠a': 'Hemodinamia y electrofisiolog√≠a cardiaca.',
              'Histolog√≠a/Embriolog√≠a': 'Embriolog√≠a cardiovascular e histolog√≠a del coraz√≥n y v√°lvulas.'
            }
          },
          {
            num: 2,
            topics: {
              'Anatom√≠a': 'Mediastino superior, anterior y medio (pericardio y morfolog√≠a externa).',
              'Fisiolog√≠a': 'Electrocardiograma I, contracci√≥n y ciclo card√≠aco.',
              'Histolog√≠a/Embriolog√≠a': 'Histolog√≠a vascular (arterias, capilares, venas y linf√°ticos).'
            }
          },
          {
            num: 3,
            topics: {
              'Anatom√≠a': 'Mediastino medio II (morfolog√≠a interna y conducci√≥n) y radioanatom√≠a cardiaca.',
              'Fisiolog√≠a': 'Presi√≥n arterial, gasto cardiaco, retorno venoso y circulaciones especiales.',
              'Histolog√≠a/Embriolog√≠a': 'Integraci√≥n de embriolog√≠a e histolog√≠a card√≠aca.'
            }
          },
          {
            num: 4,
            topics: {
              'Anatom√≠a': 'Mediastino posterior y radioanatom√≠a del mediastino posterior. Examen Parcial.',
              'Fisiolog√≠a': 'Mec√°nica respiratoria, vol√∫menes y capacidades. Examen Parcial.',
              'Histolog√≠a/Embriolog√≠a': 'Integraci√≥n de histolog√≠a vascular. Examen Parcial.'
            }
          },
          {
            num: 5,
            topics: {
              'Anatom√≠a': 'Pulmones (segmentaciÔøΩÔøΩÔøΩÔøΩn e inervaci√≥n) y radioanatom√≠a pulmonar.',
              'Fisiolog√≠a': 'Intercambio de gases, transporte de O‚ÇÇ/CO‚ÇÇ, control respiratorio y circulaci√≥n pulmonar.',
              'Histolog√≠a/Embriolog√≠a': 'Embriolog√≠a e histolog√≠a del aparato respiratorio (I y II).'
            }
          },
          {
            num: 6,
            topics: {
              'Anatom√≠a': 'Columna vertebral dorsal y m√∫sculos paravertebrales.',
              'Fisiolog√≠a': 'Estructura renal, aclaramiento, filtraci√≥n glomerular, reabsorci√≥n y secreci√≥n renal.',
              'Histolog√≠a/Embriolog√≠a': 'Embriolog√≠a urinaria e histolog√≠a del ri√±√≥n y la pelvis renal.'
            }
          },
          {
            num: 7,
            topics: {
              'Anatom√≠a': 'Radioanatom√≠a de columna tor√°cica, anatom√≠a del ri√±√≥n y v√≠as urinarias.',
              'Fisiolog√≠a': 'Regulaci√≥n de electrolitos, volumen, equilibrio √°cido-base y diur√©ticos.',
              'Histolog√≠a/Embriolog√≠a': 'Histolog√≠a de ur√©ter, vejiga y uretra; malformaciones cong√©nitas renales.'
            }
          },
          {
            num: 8,
            topics: {
              'Anatom√≠a': 'Radioanatom√≠a del ri√±√≥n y v√≠as urinarias. Examen Final.',
              'Fisiolog√≠a': 'Fisiolog√≠a de la aviaci√≥n, grandes alturas y buceo profundo. Examen Final.',
              'Histolog√≠a/Embriolog√≠a': 'Histopatolog√≠a renal y de las v√≠as urinarias. Examen Final.'
            }
          }
        ]
      },
      biologia: {
        title: 'Biolog√≠a Celular y Molecular',
        subtitle: 'Estructura celular y gen√©tica molecular',
        color: 'from-violet-500 to-purple-500',
        hasTabs: true,
        tabs: ['Teor√≠a', 'Laboratorio'],
        weeks: [
          {
            num: 1,
            topics: {
              'Teor√≠a': 'Niveles de organizaci√≥n, Bioelementos, Enlaces qu√≠micos y Agua. Gl√∫cidos y L√≠pidos.',
              'Laboratorio': 'Normas de Bioseguridad y Manejo del Microscopio. IdentificaciÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩn de Gl√∫cidos y L√≠pidos.'
            }
          },
          {
            num: 2,
            topics: {
              'Teor√≠a': 'Amino√°cidos, Prote√≠nas y Enzimas. Dogma Central: Estructura del ADN y ARN.',
              'Laboratorio': 'Identificaci√≥n de Prote√≠nas y Enzimas. Extracci√≥n de ADN.'
            }
          },
          {
            num: 3,
            topics: {
              'Teor√≠a': 'La C√©lula: Evoluci√≥n (Proca vs. Euca) y Membrana Celular. Transporte de membrana (Pasivo/Activo).',
              'Laboratorio': 'C√©lula Procariota y Eucariota. Permeabilidad de la Membrana Celular (Di√°lisis).'
            }
          },
          {
            num: 4,
            topics: {
              'Teor√≠a': 'Citoesqueleto, Matriz Extracelular y Uniones celulares. Evaluaci√≥n Parcial.',
              'Laboratorio': 'Diversidad Celular y Diferenciaci√≥n. Evaluaci√≥n Parcial.'
            }
          },
          {
            num: 5,
            topics: {
              'Teor√≠a': 'Sistema de Endomembranas (RER, REL, Golgi) y Digesti√≥n Celular (Lisosomas/Peroxisomas). Mitocondrias y Bioenerg√©tica.',
              'Laboratorio': 'Fraccionamiento Celular. Respiraci√≥n Celular (Fermentaci√≥n).'
            }
          },
          {
            num: 6,
            topics: {
              'Teor√≠a': 'N√∫cleo Celular, Cromatina y Replicaci√≥n del ADN. Transcripci√≥n y Procesamiento de ARN.',
              'Laboratorio': 'Observaci√≥n de N√∫cleo y Corp√∫sculo de Barr. Soluciones y Diluciones.'
            }
          },
          {
            num: 7,
            topics: {
              'Teor√≠a': 'Traducci√≥n (S√≠ntesis de Prote√≠nas). Ciclo Celular, Mitosis, Meiosis y Apoptosis.',
              'Laboratorio': 'S√≠ntesis de Prote√≠nas (Simulaci√≥n). Mitosis y Meiosis (C√©lulas vegetales/animales).'
            }
          },
          {
            num: 8,
            topics: {
              'Teor√≠a': 'Se√±alizaci√≥n celular, Introducci√≥n al C√°ncer y Gen√©tica Molecular. Evaluaci√≥n Final.',
              'Laboratorio': 'Tecnolog√≠a del ADN Recombinante (Simulaci√≥n). Evaluaci√≥n Final.'
            }
          }
        ]
      },
      bioquimica: {
        title: 'Bioqu√≠mica',
        subtitle: 'Metabolismo, enzimas y rutas metab√≥licas',
        color: 'from-amber-500 to-yellow-500',
        hasTabs: true,
        tabs: ['Teor√≠a', 'Laboratorio'],
        weeks: [
          {
            num: 1,
            topics: {
              'Teor√≠a': 'Bioelementos y Biomol√©culas: Agua, pH, soluciones buffer, bioelementos y vitaminas. Estructuras supramoleculares.',
              'Laboratorio': 'Espectrofotometr√≠a: Principios de bioseguridad y determinaci√≥n de concentraci√≥n de compuestos.'
            }
          },
          {
            num: 2,
            topics: {
              'Teor√≠a': 'Amino√°cidos y Prote√≠nas: Estructura, clasificaci√≥n y propiedades. Plegamiento y desnaturalizaci√≥n.',
              'Laboratorio': 'Prote√≠nas totales: Determinaci√≥n de prote√≠nas totales, alb√∫mina y globulinas en suero.'
            }
          },
          {
            num: 3,
            topics: {
              'Teor√≠a': 'Enzimas y Cin√©tica: Energ√≠a de activaci√≥n y factores que afectan la actividad enzim√°tica. Evaluaci√≥n Continua 1.',
              'Laboratorio': 'Degradaci√≥n de prote√≠nas y factores que afectan la actividad enzim√°tica.'
            }
          },
          {
            num: 4,
            topics: {
              'Teor√≠a': 'Metabolismo de Carbohidratos: Glic√≥lisis, ciclo de la urea y degradaci√≥n de amino√°cidos. Evaluaci√≥n Parcial.',
              'Laboratorio': 'Concentraci√≥n de urea: Determinaci√≥n en suero e identificaci√≥n de biomol√©culas. Evaluaci√≥n Parcial.'
            }
          },
          {
            num: 5,
            topics: {
              'Teor√≠a': 'Gluc√≥geno y Bioenerg√©tica: S√≠ntesis/degradaci√≥n de gluc√≥geno, ciclo de Krebs y fosforilaci√≥n oxidativa.',
              'Laboratorio': 'Metabolismo en ayuno/postprandial: Evaluaci√≥n de rutas metab√≥licas en condiciones de alimentaci√≥n.'
            }
          },
          {
            num: 6,
            topics: {
              'Teor√≠a': 'Metabolismo de L√≠pidos: Lipog√©nesis, beta-oxidaci√≥n y s√≠ntesis de triglic√©ridos. Evaluaci√≥n Continua 2.',
              'Laboratorio': 'Digesti√≥n y Hidr√≥lisis: Digesti√≥n enzim√°tica del almid√≥n e hidr√≥lisis de l√≠pidos.'
            }
          },
          {
            num: 7,
            topics: {
              'Teor√≠a': 'Colesterol y √Åcidos Nucleicos: S√≠ntesis de colesterol, estructura de ADN/ARN y replicaci√≥n.',
              'Laboratorio': 'Perfil Lip√≠dico: Determinaci√≥n de triglic√©ridos, colesterol y lipoprote√≠nas en suero.'
            }
          },
          {
            num: 8,
            topics: {
              'Teor√≠a': 'S√≠ntesis de Prote√≠nas: Transcripci√≥n y traducci√≥n. Presentaci√≥n de situaci√≥n cl√≠nica. Evaluaci√≥n Final.',
              'Laboratorio': '√Åcido √örico y ADN: Extracci√≥n de ADN y determinaci√≥n de √°cido √∫rico en suero. Evaluaci√≥n Final.'
            }
          }
        ]
      }
    };

    // Initialize SDKs
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (newConfig) => {
          config = { ...defaultConfig, ...newConfig };
          updateUI();
        },
        mapToCapabilities: (cfg) => ({
          recolorables: [
            {
              get: () => cfg.primary_color || defaultConfig.primary_color,
              set: (v) => { cfg.primary_color = v; window.elementSdk.setConfig({ primary_color: v }); }
            },
            {
              get: () => cfg.background_color || defaultConfig.background_color,
              set: (v) => { cfg.background_color = v; window.elementSdk.setConfig({ background_color: v }); }
            },
            {
              get: () => cfg.text_color || defaultConfig.text_color,
              set: (v) => { cfg.text_color = v; window.elementSdk.setConfig({ text_color: v }); }
            },
            {
              get: () => cfg.accent_color || defaultConfig.accent_color,
              set: (v) => { cfg.accent_color = v; window.elementSdk.setConfig({ accent_color: v }); }
            }
          ],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (cfg) => new Map([
          ['academy_name', cfg.academy_name || defaultConfig.academy_name],
          ['welcome_message', cfg.welcome_message || defaultConfig.welcome_message],
          ['whatsapp_number', cfg.whatsapp_number || defaultConfig.whatsapp_number]
        ])
      });
    }

    // Initialize Data SDK
    if (window.dataSdk) {
      const dataHandler = {
        onDataChanged(data) {
          allData = data;
          
          // Update schedules if on schedule page
          if (document.getElementById('schedulePage').classList.contains('hidden') === false) {
            renderSchedules();
          }
        }
      };

      window.dataSdk.init(dataHandler).then(result => {
        if (!result.isOk) {
          console.error('Failed to initialize Data SDK');
        }
      });
    }

    function updateUI() {
      const academyName = config.academy_name || defaultConfig.academy_name;
      const welcomeMessage = config.welcome_message || defaultConfig.welcome_message;
      
      document.getElementById('headerTitle').textContent = academyName;
      document.getElementById('dashboardHeaderTitle').textContent = academyName;
      document.getElementById('welcomeSubtitle').textContent = welcomeMessage;
    }

    function showPage(page) {
      document.getElementById('loginPage').classList.add('hidden');
      document.getElementById('dashboardPage').classList.add('hidden');
      document.getElementById('coursePage').classList.add('hidden');
      document.getElementById('schedulePage').classList.add('hidden');
      document.getElementById('studentsPage').classList.add('hidden');
      
      if (page === 'login') {
        document.getElementById('loginPage').classList.remove('hidden');
      } else if (page === 'dashboard') {
        document.getElementById('dashboardPage').classList.remove('hidden');
        if (currentUser) {
          document.getElementById('userName').textContent = currentUser.name;
          document.getElementById('userAvatar').textContent = currentUser.initials;
          renderDashboardCourses();
        }
      } else if (page === 'course') {
        document.getElementById('coursePage').classList.remove('hidden');
        if (currentUser) {
          document.getElementById('courseUserName').textContent = currentUser.name;
        }
      } else if (page === 'schedule') {
        document.getElementById('schedulePage').classList.remove('hidden');
      } else if (page === 'students') {
        document.getElementById('studentsPage').classList.remove('hidden');
      }
    }

    // Initialize Google Sign-In
    window.onload = function() {
      if (TEST_MODE) {
        // Show test mode buttons instead of Google Sign-In
        document.getElementById('googleSignInButton').innerHTML = '';
        document.getElementById('testModeButtons').classList.remove('hidden');
        return;
      }
      
      if (window.google && window.google.accounts) {
        google.accounts.id.initialize({
          client_id: GOOGLE_CLIENT_ID,
          callback: handleCredentialResponse
        });

        google.accounts.id.renderButton(
          document.getElementById('googleSignInButton'),
          { 
            theme: 'filled_blue', 
            size: 'large',
            width: '100%',
            text: 'signin_with',
            locale: 'es'
          }
        );
      } else {
        // Fallback si Google SDK no carga
        document.getElementById('googleSignInButton').innerHTML = `
          <div class="w-full bg-red-500/20 border border-red-500/50 rounded-xl p-4 text-center">
            <p class="text-sm text-red-300">‚ö†Ô∏è Google Sign-In no est√° disponible</p>
            <p class="text-xs text-red-400 mt-2">Por favor, configura GOOGLE_CLIENT_ID o activa TEST_MODE = true</p>
          </div>
        `;
      }
    };

    // Test Mode Login Function
    function testLogin(role) {
      if (role === 'admin') {
        currentUser = {
          name: 'Admin Test',
          email: 'admin@test.com',
          initials: 'AT',
          role: 'admin',
          enrolledCourses: ['anatomia', 'morfo1', 'morfo2', 'biologia', 'bioquimica']
        };
        document.getElementById('adminScheduleBtn').classList.remove('hidden');
        document.getElementById('adminStudentsBtn').classList.remove('hidden');
        showPage('dashboard');
      } else if (role === 'student') {
        currentUser = {
          name: 'Estudiante Prueba',
          email: 'estudiante@test.com',
          initials: 'EP',
          role: 'student',
          enrolledCourses: ['anatomia', 'morfo1'], // Solo tiene acceso a 2 cursos
          studentData: null
        };
        document.getElementById('adminScheduleBtn').classList.add('hidden');
        document.getElementById('adminStudentsBtn').classList.add('hidden');
        showPage('dashboard');
      }
    }

    async function handleCredentialResponse(response) {
      try {
        // Decode JWT token
        const userInfo = parseJwt(response.credential);
        const email = userInfo.email;
        const name = userInfo.name;

        // Check if admin
        if (ADMIN_EMAILS.includes(email)) {
          currentUser = {
            name: name,
            email: email,
            initials: name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase(),
            role: 'admin',
            enrolledCourses: ['anatomia', 'morfo1', 'morfo2', 'biologia', 'bioquimica']
          };
          document.getElementById('adminScheduleBtn').classList.remove('hidden');
          document.getElementById('adminStudentsBtn').classList.remove('hidden');
          showPage('dashboard');
          return;
        }

        // Check if student is registered
        const student = allData.find(s => s.type === 'student' && s.studentEmail === email);
        
        if (student) {
          const enrolledCourses = student.enrolledCourses ? JSON.parse(student.enrolledCourses) : [];
          currentUser = {
            name: student.studentName,
            email: student.studentEmail,
            initials: student.studentName.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase(),
            role: 'student',
            enrolledCourses: enrolledCourses,
            studentData: student
          };
          document.getElementById('adminScheduleBtn').classList.add('hidden');
          document.getElementById('adminStudentsBtn').classList.add('hidden');
          showPage('dashboard');
        } else {
          // Student not registered
          showNoAccessMessage(email);
        }
      } catch (error) {
        console.error('Error handling credential:', error);
        showErrorMessage('Error al iniciar sesi√≥n. Por favor, intenta nuevamente.');
      }
    }

    function parseJwt(token) {
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));
      return JSON.parse(jsonPayload);
    }

    function showNoAccessMessage(email) {
      const messagesDiv = document.getElementById('noviMessages');
      const noAccessMsg = document.createElement('div');
      noAccessMsg.className = 'flex gap-2';
      noAccessMsg.innerHTML = `
        <div class="w-8 h-8 rounded-full bg-gradient-to-br from-cyan-400 to-blue-500 flex items-center justify-center flex-shrink-0">
          <svg class="w-5 h-5" viewBox="0 0 64 64" fill="none">
            <ellipse cx="32" cy="36" rx="16" ry="14" fill="white"/>
            <circle cx="32" cy="20" r="10" fill="white"/>
          </svg>
        </div>
        <div class="glass-card rounded-2xl rounded-tl-none p-3 max-w-[80%]">
          <p class="text-sm">üîí El correo <strong>${email}</strong> no est√° registrado como alumno.</p>
          <p class="text-xs text-cyan-200/70 mt-2">Contacta al administrador para que te agregue a la plataforma.</p>
        </div>
      `;
      messagesDiv.appendChild(noAccessMsg);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
      toggleNoviChat();
    }

    function showErrorMessage(message) {
      const messagesDiv = document.getElementById('noviMessages');
      const errorMsg = document.createElement('div');
      errorMsg.className = 'flex gap-2';
      errorMsg.innerHTML = `
        <div class="w-8 h-8 rounded-full bg-gradient-to-br from-cyan-400 to-blue-500 flex items-center justify-center flex-shrink-0">
          <svg class="w-5 h-5" viewBox="0 0 64 64" fill="none">
            <ellipse cx="32" cy="36" rx="16" ry="14" fill="white"/>
            <circle cx="32" cy="20" r="10" fill="white"/>
          </svg>
        </div>
        <div class="glass-card rounded-2xl rounded-tl-none p-3 max-w-[80%]">
          <p class="text-sm">‚ö†Ô∏è ${message}</p>
        </div>
      `;
      messagesDiv.appendChild(errorMsg);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
      toggleNoviChat();
    }

    function handleGoogleSignIn(role) {
      // This function is now replaced by handleCredentialResponse
      // Kept for backward compatibility
    }

    function handleSignOut() {
      if (window.google && window.google.accounts) {
        google.accounts.id.disableAutoSelect();
      }
      currentUser = null;
      currentCourse = null;
      showPage('login');
      location.reload();
    }

    function showCourse(courseId) {
      // Recursos de Aprendizaje is always accessible
      if (courseId === 'recursos') {
        showResourcesCenter();
        return;
      }
      
      // Check if student has access to this course
      if (currentUser.role === 'student' && !currentUser.enrolledCourses.includes(courseId)) {
        // Show purchase option
        showPurchaseModal(courseId);
        return;
      }

      currentCourse = courseId;
      const course = coursesData[courseId];
      
      document.getElementById('courseTitle').textContent = course.title;
      document.getElementById('courseSubtitle').textContent = course.subtitle;
      
      const tabsContainer = document.getElementById('courseTabs');
      
      if (course.hasTabs && course.tabs) {
        tabsContainer.classList.remove('hidden');
        tabsContainer.innerHTML = course.tabs.map((tab, idx) => `
          <button onclick="switchTab('${tab}')" class="tab-btn px-4 py-2 rounded-lg text-sm font-medium transition-all ${idx === 0 ? 'active' : 'bg-white/5 hover:bg-white/10'}">
            ${tab}
          </button>
        `).join('');
        currentTab = course.tabs[0];
        renderWeeks(course, currentTab);
      } else {
        tabsContainer.classList.add('hidden');
        currentTab = null;
        renderWeeksSimple(course);
      }
      
      showPage('course');
    }
    
    function showResourcesCenter() {
      const course = coursesData['recursos'];
      
      document.getElementById('courseTitle').textContent = course.title;
      document.getElementById('courseSubtitle').textContent = course.subtitle;
      
      const tabsContainer = document.getElementById('courseTabs');
      tabsContainer.classList.add('hidden');
      
      const container = document.getElementById('weeksContainer');
      container.innerHTML = `
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Flashcards -->
          <div class="group glass-card rounded-2xl p-6 hover:bg-cyan-500/10 transition-all cursor-pointer" onclick="openFlashcardsSection()">
            <div class="flex items-start gap-4">
              <div class="w-16 h-16 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-500 flex items-center justify-center flex-shrink-0 group-hover:scale-110 transition-transform">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                </svg>
              </div>
              <div class="flex-1">
                <h3 class="text-xl font-bold mb-2">Flashcards</h3>
                <p class="text-cyan-200/60 text-sm mb-3">Crea y estudia con tarjetas de memoria interactivas</p>
                <ul class="text-xs text-cyan-300/50 space-y-1">
                  <li>‚Ä¢ Crea tus propias flashcards</li>
                  <li>‚Ä¢ Modo de estudio y repaso</li>
                  <li>‚Ä¢ Seguimiento de progreso</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Generador de Preguntas IA -->
          <div class="group glass-card rounded-2xl p-6 hover:bg-purple-500/10 transition-all cursor-pointer" onclick="openQuestionGeneratorSection()">
            <div class="flex items-start gap-4">
              <div class="w-16 h-16 rounded-xl bg-gradient-to-br from-purple-500 to-violet-500 flex items-center justify-center flex-shrink-0 group-hover:scale-110 transition-transform">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>
              <div class="flex-1">
                <h3 class="text-xl font-bold mb-2">Banco de Preguntas IA</h3>
                <p class="text-cyan-200/60 text-sm mb-3">Genera preguntas autom√°ticamente desde tus materiales</p>
                <ul class="text-xs text-cyan-300/50 space-y-1">
                  <li>‚Ä¢ Sube PDFs o im√°genes</li>
                  <li>‚Ä¢ Preguntas generadas por IA</li>
                  <li>‚Ä¢ Personaliza tus bancos</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Apuntes -->
          <div class="group glass-card rounded-2xl p-6 hover:bg-emerald-500/10 transition-all cursor-pointer" onclick="openNotesSection()">
            <div class="flex items-start gap-4">
              <div class="w-16 h-16 rounded-xl bg-gradient-to-br from-emerald-500 to-teal-500 flex items-center justify-center flex-shrink-0 group-hover:scale-110 transition-transform">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                </svg>
              </div>
              <div class="flex-1">
                <h3 class="text-xl font-bold mb-2">Apuntes</h3>
                <p class="text-cyan-200/60 text-sm mb-3">Crea, organiza y consulta apuntes de clase</p>
                <ul class="text-xs text-cyan-300/50 space-y-1">
                  <li>‚Ä¢ Apuntes del administrador</li>
                  <li>‚Ä¢ Crea tus propios apuntes</li>
                  <li>‚Ä¢ B√∫squeda y organizaci√≥n</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Ex√°menes -->
          <div class="group glass-card rounded-2xl p-6 hover:bg-amber-500/10 transition-all cursor-pointer" onclick="openExamsSection()">
            <div class="flex items-start gap-4">
              <div class="w-16 h-16 rounded-xl bg-gradient-to-br from-amber-500 to-orange-500 flex items-center justify-center flex-shrink-0 group-hover:scale-110 transition-transform">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                </svg>
              </div>
              <div class="flex-1">
                <h3 class="text-xl font-bold mb-2">Ex√°menes</h3>
                <p class="text-cyan-200/60 text-sm mb-3">Practica con ex√°menes anteriores y simulacros</p>
                <ul class="text-xs text-cyan-300/50 space-y-1">
                  <li>‚Ä¢ Ex√°menes anteriores</li>
                  <li>‚Ä¢ Simulacros cronometrados</li>
                  <li>‚Ä¢ Revisi√≥n de respuestas</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      `;
      
      showPage('course');
    }

    function showPurchaseModal(courseId) {
      const course = coursesData[courseId];
      const priceInfo = coursePrices[courseId];
      const today = new Date();
      const promoEndDate = priceInfo.promoEndDate ? new Date(priceInfo.promoEndDate) : null;
      const hasPromo = priceInfo.promoPrice && promoEndDate && today <= promoEndDate;
      
      const messagesDiv = document.getElementById('noviMessages');
      const purchaseMsg = document.createElement('div');
      purchaseMsg.className = 'flex gap-2';
      purchaseMsg.innerHTML = `
        <div class="w-8 h-8 rounded-full bg-gradient-to-br from-cyan-400 to-blue-500 flex items-center justify-center flex-shrink-0">
          <svg class="w-5 h-5" viewBox="0 0 64 64" fill="none">
            <ellipse cx="32" cy="36" rx="16" ry="14" fill="white"/>
            <circle cx="32" cy="20" r="10" fill="white"/>
          </svg>
        </div>
        <div class="glass-card rounded-2xl rounded-tl-none p-3 max-w-[80%]">
          <p class="text-sm font-semibold mb-2">üîí ${course.title}</p>
          <p class="text-xs text-cyan-200/70 mb-3">No est√°s matriculado en este curso.</p>
          ${hasPromo ? `
            <div class="bg-emerald-500/20 border border-emerald-500/50 rounded-lg p-2 mb-2">
              <p class="text-xs text-emerald-300 font-semibold">üéâ ¬°PROMOCI√ìN HASTA EL 6 DE FEBRERO!</p>
              <p class="text-sm text-white mt-1">
                <span class="line-through text-cyan-200/50">S/ ${priceInfo.price}</span>
                <span class="text-xl font-bold text-emerald-300 ml-2">S/ ${priceInfo.promoPrice}</span>
              </p>
            </div>
          ` : `
            <p class="text-sm text-white mb-2">Precio: <span class="text-xl font-bold text-cyan-300">S/ ${priceInfo.price}</span></p>
          `}
          <a href="https://wa.me/51${config.whatsapp_number || defaultConfig.whatsapp_number}?text=Hola%2C%20quiero%20comprar%20el%20curso%20${encodeURIComponent(course.title)}" 
             target="_blank" 
             rel="noopener noreferrer"
             class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-green-500 hover:bg-green-600 text-white text-sm font-medium transition-all">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
              <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
            </svg>
            Comprar por WhatsApp
          </a>
        </div>
      `;
      messagesDiv.appendChild(purchaseMsg);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
      toggleNoviChat();
    }

    function renderDashboardCourses() {
      const coursesContainer = document.querySelector('.grid.grid-cols-1.md\\:grid-cols-2.lg\\:grid-cols-3');
      if (!coursesContainer) return;

      const isAdmin = currentUser.role === 'admin';
      const enrolledCourses = currentUser.enrolledCourses || [];

      coursesContainer.innerHTML = Object.entries(coursesData).map(([courseId, course]) => {
        const isEnrolled = isAdmin || enrolledCourses.includes(courseId);
        const priceInfo = coursePrices[courseId];
        const today = new Date();
        const promoEndDate = priceInfo.promoEndDate ? new Date(priceInfo.promoEndDate) : null;
        const hasPromo = priceInfo.promoPrice && promoEndDate && today <= promoEndDate;

        return `
          <div class="course-card glass-card rounded-2xl overflow-hidden">
            <div class="h-40 bg-gradient-to-br ${course.color} flex items-center justify-center relative overflow-hidden">
              ${!isEnrolled ? `
                <div class="absolute top-2 right-2 px-3 py-1 rounded-full bg-black/50 backdrop-blur-sm text-xs font-medium text-white flex items-center gap-1">
                  <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
                  </svg>
                  Bloqueado
                </div>
              ` : ''}
              <div class="relative z-10 w-20 h-20 rounded-2xl bg-gradient-to-br ${course.color} flex items-center justify-center cursor-pointer" onclick="showCourseIconMenu(event, '${courseId}')">
                <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                </svg>
              </div>
              <!-- Course Icon Menu (outside the icon div) -->
              <div id="courseIconMenu-${courseId}" class="course-icon-menu hidden absolute top-52 left-1/2 transform -translate-x-1/2 mt-2 glass-card rounded-xl p-2 shadow-xl z-50 min-w-[150px]" onclick="event.stopPropagation()">
                <button onclick="viewCourseIcon('${courseId}')" class="w-full text-left px-3 py-2 rounded-lg hover:bg-white/10 text-sm flex items-center gap-2">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                  </svg>
                  Ver √çcono
                </button>
                <button class="change-icon-btn-${courseId} ${isAdmin ? '' : 'hidden'} w-full text-left px-3 py-2 rounded-lg hover:bg-white/10 text-sm flex items-center gap-2" onclick="openChangeCourseIconModal('${courseId}')">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                  </svg>
                  Cambiar √çcono
                </button>
              </div>
            </div>
            <div class="p-6">
              <h3 class="text-xl font-bold mb-2">${course.title}</h3>
              <p class="text-cyan-200/60 text-sm mb-4">${course.subtitle}</p>
              ${!isEnrolled && hasPromo ? `
                <div class="mb-3 p-2 rounded-lg bg-emerald-500/20 border border-emerald-500/50">
                  <p class="text-xs text-emerald-300 font-semibold">üéâ Promoci√≥n hasta el 6 de febrero</p>
                  <p class="text-sm mt-1">
                    <span class="line-through text-cyan-200/50">S/ ${priceInfo.price}</span>
                    <span class="text-lg font-bold text-emerald-300 ml-2">S/ ${priceInfo.promoPrice}</span>
                  </p>
                </div>
              ` : !isEnrolled ? `
                <div class="mb-3">
                  <p class="text-cyan-200/60 text-sm">Precio: <span class="text-lg font-bold text-cyan-300">S/ ${priceInfo.price}</span></p>
                </div>
              ` : ''}
              <div class="flex items-center justify-between">
                <span class="text-xs text-cyan-300/50">8 semanas</span>
                ${isEnrolled ? `
                  <button onclick="showCourse('${courseId}')" class="btn-primary px-4 py-2 rounded-lg text-sm font-medium">
                    Ver curso ‚Üí
                  </button>
                ` : `
                  <button onclick="showCourse('${courseId}')" class="bg-emerald-500 hover:bg-emerald-600 px-4 py-2 rounded-lg text-sm font-medium transition-all">
                    Comprar ‚Üí
                  </button>
                `}
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    // Students Management Functions
    function showStudentsPage() {
      showPage('students');
      renderStudents();
    }

    function renderStudents() {
      const students = allData.filter(d => d.type === 'student');
      const container = document.getElementById('studentsGrid');
      
      if (students.length === 0) {
        container.innerHTML = `
          <div class="col-span-full text-center py-12">
            <svg class="w-16 h-16 mx-auto text-cyan-400/30 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
            </svg>
            <p class="text-cyan-200/60">No hay alumnos registrados a√∫n</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = students.map(student => {
        const enrolledCourses = student.enrolledCourses ? JSON.parse(student.enrolledCourses) : [];
        const initials = student.studentName.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
        
        return `
          <div class="glass-card rounded-2xl p-5">
            <div class="flex items-start justify-between mb-4">
              <div class="flex items-center gap-3">
                <div class="w-12 h-12 rounded-full bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center text-white font-bold">
                  ${initials}
                </div>
                <div>
                  <h3 class="font-semibold">${student.studentName}</h3>
                  <p class="text-xs text-cyan-300/60">${student.studentEmail}</p>
                </div>
              </div>
              <div class="flex gap-2">
                <button onclick="openEditStudentModal('${student.__backendId}')" class="w-8 h-8 rounded-lg hover:bg-cyan-500/20 flex items-center justify-center transition-all">
                  <svg class="w-4 h-4 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                  </svg>
                </button>
                <button onclick="deleteStudent('${student.__backendId}')" class="w-8 h-8 rounded-lg hover:bg-red-500/20 flex items-center justify-center transition-all">
                  <svg class="w-4 h-4 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                  </svg>
                </button>
              </div>
            </div>
            <div class="space-y-2">
              <p class="text-xs text-cyan-300/60 font-medium">Cursos Matriculados:</p>
              ${enrolledCourses.length > 0 ? `
                <div class="flex flex-wrap gap-1">
                  ${enrolledCourses.map(courseId => {
                    const course = coursesData[courseId];
                    return `<span class="px-2 py-1 rounded-full bg-cyan-500/10 border border-cyan-500/30 text-cyan-300 text-xs">${course ? course.title : courseId}</span>`;
                  }).join('')}
                </div>
              ` : `
                <p class="text-xs text-cyan-200/40">Sin cursos asignados</p>
              `}
            </div>
          </div>
        `;
      }).join('');
    }

    function openAddStudentModal() {
      document.querySelectorAll('.course-checkbox').forEach(cb => cb.checked = false);
      openModal('addStudentModal');
    }

    async function handleAddStudent(event) {
      event.preventDefault();
      
      const btn = document.getElementById('addStudentBtnText');
      const spinner = document.getElementById('addStudentSpinner');
      
      btn.classList.add('hidden');
      spinner.classList.remove('hidden');
      
      const name = document.getElementById('studentName').value;
      const email = document.getElementById('studentEmail').value;
      const checkboxes = document.querySelectorAll('.course-checkbox:checked');
      const enrolledCourses = Array.from(checkboxes).map(cb => cb.value);
      
      await new Promise(resolve => setTimeout(resolve, 1000));
      
      const result = await window.dataSdk.create({
        type: 'student',
        studentName: name,
        studentEmail: email,
        enrolledCourses: JSON.stringify(enrolledCourses),
        uploadedBy: currentUser.email,
        uploadedAt: new Date().toISOString()
      });
      
      btn.classList.remove('hidden');
      spinner.classList.add('hidden');
      
      if (result.isOk) {
        closeModal('addStudentModal');
        document.getElementById('studentName').value = '';
        document.getElementById('studentEmail').value = '';
        renderStudents();
      }
    }

    function openEditStudentModal(backendId) {
      const student = allData.find(s => s.__backendId === backendId);
      if (!student) return;
      
      currentEditingStudent = student;
      
      document.getElementById('editStudentId').value = backendId;
      document.getElementById('editStudentName').value = student.studentName;
      document.getElementById('editStudentEmail').value = student.studentEmail;
      
      const enrolledCourses = student.enrolledCourses ? JSON.parse(student.enrolledCourses) : [];
      document.querySelectorAll('.edit-course-checkbox').forEach(cb => {
        cb.checked = enrolledCourses.includes(cb.value);
      });
      
      openModal('editStudentModal');
    }

    async function handleEditStudent(event) {
      event.preventDefault();
      
      const btn = document.getElementById('editStudentBtnText');
      const spinner = document.getElementById('editStudentSpinner');
      
      btn.classList.add('hidden');
      spinner.classList.remove('hidden');
      
      const name = document.getElementById('editStudentName').value;
      const checkboxes = document.querySelectorAll('.edit-course-checkbox:checked');
      const enrolledCourses = Array.from(checkboxes).map(cb => cb.value);
      
      await new Promise(resolve => setTimeout(resolve, 1000));
      
      const updatedStudent = {
        ...currentEditingStudent,
        studentName: name,
        enrolledCourses: JSON.stringify(enrolledCourses)
      };
      
      const result = await window.dataSdk.update(updatedStudent);
      
      btn.classList.remove('hidden');
      spinner.classList.add('hidden');
      
      if (result.isOk) {
        closeModal('editStudentModal');
        renderStudents();
      }
    }

    async function deleteStudent(backendId) {
      const student = allData.find(s => s.__backendId === backendId);
      if (!student) return;
      
      const result = await window.dataSdk.delete(student);
      if (result.isOk) {
        renderStudents();
      }
    }

    function switchTab(tab) {
      currentTab = tab;
      const course = coursesData[currentCourse];
      
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
        btn.classList.add('bg-white/5');
        if (btn.textContent.trim() === tab) {
          btn.classList.add('active');
          btn.classList.remove('bg-white/5');
        }
      });
      
      renderWeeks(course, tab);
    }

    function renderWeeks(course, tab) {
      const container = document.getElementById('weeksContainer');
      const isAdmin = currentUser && currentUser.role === 'admin';
      
      container.innerHTML = course.weeks.map(week => {
        const pdfData = allData.find(d => 
          d.type === 'pdf' && 
          d.courseId === currentCourse && 
          d.subject === tab && 
          d.weekNum === week.num
        );
        
        const recordingData = allData.find(d => 
          d.type === 'recording' && 
          d.courseId === currentCourse && 
          d.subject === tab && 
          d.weekNum === week.num
        );
        
        return `
          <div class="week-card rounded-2xl p-6">
            <div class="flex items-start justify-between gap-4 flex-wrap">
              <div class="flex-1 min-w-0">
                <div class="flex items-center gap-3 mb-3">
                  <div class="w-10 h-10 rounded-xl bg-gradient-to-br ${course.color} flex items-center justify-center text-sm font-bold flex-shrink-0">
                    ${week.num}
                  </div>
                  <h3 class="text-lg font-semibold">Semana ${week.num}</h3>
                  ${week.num === 4 || week.num === 8 ? '<span class="px-2 py-1 rounded-full bg-amber-500/20 text-amber-400 text-xs font-medium">' + (week.num === 4 ? 'Parciales' : 'Finales') + '</span>' : ''}
                </div>
                <p class="text-cyan-200/70 text-sm leading-relaxed">${week.topics[tab]}</p>
              </div>
              <div class="flex gap-2 flex-wrap">
                ${pdfData && pdfData.url ? 
                  `<a href="${pdfData.url}" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 px-4 py-2 rounded-lg bg-red-500/20 border border-red-500/50 text-red-300 text-sm hover:bg-red-500/30 transition-all">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6zm-1 2l5 5h-5V4zm-3 9h4v2h-4v-2zm0 3h4v2h-4v-2z"/>
                    </svg>
                    Ver PDF
                  </a>` :
                  `<button onclick="openPdfUpload('${currentCourse}', '${tab}', ${week.num})" class="flex items-center gap-2 px-4 py-2 rounded-lg bg-red-500/10 border border-red-500/30 text-red-400 text-sm hover:bg-red-500/20 transition-all ${!isAdmin ? 'opacity-50 cursor-not-allowed' : ''}" ${!isAdmin ? 'disabled' : ''}>
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6zm-1 2l5 5h-5V4zm-3 9h4v2h-4v-2zm0 3h4v2h-4v-2z"/>
                    </svg>
                    ${isAdmin ? 'Subir PDF' : 'Sin PDF'}
                  </button>`
                }
                ${recordingData && recordingData.url ? 
                  `<a href="${recordingData.url}" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 px-4 py-2 rounded-lg bg-purple-500/20 border border-purple-500/50 text-purple-300 text-sm hover:bg-purple-500/30 transition-all">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M8 5v14l11-7z"/>
                    </svg>
                    Ver Grabaci√≥n
                  </a>` :
                  `<button onclick="openRecordingModal('${currentCourse}', '${tab}', ${week.num})" class="flex items-center gap-2 px-4 py-2 rounded-lg bg-purple-500/10 border border-purple-500/30 text-purple-400 text-sm hover:bg-purple-500/20 transition-all ${!isAdmin ? 'opacity-50 cursor-not-allowed' : ''}" ${!isAdmin ? 'disabled' : ''}>
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M8 5v14l11-7z"/>
                    </svg>
                    ${isAdmin ? 'Agregar Grabaci√≥n' : 'Sin Grabaci√≥n'}
                  </button>`
                }
                <button onclick="openBancoModal('${currentCourse}', '${tab}', ${week.num})" class="flex items-center gap-2 px-4 py-2 rounded-lg bg-emerald-500/10 border border-emerald-500/30 text-emerald-400 text-sm hover:bg-emerald-500/20 transition-all">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                  </svg>
                  Banco
                </button>
                <button onclick="openLearningResourcesModal('${currentCourse}', '${tab}', ${week.num})" class="flex items-center gap-2 px-4 py-2 rounded-lg bg-blue-500/10 border border-blue-500/30 text-blue-400 text-sm hover:bg-blue-500/20 transition-all">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                  </svg>
                  Recursos
                </button>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    function renderWeeksSimple(course) {
      const container = document.getElementById('weeksContainer');
      const isAdmin = currentUser && currentUser.role === 'admin';
      
      container.innerHTML = course.weeks.map(week => {
        const pdfData = allData.find(d => 
          d.type === 'pdf' && 
          d.courseId === currentCourse && 
          d.weekNum === week.num
        );
        
        const recordingData = allData.find(d => 
          d.type === 'recording' && 
          d.courseId === currentCourse && 
          d.weekNum === week.num
        );
        
        return `
          <div class="week-card rounded-2xl p-6">
            <div class="flex items-start justify-between gap-4 flex-wrap">
              <div class="flex-1 min-w-0">
                <div class="flex items-center gap-3 mb-3">
                  <div class="w-10 h-10 rounded-xl bg-gradient-to-br ${course.color} flex items-center justify-center text-sm font-bold flex-shrink-0">
                    ${week.num}
                  </div>
                  <h3 class="text-lg font-semibold">Semana ${week.num}</h3>
                  ${week.num === 4 || week.num === 8 ? '<span class="px-2 py-1 rounded-full bg-amber-500/20 text-amber-400 text-xs font-medium">' + (week.num === 4 ? 'Parciales' : 'Finales') + '</span>' : ''}
                </div>
                <p class="text-cyan-200/70 text-sm leading-relaxed">${week.topic}</p>
              </div>
              <div class="flex gap-2 flex-wrap">
                ${pdfData && pdfData.url ? 
                  `<a href="${pdfData.url}" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 px-4 py-2 rounded-lg bg-red-500/20 border border-red-500/50 text-red-300 text-sm hover:bg-red-500/30 transition-all">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6zm-1 2l5 5h-5V4zm-3 9h4v2h-4v-2zm0 3h4v2h-4v-2z"/>
                    </svg>
                    Ver PDF
                  </a>` :
                  `<button onclick="openPdfUploadSimple('${currentCourse}', ${week.num})" class="flex items-center gap-2 px-4 py-2 rounded-lg bg-red-500/10 border border-red-500/30 text-red-400 text-sm hover:bg-red-500/20 transition-all ${!isAdmin ? 'opacity-50 cursor-not-allowed' : ''}" ${!isAdmin ? 'disabled' : ''}>
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6zm-1 2l5 5h-5V4zm-3 9h4v2h-4v-2zm0 3h4v2h-4v-2z"/>
                    </svg>
                    ${isAdmin ? 'Subir PDF' : 'Sin PDF'}
                  </button>`
                }
                ${recordingData && recordingData.url ? 
                  `<a href="${recordingData.url}" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 px-4 py-2 rounded-lg bg-purple-500/20 border border-purple-500/50 text-purple-300 text-sm hover:bg-purple-500/30 transition-all">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M8 5v14l11-7z"/>
                    </svg>
                    Ver Grabaci√≥n
                  </a>` :
                  `<button onclick="openRecordingModalSimple('${currentCourse}', ${week.num})" class="flex items-center gap-2 px-4 py-2 rounded-lg bg-purple-500/10 border border-purple-500/30 text-purple-400 text-sm hover:bg-purple-500/20 transition-all ${!isAdmin ? 'opacity-50 cursor-not-allowed' : ''}" ${!isAdmin ? 'disabled' : ''}>
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M8 5v14l11-7z"/>
                    </svg>
                    ${isAdmin ? 'Agregar Grabaci√≥n' : 'Sin GrabaciÔøΩÔøΩn'}
                  </button>`
                }
                <button onclick="openBancoModalSimple('${currentCourse}', ${week.num})" class="flex items-center gap-2 px-4 py-2 rounded-lg bg-emerald-500/10 border border-emerald-500/30 text-emerald-400 text-sm hover:bg-emerald-500/20 transition-all">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                  </svg>
                  Banco
                </button>
                <button onclick="openLearningResourcesModalSimple('${currentCourse}', ${week.num})" class="flex items-center gap-2 px-4 py-2 rounded-lg bg-blue-500/10 border border-blue-500/30 text-blue-400 text-sm hover:bg-blue-500/20 transition-all">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                  </svg>
                  Recursos
                </button>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    function openPdfUploadSimple(courseId, weekNum) {
      if (!currentUser || currentUser.role !== 'admin') return;
      currentUploadContext = { courseId, subject: null, weekNum, type: 'pdf' };
      openModal('uploadPdfModal');
    }

    function openRecordingModalSimple(courseId, weekNum) {
      if (!currentUser || currentUser.role !== 'admin') return;
      currentUploadContext = { courseId, subject: null, weekNum, type: 'recording' };
      openModal('addRecordingModal');
    }

    function openBancoModalSimple(courseId, weekNum) {
      currentUploadContext = { courseId, subject: null, weekNum, type: 'banco' };
      openModal('bancoModal');
    }

    // Modal Functions
    function openModal(modalId) {
      document.getElementById(modalId).classList.add('show');
    }

    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('show');
    }

    function openPdfUpload(courseId, subject, weekNum) {
      if (!currentUser || currentUser.role !== 'admin') return;
      
      currentUploadContext = { courseId, subject, weekNum, type: 'pdf' };
      openModal('uploadPdfModal');
    }

    function openRecordingModal(courseId, subject, weekNum) {
      if (!currentUser || currentUser.role !== 'admin') return;
      
      currentUploadContext = { courseId, subject, weekNum, type: 'recording' };
      openModal('addRecordingModal');
    }

    function openBancoModal(courseId, subject, weekNum) {
      currentUploadContext = { courseId, subject, weekNum, type: 'banco' };
      openModal('bancoModal');
    }

    async function handlePdfUpload(event) {
      event.preventDefault();
      
      const btn = document.getElementById('uploadPdfBtnText');
      const spinner = document.getElementById('uploadPdfSpinner');
      const fileInput = document.getElementById('pdfFile');
      
      btn.classList.add('hidden');
      spinner.classList.remove('hidden');
      
      // Simulate file upload
      await new Promise(resolve => setTimeout(resolve, 1500));
      
      const file = fileInput.files[0];
      const fakeUrl = `https://storage.neurova.com/pdfs/${currentUploadContext.courseId}/${currentUploadContext.subject}/week${currentUploadContext.weekNum}.pdf`;
      
      const result = await window.dataSdk.create({
        type: 'pdf',
        courseId: currentUploadContext.courseId,
        subject: currentUploadContext.subject,
        weekNum: currentUploadContext.weekNum,
        contentType: 'application/pdf',
        url: fakeUrl,
        fileName: file.name,
        uploadedBy: currentUser.email,
        uploadedAt: new Date().toISOString()
      });
      
      btn.classList.remove('hidden');
      spinner.classList.add('hidden');
      
      if (result.isOk) {
        closeModal('uploadPdfModal');
        fileInput.value = '';
        showCourse(currentCourse);
      }
    }

    async function handleRecordingSubmit(event) {
      event.preventDefault();
      
      const btn = document.getElementById('addRecordingBtnText');
      const spinner = document.getElementById('addRecordingSpinner');
      const urlInput = document.getElementById('recordingUrl');
      
      btn.classList.add('hidden');
      spinner.classList.remove('hidden');
      
      await new Promise(resolve => setTimeout(resolve, 1000));
      
      const result = await window.dataSdk.create({
        type: 'recording',
        courseId: currentUploadContext.courseId,
        subject: currentUploadContext.subject,
        weekNum: currentUploadContext.weekNum,
        contentType: 'video/link',
        url: urlInput.value,
        fileName: 'Grabaci√≥n de clase',
        uploadedBy: currentUser.email,
        uploadedAt: new Date().toISOString()
      });
      
      btn.classList.remove('hidden');
      spinner.classList.add('hidden');
      
      if (result.isOk) {
        closeModal('addRecordingModal');
        urlInput.value = '';
        showCourse(currentCourse);
      }
    }

    function openCreateFormModal() {
      closeModal('bancoModal');
      openModal('createFormModal');
    }

    async function handleCreateForm(event) {
      event.preventDefault();
      
      const btn = document.getElementById('createFormBtnText');
      const spinner = document.getElementById('createFormSpinner');
      const titleInput = document.getElementById('formTitle');
      const questionsInput = document.getElementById('formQuestions');
      
      btn.classList.add('hidden');
      spinner.classList.remove('hidden');
      
      await new Promise(resolve => setTimeout(resolve, 1000));
      
      const result = await window.dataSdk.create({
        type: 'form',
        courseId: currentUploadContext.courseId,
        subject: currentUploadContext.subject,
        weekNum: currentUploadContext.weekNum,
        formTitle: titleInput.value,
        formQuestions: questionsInput.value,
        uploadedBy: currentUser.email,
        uploadedAt: new Date().toISOString()
      });
      
      btn.classList.remove('hidden');
      spinner.classList.add('hidden');
      
      if (result.isOk) {
        closeModal('createFormModal');
        titleInput.value = '';
        questionsInput.value = '';
        
        // Show success message
        const messagesDiv = document.getElementById('noviMessages');
        const successMsg = document.createElement('div');
        successMsg.className = 'flex gap-2';
        successMsg.innerHTML = `
          <div class="w-8 h-8 rounded-full bg-gradient-to-br from-cyan-400 to-blue-500 flex items-center justify-center flex-shrink-0">
            <svg class="w-5 h-5" viewBox="0 0 64 64" fill="none">
              <ellipse cx="32" cy="36" rx="16" ry="14" fill="white"/>
              <circle cx="32" cy="20" r="10" fill="white"/>
            </svg>
          </div>
          <div class="glass-card rounded-2xl rounded-tl-none p-3 max-w-[80%]">
            <p class="text-sm">‚úÖ ¬°Formulario creado exitosamente!</p>
          </div>
        `;
        messagesDiv.appendChild(successMsg);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
      }
    }

    function viewFormsList() {
      const forms = allData.filter(d => d.type === 'form' && d.courseId === currentUploadContext.courseId);
      
      closeModal('bancoModal');
      
      const messagesDiv = document.getElementById('noviMessages');
      const formsMsg = document.createElement('div');
      formsMsg.className = 'flex gap-2';
      formsMsg.innerHTML = `
        <div class="w-8 h-8 rounded-full bg-gradient-to-br from-cyan-400 to-blue-500 flex items-center justify-center flex-shrink-0">
          <svg class="w-5 h-5" viewBox="0 0 64 64" fill="none">
            <ellipse cx="32" cy="36" rx="16" ry="14" fill="white"/>
            <circle cx="32" cy="20" r="10" fill="white"/>
          </svg>
        </div>
        <div class="glass-card rounded-2xl rounded-tl-none p-3 max-w-[80%]">
          <p class="text-sm font-semibold mb-2">ÔøΩÔøΩÔøΩÔøΩÔøΩ Formularios disponibles:</p>
          ${forms.length > 0 ? 
            forms.map(f => `<p class="text-xs text-cyan-200/70">ÔøΩÔøΩ ${f.formTitle}</p>`).join('') :
            '<p class="text-xs text-cyan-200/70">No hay formularios creados a√∫n.</p>'
          }
        </div>
      `;
      messagesDiv.appendChild(formsMsg);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
      
      toggleNoviChat();
    }

    function viewStudentResponses() {
      const responses = allData.filter(d => d.type === 'response');
      
      closeModal('bancoModal');
      
      const messagesDiv = document.getElementById('noviMessages');
      const responsesMsg = document.createElement('div');
      responsesMsg.className = 'flex gap-2';
      responsesMsg.innerHTML = `
        <div class="w-8 h-8 rounded-full bg-gradient-to-br from-cyan-400 to-blue-500 flex items-center justify-center flex-shrink-0">
          <svg class="w-5 h-5" viewBox="0 0 64 64" fill="none">
            <ellipse cx="32" cy="36" rx="16" ry="14" fill="white"/>
            <circle cx="32" cy="20" r="10" fill="white"/>
          </svg>
        </div>
        <div class="glass-card rounded-2xl rounded-tl-none p-3 max-w-[80%]">
          <p class="text-sm font-semibold mb-2">üìä Respuestas de estudiantes:</p>
          ${responses.length > 0 ? 
            responses.map(r => `<p class="text-xs text-cyan-200/70">‚Ä¢ ${r.studentName}: ${r.score || 'Sin calificar'}</p>`).join('') :
            '<p class="text-xs text-cyan-200/70">No hay respuestas enviadas a√∫n.</p>'
          }
        </div>
      `;
      messagesDiv.appendChild(responsesMsg);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
      
      toggleNoviChat();
    }

    // Schedule Functions
    function showSchedulePage() {
      showPage('schedule');
      renderSchedules();
    }

    function openAddScheduleModal() {
      openModal('addScheduleModal');
    }

    async function handleAddSchedule(event) {
      event.preventDefault();
      
      const btn = document.getElementById('addScheduleBtnText');
      const spinner = document.getElementById('addScheduleSpinner');
      
      btn.classList.add('hidden');
      spinner.classList.remove('hidden');
      
      await new Promise(resolve => setTimeout(resolve, 1000));
      
      const result = await window.dataSdk.create({
        type: 'schedule',
        scheduleDay: document.getElementById('scheduleDay').value,
        scheduleTime: document.getElementById('scheduleTime').value,
        scheduleCourse: document.getElementById('scheduleCourse').value,
        scheduleType: document.getElementById('scheduleType').value,
        scheduleRoom: document.getElementById('scheduleRoom').value || '',
        uploadedBy: currentUser.email,
        uploadedAt: new Date().toISOString()
      });
      
      btn.classList.remove('hidden');
      spinner.classList.add('hidden');
      
      if (result.isOk) {
        closeModal('addScheduleModal');
        document.getElementById('scheduleDay').value = 'Lunes';
        document.getElementById('scheduleTime').value = '';
        document.getElementById('scheduleCourse').value = '';
        document.getElementById('scheduleType').value = 'Clase';
        document.getElementById('scheduleRoom').value = '';
        renderSchedules();
      }
    }

    function renderSchedules() {
      const schedules = allData.filter(d => d.type === 'schedule');
      const container = document.getElementById('scheduleGrid');
      
      if (schedules.length === 0) {
        container.innerHTML = `
          <div class="col-span-full text-center py-12">
            <svg class="w-16 h-16 mx-auto text-cyan-400/30 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
            </svg>
            <p class="text-cyan-200/60">No hay horarios registrados a√∫n</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = schedules.map(schedule => {
        const typeColors = {
          'Clase': 'from-blue-500 to-cyan-500',
          'Laboratorio': 'from-purple-500 to-violet-500',
          'Tutor√≠a': 'from-emerald-500 to-teal-500',
          'Examen': 'from-rose-500 to-orange-500'
        };
        
        return `
          <div class="glass-card rounded-2xl p-5">
            <div class="flex items-start justify-between mb-3">
              <div class="flex-1">
                <div class="flex items-center gap-2 mb-2">
                  <div class="w-10 h-10 rounded-xl bg-gradient-to-br ${typeColors[schedule.scheduleType] || 'from-gray-500 to-gray-600'} flex items-center justify-center">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                  </div>
                  <div>
                    <h3 class="font-semibold text-sm">${schedule.scheduleCourse}</h3>
                    <p class="text-xs text-cyan-300/60">${schedule.scheduleType}</p>
                  </div>
                </div>
              </div>
              ${currentUser && currentUser.role === 'admin' ? 
                `<button onclick="deleteSchedule('${schedule.__backendId}')" class="w-8 h-8 rounded-lg hover:bg-red-500/20 flex items-center justify-center transition-all">
                  <svg class="w-4 h-4 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                  </svg>
                </button>` : ''
              }
            </div>
            <div class="space-y-2">
              <div class="flex items-center gap-2 text-sm">
                <svg class="w-4 h-4 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
                <span class="text-cyan-200/70">${schedule.scheduleDay}</span>
              </div>
              <div class="flex items-center gap-2 text-sm">
                <svg class="w-4 h-4 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span class="text-cyan-200/70">${schedule.scheduleTime}</span>
              </div>
              ${schedule.scheduleRoom ? 
                `<div class="flex items-center gap-2 text-sm">
                  <svg class="w-4 h-4 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                  </svg>
                  <span class="text-cyan-200/70">${schedule.scheduleRoom}</span>
                </div>` : ''
              }
            </div>
          </div>
        `;
      }).join('');
    }

    async function deleteSchedule(backendId) {
      const schedule = allData.find(d => d.__backendId === backendId);
      if (!schedule) return;
      
      const result = await window.dataSdk.delete(schedule);
      if (result.isOk) {
        renderSchedules();
      }
    }

    // NOVI Chat Functions
    function toggleNoviChat() {
      const window = document.getElementById('noviWindow');
      window.classList.toggle('show');
    }

    function sendNoviMessage(event) {
      event.preventDefault();
      const input = document.getElementById('noviInput');
      const message = input.value.trim();
      
      if (!message) return;
      
      askNovi(message);
      input.value = '';
    }

    function askNovi(question) {
      const messagesDiv = document.getElementById('noviMessages');
      
      // User message
      const userMsg = document.createElement('div');
      userMsg.className = 'flex gap-2 justify-end';
      userMsg.innerHTML = `
        <div class="bg-cyan-500/20 rounded-2xl rounded-tr-none p-3 max-w-[80%]">
          <p class="text-sm">${question}</p>
        </div>
      `;
      messagesDiv.appendChild(userMsg);
      
      // NOVI response
      setTimeout(() => {
        const response = getNoviResponse(question);
        const noviMsg = document.createElement('div');
        noviMsg.className = 'flex gap-2';
        noviMsg.innerHTML = `
          <div class="w-8 h-8 rounded-full bg-gradient-to-br from-cyan-400 to-blue-500 flex items-center justify-center flex-shrink-0">
            <svg class="w-5 h-5" viewBox="0 0 64 64" fill="none">
              <ellipse cx="32" cy="36" rx="16" ry="14" fill="white"/>
              <circle cx="32" cy="20" r="10" fill="white"/>
              <circle cx="28" cy="18" r="1.5" fill="#1F2937"/>
              <circle cx="36" cy="18" r="1.5" fill="#1F2937"/>
            </svg>
          </div>
          <div class="glass-card rounded-2xl rounded-tl-none p-3 max-w-[80%]">
            <p class="text-sm">${response}</p>
          </div>
        `;
        messagesDiv.appendChild(noviMsg);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
      }, 500);
      
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    function getNoviResponse(question) {
      const q = question.toLowerCase();
      
      if (q.includes('naveg') || q.includes('usar') || q.includes('inicio')) {
        return 'üß≠ Para navegar: Desde el inicio, ver√°s todos tus cursos disponibles. Haz clic en "Ver curso" para acceder al material de cada semana. Usa las pestaÔøΩÔøΩas para cambiar entre materias (Anatom√≠a, Fisiolog√≠a, etc.).';
      }
      
      if (q.includes('material') || q.includes('pdf') || q.includes('grabaci√≥n') || q.includes('grabacion')) {
        return 'üìö Los materiales se organizan por semana. Cada semana tiene 3 botones: <br/>‚Ä¢ <strong>PDF</strong>: Material de lectura<br/>‚Ä¢ <strong>Grabaci√≥n</strong>: Video de la clase<br/>‚Ä¢ <strong>Banco</strong>: Preguntas de pr√°ctica';
      }
      
      if (q.includes('horario') || q.includes('clase')) {
        if (currentUser && currentUser.role === 'admin') {
          return 'üïê Como administrador, puedes gestionar horarios desde el bot√≥n "Horarios" en el menÔøΩÔøΩ principal. Ah√≠ puedes agregar, ver y eliminar horarios de clases.';
        }
        return 'üïê Para ver los horarios de tus clases, contacta con tu administrador. Pr√≥ximamente los estudiantes podr√°n ver sus horarios directamente en la plataforma.';
      }
      
      if (q.includes('admin') || q.includes('subir')) {
        if (currentUser && currentUser.role === 'admin') {
          return 'üë®‚Äçüíº Como administrador puedes:<br/>‚Ä¢ Subir PDFs haciendo clic en "Subir PDF"<br/>‚Ä¢ Agregar enlaces de grabaciones<br/>‚Ä¢ Crear formularios de evaluaci√≥n<br/>‚Ä¢ Gestionar horarios de clases';
        }
        return 'üë®‚Äçüíº Solo los administradores pueden subir materiales. Si necesitas algo, contacta con el administrador de tu academia.';
      }
      
      if (q.includes('banco') || q.includes('formulario') || q.includes('pregunta')) {
        return 'üìù El Banco de Preguntas permite:<br/>‚Ä¢ Ver formularios disponibles<br/>‚Ä¢ Responder cuestionarios<br/>‚Ä¢ (Admin) Crear nuevos formularios<br/>‚Ä¢ (Admin) Ver respuestas de estudiantes';
      }
      
      if (q.includes('ayuda') || q.includes('help') || q.includes('hola')) {
        return 'üëã ¬°Hola! Soy NOVI, tu asistente virtual. Puedo ayudarte con:<br/>‚Ä¢ Navegaci√≥n en la plataforma<br/>‚Ä¢ Acceso a materiales<br/>‚Ä¢ Informaci√≥n sobre horarios<br/>‚Ä¢ Funciones de administrador<br/>¬øEn qu√© puedo ayudarte?';
      }
      
      return 'ü§î Interesante pregunta. Intenta preguntar sobre: navegaci√≥n, materiales, horarios, funciones de administrador, o el banco de preguntas. ¬°Estoy aqu√≠ para ayudarte!';
    }

    // Advanced AI System for Content Analysis
    class MedicalAI {
      constructor() {
        this.knowledgeBase = {
          anatomia: ['estructura corporal', '√≥rganos', 'sistemas', 'm√∫sculos', 'huesos', 'tejidos', 'anatom√≠a topogr√°fica'],
          fisiologia: ['funci√≥n', 'homeostasis', 'metabolismo', 'sistema nervioso', 'cardiovascular', 'respiratorio'],
          bioquimica: ['mol√©culas', 'enzimas', 'metabolismo', 'prote√≠nas', 'l√≠pidos', 'carbohidratos', 'reacciones'],
          histologia: ['c√©lulas', 'tejidos', 'microscop√≠a', 'organelas', 'matriz extracelular']
        };
      }
      
      // Extract text from PDF (simulated)
      async extractTextFromPDF(file) {
        return new Promise((resolve) => {
          setTimeout(() => {
            resolve(`Contenido m√©dico extra√≠do: Anatom√≠a del coraz√≥n, sistema cardiovascular, 
            estructura de las v√°lvulas card√≠acas, circulaci√≥n sangu√≠nea, funci√≥n de bombeo, 
            s√≠stole y di√°stole, electrocardiograma, ciclo card√≠aco completo, gasto card√≠aco, 
            presi√≥n arterial, regulaci√≥n auton√≥mica del coraz√≥n.`);
          }, 1500);
        });
      }
      
      // Extract text from YouTube (simulated)
      async extractTextFromYouTube(url) {
        return new Promise((resolve) => {
          setTimeout(() => {
            resolve(`Transcripci√≥n del video: El sistema cardiovascular es fundamental para la vida. 
            El coraz√≥n funciona como una bomba que impulsa la sangre. La anatom√≠a card√≠aca incluye 
            cuatro c√°maras: dos aur√≠culas superiores y dos ventr√≠culos inferiores. El ciclo card√≠aco 
            se divide en s√≠stole (contracci√≥n) y di√°stole (relajaci√≥n). La hemodinamia estudia el 
            flujo sangu√≠neo y sus propiedades f√≠sicas.`);
          }, 2000);
        });
      }
      
      // Advanced AI Content Analysis
      analyzeContent(text, subject) {
        const keywords = this.extractKeywords(text, subject);
        const concepts = this.identifyConcepts(text, keywords);
        const relationships = this.findConceptRelationships(concepts);
        
        return {
          keywords,
          concepts,
          relationships,
          mainTopics: this.identifyMainTopics(concepts),
          complexity: this.assessComplexity(text)
        };
      }
      
      extractKeywords(text, subject) {
        const words = text.toLowerCase().split(/\s+/);
        const subjectKeywords = this.knowledgeBase[subject] || [];
        const keywords = new Set();
        
        words.forEach(word => {
          if (word.length > 5) keywords.add(word);
          subjectKeywords.forEach(key => {
            if (word.includes(key)) keywords.add(word);
          });
        });
        
        return Array.from(keywords).slice(0, 15);
      }
      
      identifyConcepts(text, keywords) {
        const concepts = [];
        const medicalTerms = {
          'coraz√≥n': { type: '√≥rgano', system: 'cardiovascular', importance: 'alto' },
          'v√°lvula': { type: 'estructura', system: 'cardiovascular', importance: 'medio' },
          's√≠stole': { type: 'proceso', system: 'cardiovascular', importance: 'alto' },
          'hemodinamia': { type: 'concepto', system: 'cardiovascular', importance: 'alto' },
          'metabolismo': { type: 'proceso', system: 'bioqu√≠mico', importance: 'alto' },
          'enzima': { type: 'mol√©cula', system: 'bioqu√≠mico', importance: 'alto' }
        };
        
        keywords.forEach(keyword => {
          Object.keys(medicalTerms).forEach(term => {
            if (keyword.includes(term)) {
              concepts.push({ term, ...medicalTerms[term] });
            }
          });
        });
        
        return concepts;
      }
      
      findConceptRelationships(concepts) {
        const relationships = [];
        for (let i = 0; i < concepts.length; i++) {
          for (let j = i + 1; j < concepts.length; j++) {
            if (concepts[i].system === concepts[j].system) {
              relationships.push({
                concept1: concepts[i].term,
                concept2: concepts[j].term,
                type: 'related_system'
              });
            }
          }
        }
        return relationships;
      }
      
      identifyMainTopics(concepts) {
        const topics = {};
        concepts.forEach(concept => {
          if (!topics[concept.system]) {
            topics[concept.system] = [];
          }
          topics[concept.system].push(concept.term);
        });
        return topics;
      }
      
      assessComplexity(text) {
        const words = text.split(/\s+/).length;
        const sentences = text.split(/[.!?]+/).length;
        const avgWordsPerSentence = words / sentences;
        
        if (avgWordsPerSentence > 20) return 'avanzado';
        if (avgWordsPerSentence > 12) return 'intermedio';
        return 'b√°sico';
      }
      
      // Generate AI Flashcards
      generateFlashcards(analysis, quantity, difficulty) {
        const numCards = quantity === 'few' ? 5 : quantity === 'necessary' ? 10 : 15;
        const cards = [];
        
        const difficultyTemplates = {
          easy: [
            { template: '¬øQu√© es {term}?', answerType: 'definition' },
            { template: '¬øCu√°l es la funci√≥n principal de {term}?', answerType: 'function' },
            { template: 'Define {term}', answerType: 'definition' }
          ],
          medium: [
            { template: '¬øC√≥mo se relaciona {term1} con {term2}?', answerType: 'relationship' },
            { template: 'Explica el proceso de {term}', answerType: 'process' },
            { template: '¬øQu√© importancia tiene {term} en el sistema {system}?', answerType: 'importance' }
          ],
          hard: [
            { template: 'Analiza cr√≠ticamente la interacci√≥n entre {term1} y {term2} en el contexto de {system}', answerType: 'critical_analysis' },
            { template: 'Compara y contrasta {term1} con {term2} desde una perspectiva fisiopatol√≥gica', answerType: 'comparison' },
            { template: 'Explica los mecanismos moleculares que regulan {term}', answerType: 'mechanism' }
          ]
        };
        
        const templates = difficultyTemplates[difficulty] || difficultyTemplates.medium;
        const concepts = analysis.concepts;
        
        for (let i = 0; i < numCards && i < concepts.length; i++) {
          const template = templates[i % templates.length];
          const concept = concepts[i];
          
          let question = template.template
            .replace('{term}', concept.term)
            .replace('{term1}', concept.term)
            .replace('{system}', concept.system);
          
          if (concepts[i + 1]) {
            question = question.replace('{term2}', concepts[i + 1].term);
          }
          
          const answer = this.generateAnswer(concept, template.answerType, difficulty, concepts);
          
          cards.push({ question, answer, concept: concept.term, difficulty });
        }
        
        return cards;
      }
      
      generateAnswer(concept, answerType, difficulty, allConcepts) {
        const answers = {
          definition: {
            easy: `${concept.term} es un ${concept.type} del sistema ${concept.system} fundamental en medicina.`,
            medium: `${concept.term} es un ${concept.type} clave que forma parte del sistema ${concept.system}. Su comprensi√≥n es esencial para entender los procesos fisiol√≥gicos relacionados.`,
            hard: `${concept.term} representa un ${concept.type} complejo dentro del sistema ${concept.system}, caracterizado por m√∫ltiples interacciones moleculares y regulaciones a nivel celular que determinan su funci√≥n espec√≠fica en el organismo.`
          },
          function: {
            easy: `La funci√≥n principal es mantener el equilibrio del sistema ${concept.system}.`,
            medium: `Desempe√±a un rol crucial en la regulaci√≥n y coordinaci√≥n de procesos dentro del sistema ${concept.system}, interactuando con otros componentes.`,
            hard: `Participa activamente en cascadas de se√±alizaci√≥n complejas, mediando respuestas adaptativas y homeost√°ticas a trav√©s de mecanismos de retroalimentaci√≥n en el sistema ${concept.system}.`
          },
          relationship: {
            medium: `Ambos elementos est√°n interconectados dentro del sistema ${concept.system}, donde uno regula o complementa la funci√≥n del otro.`,
            hard: `Existe una relaci√≥n sin√©rgica compleja mediada por se√±ales bioqu√≠micas, donde la modulaci√≥n de uno afecta directamente la expresi√≥n y funci√≥n del otro en el contexto del sistema ${concept.system}.`
          },
          critical_analysis: {
            hard: `La interacci√≥n presenta m√∫ltiples niveles de regulaci√≥n: a nivel molecular, celular y sist√©mico. Los mecanismos incluyen se√±alizaci√≥n autocrina/paracrina, modulaci√≥n alost√©rica y cambios conformacionales que optimizan la respuesta fisiol√≥gica en el sistema ${concept.system}.`
          }
        };
        
        return answers[answerType]?.[difficulty] || answers.definition[difficulty] || answers.definition.medium;
      }
      
      // Generate AI Questions
      generateQuestions(analysis, quantity, difficulty) {
        const numQuestions = quantity === 'few' ? 5 : quantity === 'necessary' ? 10 : 15;
        const questions = [];
        
        const questionTypes = {
          easy: [
            { type: 'identification', weight: 0.4 },
            { type: 'definition', weight: 0.4 },
            { type: 'simple_function', weight: 0.2 }
          ],
          medium: [
            { type: 'mechanism', weight: 0.3 },
            { type: 'relationship', weight: 0.3 },
            { type: 'application', weight: 0.4 }
          ],
          hard: [
            { type: 'integration', weight: 0.3 },
            { type: 'clinical_reasoning', weight: 0.4 },
            { type: 'critical_thinking', weight: 0.3 }
          ]
        };
        
        const concepts = analysis.concepts;
        const types = questionTypes[difficulty] || questionTypes.medium;
        
        for (let i = 0; i < numQuestions && concepts.length > 0; i++) {
          const concept = concepts[i % concepts.length];
          const questionType = types[i % types.length];
          
          const question = this.createQuestion(concept, concepts, questionType.type, difficulty);
          questions.push(question);
        }
        
        return questions;
      }
      
      createQuestion(concept, allConcepts, type, difficulty) {
        const templates = {
          identification: {
            easy: {
              question: `¬øCu√°l de las siguientes opciones describe correctamente a ${concept.term}?`,
              correct: `Un ${concept.type} del sistema ${concept.system}`,
              distractors: [
                `Un proceso celular independiente`,
                `Una estructura del sistema digestivo`,
                `Un neurotransmisor espec√≠fico`
              ]
            }
          },
          mechanism: {
            medium: {
              question: `¬øQu√© mecanismo explica el funcionamiento de ${concept.term} en el sistema ${concept.system}?`,
              correct: `Regulaci√≥n mediante se√±ales bioqu√≠micas y retroalimentaci√≥n`,
              distractors: [
                `Difusi√≥n pasiva simple sin control`,
                `√önicamente por gradiente de concentraci√≥n`,
                `Proceso aleatorio sin regulaci√≥n`
              ]
            }
          },
          clinical_reasoning: {
            hard: {
              question: `Un paciente presenta alteraci√≥n en ${concept.term}. ¬øCu√°l ser√≠a el abordaje fisiopatol√≥gico m√°s apropiado considerando el sistema ${concept.system}?`,
              correct: `Evaluar cascadas de se√±alizaci√≥n, compensaciones fisiol√≥gicas y efectos sist√©micos integrales`,
              distractors: [
                `Observar √∫nicamente s√≠ntomas superficiales`,
                `Aplicar tratamiento sintom√°tico gen√©rico`,
                `Ignorar interacciones con otros sistemas`
              ]
            }
          }
        };
        
        const template = templates[type]?.[difficulty] || templates.identification.easy;
        const allOptions = [template.correct, ...template.distractors];
        const shuffled = allOptions.sort(() => Math.random() - 0.5);
        const correctIndex = shuffled.indexOf(template.correct);
        
        return {
          question: template.question,
          options: shuffled,
          correct: correctIndex,
          explanation: this.generateExplanation(concept, type, difficulty),
          difficulty,
          concept: concept.term
        };
      }
      
      generateExplanation(concept, type, difficulty) {
        const explanations = {
          easy: `${concept.term} es fundamental en el sistema ${concept.system}. Su comprensi√≥n es esencial para entender procesos b√°sicos.`,
          medium: `${concept.term} participa en m√∫ltiples procesos regulados del sistema ${concept.system}. Su disfunci√≥n puede afectar el equilibrio homeost√°tico.`,
          hard: `${concept.term} integra se√±ales complejas en el sistema ${concept.system}, con implicaciones cl√≠nicas significativas. La comprensi√≥n de sus mecanismos moleculares y celulares es crucial para el razonamiento cl√≠nico avanzado y el desarrollo de estrategias terap√©uticas dirigidas.`
        };
        
        return explanations[difficulty] || explanations.medium;
      }
    }
    
    // Initialize AI System
    const medicalAI = new MedicalAI();

    // Learning Resources Section Functions
    let currentFlashcardSet = [];
    let currentFlashcardIndex = 0;
    let flashcardResults = { correct: 0, incorrect: 0 };
    let isFlashcardFlipped = false;
    
    function openFlashcardsSection() {
      closeModal('learningResourcesModal');
      openModal('flashcardImportModal');
    }
    
    async function handleFlashcardImport(event) {
      event.preventDefault();
      
      const btn = document.getElementById('flashcardImportBtn');
      const spinner = document.getElementById('flashcardImportSpinner');
      const fileInput = document.getElementById('flashcardFile');
      const quantity = document.getElementById('flashcardQuantity').value;
      const difficulty = document.getElementById('flashcardDifficulty').value;
      
      btn.classList.add('hidden');
      spinner.classList.remove('hidden');
      
      // Extract content from uploaded file
      let extractedText = '';
      const file = fileInput.files[0];
      
      if (file) {
        if (file.type === 'application/pdf') {
          extractedText = await medicalAI.extractTextFromPDF(file);
        } else {
          // For images, simulated OCR
          extractedText = await new Promise(resolve => {
            setTimeout(() => resolve('Contenido extra√≠do de imagen m√©dica con t√©rminos anat√≥micos relevantes.'), 1500);
          });
        }
      }
      
      // AI Analysis
      const subject = currentUploadContext?.courseId || 'anatomia';
      const analysis = medicalAI.analyzeContent(extractedText, subject);
      
      // Generate AI-powered flashcards
      currentFlashcardSet = medicalAI.generateFlashcards(analysis, quantity, difficulty);
      currentFlashcardIndex = 0;
      flashcardResults = { correct: 0, incorrect: 0 };
      isFlashcardFlipped = false;
      
      // Save to database
      await window.dataSdk.create({
        type: 'ai_flashcards',
        sourceContent: extractedText,
        sourceType: 'pdf',
        aiGeneratedContent: JSON.stringify(currentFlashcardSet),
        difficulty: difficulty,
        quantity: currentFlashcardSet.length,
        uploadedBy: currentUser.email,
        uploadedAt: new Date().toISOString()
      });
      
      btn.classList.remove('hidden');
      spinner.classList.add('hidden');
      
      closeModal('flashcardImportModal');
      fileInput.value = '';
      openModal('flashcardStudyModal');
      renderFlashcard();
    }
    
    function renderFlashcard() {
      const card = currentFlashcardSet[currentFlashcardIndex];
      const container = document.getElementById('flashcardContainer');
      const counter = document.getElementById('flashcardCounter');
      
      counter.textContent = `${currentFlashcardIndex + 1} / ${currentFlashcardSet.length}`;
      isFlashcardFlipped = false;
      
      container.innerHTML = `
        <div class="flashcard-wrapper" onclick="handleFlashcardClick(event)">
          <div class="flashcard ${isFlashcardFlipped ? 'flipped' : ''}">
            <div class="flashcard-front">
              <div class="text-center">
                <div class="text-6xl mb-6">ü§î</div>
                <p class="text-xl font-semibold">${card.question}</p>
              </div>
            </div>
            <div class="flashcard-back hidden">
              <div class="text-center">
                <div class="text-6xl mb-6">‚úÖ</div>
                <p class="text-lg text-cyan-200/80 mb-4">${card.question}</p>
                <div class="bg-cyan-500/20 rounded-xl p-4 border border-cyan-500/30">
                  <p class="text-base font-semibold">${card.answer}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }
    
    function handleFlashcardClick(event) {
      const rect = event.currentTarget.getBoundingClientRect();
      const x = event.clientX - rect.left;
      const width = rect.width;
      const clickPosition = x / width;
      
      // Click en el centro (33%-66%) = voltear
      if (clickPosition > 0.33 && clickPosition < 0.66) {
        flipFlashcard();
      }
      // Click a la izquierda (<33%) = anterior
      else if (clickPosition <= 0.33 && currentFlashcardIndex > 0) {
        previousFlashcard();
      }
      // Click a la derecha (>66%) = siguiente
      else if (clickPosition >= 0.66) {
        nextFlashcard();
      }
    }
    
    function flipFlashcard() {
      const flashcard = document.querySelector('.flashcard');
      const front = document.querySelector('.flashcard-front');
      const back = document.querySelector('.flashcard-back');
      
      if (!isFlashcardFlipped) {
        flashcard.classList.add('flipped');
        front.classList.add('hidden');
        back.classList.remove('hidden');
        isFlashcardFlipped = true;
      } else {
        flashcard.classList.remove('flipped');
        front.classList.remove('hidden');
        back.classList.add('hidden');
        isFlashcardFlipped = false;
      }
    }
    
    function markFlashcard(knew) {
      if (knew) {
        flashcardResults.correct++;
      } else {
        flashcardResults.incorrect++;
      }
      nextFlashcard();
    }
    
    function previousFlashcard() {
      if (currentFlashcardIndex > 0) {
        currentFlashcardIndex--;
        renderFlashcard();
      }
    }
    
    function nextFlashcard() {
      if (currentFlashcardIndex < currentFlashcardSet.length - 1) {
        currentFlashcardIndex++;
        renderFlashcard();
      } else {
        showFlashcardResults();
      }
    }
    
    function showFlashcardResults() {
      closeModal('flashcardStudyModal');
      const total = flashcardResults.correct + flashcardResults.incorrect;
      const percentage = total > 0 ? Math.round((flashcardResults.correct / total) * 100) : 0;
      
      const messagesDiv = document.getElementById('noviMessages');
      const resultMsg = document.createElement('div');
      resultMsg.className = 'flex gap-2';
      resultMsg.innerHTML = `
        <div class="w-8 h-8 rounded-full bg-gradient-to-br from-cyan-400 to-blue-500 flex items-center justify-center flex-shrink-0">
          <svg class="w-5 h-5" viewBox="0 0 64 64" fill="none">
            <ellipse cx="32" cy="36" rx="16" ry="14" fill="white"/>
            <circle cx="32" cy="20" r="10" fill="white"/>
          </svg>
        </div>
        <div class="glass-card rounded-2xl rounded-tl-none p-3 max-w-[80%]">
          <p class="text-lg font-bold mb-3">üìä Resultados de Flashcards</p>
          <div class="space-y-2">
            <div class="flex justify-between items-center">
              <span class="text-emerald-300">‚úÖ Correctas:</span>
              <span class="text-2xl font-bold text-emerald-300">${flashcardResults.correct}</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-red-300">‚ùå Incorrectas:</span>
              <span class="text-2xl font-bold text-red-300">${flashcardResults.incorrect}</span>
            </div>
            <div class="mt-3 pt-3 border-t border-cyan-500/30">
              <div class="flex justify-between items-center">
                <span>Porcentaje:</span>
                <span class="text-2xl font-bold ${percentage >= 70 ? 'text-emerald-300' : 'text-amber-300'}">${percentage}%</span>
              </div>
            </div>
          </div>
          <p class="text-xs text-cyan-200/60 mt-3">${percentage >= 70 ? '¬°Excelente trabajo! üéâ' : '¬°Sigue practicando! üí™'}</p>
        </div>
      `;
      messagesDiv.appendChild(resultMsg);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
      toggleNoviChat();
    }
    
    // Question Generator Functions
    let currentQuestions = [];
    let currentQuestionIndex = 0;
    let questionResults = { correct: 0, incorrect: 0 };
    
    function openQuestionGeneratorSection() {
      closeModal('learningResourcesModal');
      openModal('questionGeneratorImportModal');
    }
    
    async function handleQuestionImport(event) {
      event.preventDefault();
      
      const btn = document.getElementById('questionImportBtn');
      const spinner = document.getElementById('questionImportSpinner');
      const fileInput = document.getElementById('questionFile');
      const youtubeInput = document.getElementById('questionYoutubeLink');
      const textInput = document.getElementById('questionText');
      const quantity = document.getElementById('questionQuantity').value;
      const difficulty = document.getElementById('questionDifficulty').value;
      const customPrompt = document.getElementById('questionCustomPrompt').value;
      
      btn.classList.add('hidden');
      spinner.classList.remove('hidden');
      
      // Extract content from multiple sources
      let extractedText = '';
      let sourceType = 'text';
      
      if (fileInput.files.length > 0) {
        const file = fileInput.files[0];
        extractedText = await medicalAI.extractTextFromPDF(file);
        sourceType = 'pdf';
      } else if (youtubeInput.value) {
        extractedText = await medicalAI.extractTextFromYouTube(youtubeInput.value);
        sourceType = 'youtube';
      } else if (textInput.value) {
        extractedText = textInput.value;
        sourceType = 'text';
      } else {
        // Default content for demo
        extractedText = 'El sistema cardiovascular es esencial. El coraz√≥n bombea sangre constantemente.';
      }
      
      // Add custom prompt to enhance AI generation
      if (customPrompt) {
        extractedText += `\n\nContexto adicional: ${customPrompt}`;
      }
      
      // AI Analysis
      const subject = currentUploadContext?.courseId || 'anatomia';
      const analysis = medicalAI.analyzeContent(extractedText, subject);
      
      // Generate AI-powered questions
      currentQuestions = medicalAI.generateQuestions(analysis, quantity, difficulty);
      currentQuestionIndex = 0;
      questionResults = { correct: 0, incorrect: 0 };
      
      // Save to database
      await window.dataSdk.create({
        type: 'ai_questions',
        sourceContent: extractedText,
        sourceType: sourceType,
        customPrompt: customPrompt || '',
        aiGeneratedContent: JSON.stringify(currentQuestions),
        difficulty: difficulty,
        quantity: currentQuestions.length,
        uploadedBy: currentUser.email,
        uploadedAt: new Date().toISOString()
      });
      
      btn.classList.remove('hidden');
      spinner.classList.add('hidden');
      
      // Clear inputs
      fileInput.value = '';
      youtubeInput.value = '';
      textInput.value = '';
      document.getElementById('questionCustomPrompt').value = '';
      
      closeModal('questionGeneratorImportModal');
      openModal('questionStudyModal');
      renderQuestion();
    }
    
    function renderQuestion() {
      const q = currentQuestions[currentQuestionIndex];
      const container = document.getElementById('questionContainer');
      const counter = document.getElementById('questionCounter');
      
      counter.textContent = `Pregunta ${currentQuestionIndex + 1} de ${currentQuestions.length}`;
      
      container.innerHTML = `
        <div class="mb-6">
          <p class="text-xl font-semibold mb-6">${q.question}</p>
          <div class="space-y-3">
            ${q.options.map((opt, idx) => `
              <button onclick="answerQuestion(${idx})" class="question-option w-full text-left px-4 py-3 rounded-xl bg-white/5 border border-white/10 hover:bg-cyan-500/20 hover:border-cyan-500/50 transition-all">
                <span class="font-medium">${String.fromCharCode(65 + idx)}.</span> ${opt}
              </button>
            `).join('')}
          </div>
        </div>
      `;
    }
    
    function answerQuestion(selectedIndex) {
      const q = currentQuestions[currentQuestionIndex];
      const container = document.getElementById('questionContainer');
      const isCorrect = selectedIndex === q.correct;
      
      if (isCorrect) {
        questionResults.correct++;
      } else {
        questionResults.incorrect++;
      }
      
      container.innerHTML = `
        <div class="text-center mb-6">
          <div class="text-6xl mb-4">${isCorrect ? 'üéâ' : 'üòî'}</div>
          <p class="text-2xl font-bold mb-2">${isCorrect ? '¬°Correcto!' : 'Incorrecto'}</p>
          ${!isCorrect ? `<p class="text-lg text-cyan-200/70 mb-4">La respuesta correcta era: <strong>${q.options[q.correct]}</strong></p>` : ''}
          <div class="bg-cyan-500/20 rounded-xl p-4 border border-cyan-500/30 text-left">
            <p class="text-sm font-semibold mb-2">üí° Explicaci√≥n:</p>
            <p class="text-sm text-cyan-200/80">${q.explanation}</p>
          </div>
        </div>
        <button onclick="nextQuestion()" class="btn-primary w-full px-6 py-3 rounded-xl text-base font-medium">
          ${currentQuestionIndex < currentQuestions.length - 1 ? 'Siguiente Pregunta ‚Üí' : 'Ver Resultados'}
        </button>
      `;
    }
    
    function nextQuestion() {
      if (currentQuestionIndex < currentQuestions.length - 1) {
        currentQuestionIndex++;
        renderQuestion();
      } else {
        showQuestionResults();
      }
    }
    
    function showQuestionResults() {
      closeModal('questionStudyModal');
      const total = questionResults.correct + questionResults.incorrect;
      const percentage = total > 0 ? Math.round((questionResults.correct / total) * 100) : 0;
      
      const messagesDiv = document.getElementById('noviMessages');
      const resultMsg = document.createElement('div');
      resultMsg.className = 'flex gap-2';
      resultMsg.innerHTML = `
        <div class="w-8 h-8 rounded-full bg-gradient-to-br from-cyan-400 to-blue-500 flex items-center justify-center flex-shrink-0">
          <svg class="w-5 h-5" viewBox="0 0 64 64" fill="none">
            <ellipse cx="32" cy="36" rx="16" ry="14" fill="white"/>
            <circle cx="32" cy="20" r="10" fill="white"/>
          </svg>
        </div>
        <div class="glass-card rounded-2xl rounded-tl-none p-3 max-w-[80%]">
          <p class="text-lg font-bold mb-3">üìä Resultados del Banco de Preguntas</p>
          <div class="space-y-2">
            <div class="flex justify-between items-center">
              <span class="text-emerald-300">‚úÖ Correctas:</span>
              <span class="text-2xl font-bold text-emerald-300">${questionResults.correct}</span>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-red-300">‚ùå Incorrectas:</span>
              <span class="text-2xl font-bold text-red-300">${questionResults.incorrect}</span>
            </div>
            <div class="mt-3 pt-3 border-t border-cyan-500/30">
              <div class="flex justify-between items-center">
                <span>Porcentaje:</span>
                <span class="text-2xl font-bold ${percentage >= 70 ? 'text-emerald-300' : 'text-amber-300'}">${percentage}%</span>
              </div>
            </div>
          </div>
          <p class="text-xs text-cyan-200/60 mt-3">${percentage >= 70 ? '¬°Excelente dominio del tema! üéâ' : '¬°Sigue estudiando! üí™'}</p>
        </div>
      `;
      messagesDiv.appendChild(resultMsg);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
      toggleNoviChat();
    }
    
    // Notes Functions
    function openNotesSection() {
      closeModal('learningResourcesModal');
      openModal('notesMainModal');
      renderNotesList();
    }
    
    function renderNotesList() {
      const adminNotes = allData.filter(d => d.type === 'note' && d.uploadedBy !== currentUser.email);
      const myNotes = allData.filter(d => d.type === 'note' && d.uploadedBy === currentUser.email);
      
      const container = document.getElementById('notesListContainer');
      container.innerHTML = `
        <div class="mb-6">
          <h3 class="text-lg font-semibold mb-3">üìö Apuntes del Administrador</h3>
          ${adminNotes.length > 0 ? adminNotes.map(note => `
            <div class="glass-card rounded-xl p-4 mb-2 hover:bg-white/10 transition-all cursor-pointer" onclick="viewNote('${note.__backendId}')">
              <p class="font-medium">${note.fileName || 'Apunte sin t√≠tulo'}</p>
              <p class="text-xs text-cyan-300/60">${new Date(note.uploadedAt).toLocaleDateString()}</p>
            </div>
          `).join('') : '<p class="text-sm text-cyan-200/60">No hay apuntes del administrador a√∫n</p>'}
        </div>
        <div>
          <h3 class="text-lg font-semibold mb-3">‚úèÔ∏è Mis Apuntes</h3>
          ${myNotes.length > 0 ? myNotes.map(note => `
            <div class="glass-card rounded-xl p-4 mb-2 hover:bg-white/10 transition-all cursor-pointer" onclick="viewNote('${note.__backendId}')">
              <p class="font-medium">${note.fileName || 'Apunte sin t√≠tulo'}</p>
              <p class="text-xs text-cyan-300/60">${new Date(note.uploadedAt).toLocaleDateString()}</p>
            </div>
          `).join('') : '<p class="text-sm text-cyan-200/60">No has creado apuntes a√∫n</p>'}
        </div>
      `;
    }
    
    function openCreateNoteModal() {
      closeModal('notesMainModal');
      openModal('createNoteModal');
    }
    
    async function saveNote() {
      const title = document.getElementById('noteTitle').value || 'Apunte sin t√≠tulo';
      const content = document.getElementById('noteContent').value;
      
      const btn = document.getElementById('saveNoteBtn');
      const spinner = document.getElementById('saveNoteSpinner');
      
      btn.classList.add('hidden');
      spinner.classList.remove('hidden');
      
      await new Promise(resolve => setTimeout(resolve, 1000));
      
      const result = await window.dataSdk.create({
        type: 'note',
        fileName: title,
        url: content,
        uploadedBy: currentUser.email,
        uploadedAt: new Date().toISOString()
      });
      
      btn.classList.remove('hidden');
      spinner.classList.add('hidden');
      
      if (result.isOk) {
        closeModal('createNoteModal');
        document.getElementById('noteTitle').value = '';
        document.getElementById('noteContent').value = '';
        openNotesSection();
      }
    }
    
    function viewNote(backendId) {
      const note = allData.find(n => n.__backendId === backendId);
      if (!note) return;
      
      closeModal('notesMainModal');
      
      const messagesDiv = document.getElementById('noviMessages');
      const noteMsg = document.createElement('div');
      noteMsg.className = 'flex gap-2';
      noteMsg.innerHTML = `
        <div class="w-8 h-8 rounded-full bg-gradient-to-br from-cyan-400 to-blue-500 flex items-center justify-center flex-shrink-0">
          <svg class="w-5 h-5" viewBox="0 0 64 64" fill="none">
            <ellipse cx="32" cy="36" rx="16" ry="14" fill="white"/>
            <circle cx="32" cy="20" r="10" fill="white"/>
          </svg>
        </div>
        <div class="glass-card rounded-2xl rounded-tl-none p-3 max-w-[80%]">
          <p class="text-base font-bold mb-2">üìù ${note.fileName}</p>
          <p class="text-sm text-cyan-200/80 whitespace-pre-wrap">${note.url}</p>
          <p class="text-xs text-cyan-300/50 mt-3">${new Date(note.uploadedAt).toLocaleDateString()}</p>
        </div>
      `;
      messagesDiv.appendChild(noteMsg);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
      toggleNoviChat();
    }
    
    // Exams Functions
    let currentExam = null;
    let examStartTime = null;
    let examTimer = null;
    
    function openExamsSection() {
      closeModal('learningResourcesModal');
      openModal('examsMainModal');
      renderExamsList();
    }
    
    function renderExamsList() {
      const exams = allData.filter(d => d.type === 'exam');
      const container = document.getElementById('examsListContainer');
      
      container.innerHTML = exams.length > 0 ? exams.map(exam => `
        <div class="glass-card rounded-xl p-4 mb-3 hover:bg-white/10 transition-all cursor-pointer" onclick="startExam('${exam.__backendId}')">
          <p class="font-semibold">${exam.fileName || 'Examen'}</p>
          <p class="text-xs text-cyan-300/60">‚è±Ô∏è ${exam.scheduleTime || '30'} minutos</p>
        </div>
      `).join('') : '<p class="text-sm text-cyan-200/60 text-center py-6">No hay ex√°menes disponibles</p>';
    }
    
    function openCreateExamModal() {
      closeModal('examsMainModal');
      openModal('createExamModal');
    }
    
    async function handleCreateExam(event) {
      event.preventDefault();
      
      const btn = document.getElementById('createExamBtn');
      const spinner = document.getElementById('createExamSpinner');
      const fileInput = document.getElementById('examFile');
      const youtubeInput = document.getElementById('examYoutubeLink');
      const textInput = document.getElementById('examText');
      const time = document.getElementById('examTime').value;
      const numQuestions = document.getElementById('examNumQuestions').value;
      const difficulty = document.getElementById('examDifficulty').value;
      const type = document.getElementById('examType').value;
      
      btn.classList.add('hidden');
      spinner.classList.remove('hidden');
      
      // Extract content from multiple sources
      let extractedText = '';
      let sourceType = 'text';
      
      if (fileInput.files.length > 0) {
        const file = fileInput.files[0];
        extractedText = await medicalAI.extractTextFromPDF(file);
        sourceType = 'pdf';
      } else if (youtubeInput.value) {
        extractedText = await medicalAI.extractTextFromYouTube(youtubeInput.value);
        sourceType = 'youtube';
      } else if (textInput.value) {
        extractedText = textInput.value;
        sourceType = 'text';
      } else {
        // Default content for demo
        extractedText = 'El sistema cardiovascular es fundamental. El coraz√≥n, las v√°lvulas y la circulaci√≥n sangu√≠nea son componentes esenciales. La hemodinamia estudia el flujo sangu√≠neo.';
      }
      
      // AI Analysis
      const subject = currentUploadContext?.courseId || 'anatomia';
      const analysis = medicalAI.analyzeContent(extractedText, subject);
      
      // Generate AI-powered exam questions
      const examQuestions = medicalAI.generateQuestions(analysis, 
        numQuestions === '10' ? 'few' : numQuestions === '20' ? 'necessary' : 'many', 
        difficulty
      );
      
      // Save exam to database
      await window.dataSdk.create({
        type: 'ai_exam',
        sourceContent: extractedText,
        sourceType: sourceType,
        aiGeneratedContent: JSON.stringify(examQuestions),
        difficulty: difficulty,
        quantity: examQuestions.length,
        timeLimit: time,
        examType: type,
        uploadedBy: currentUser.email,
        uploadedAt: new Date().toISOString()
      });
      
      btn.classList.remove('hidden');
      spinner.classList.add('hidden');
      
      // Clear inputs
      fileInput.value = '';
      youtubeInput.value = '';
      textInput.value = '';
      
      closeModal('createExamModal');
      
      // Start exam immediately
      currentQuestions = examQuestions;
      currentQuestionIndex = 0;
      questionResults = { correct: 0, incorrect: 0 };
      examStartTime = Date.now();
      
      openModal('examStudyModal');
      startExamTimer(parseInt(time));
      renderQuestion();
    }
    
    function startExamTimer(minutes) {
      const endTime = Date.now() + (minutes * 60 * 1000);
      
      examTimer = setInterval(() => {
        const remaining = endTime - Date.now();
        
        if (remaining <= 0) {
          clearInterval(examTimer);
          finishExam();
          return;
        }
        
        const mins = Math.floor(remaining / 60000);
        const secs = Math.floor((remaining % 60000) / 1000);
        document.getElementById('examTimerDisplay').textContent = `‚è±Ô∏è ${mins}:${secs.toString().padStart(2, '0')}`;
      }, 1000);
    }
    
    function finishExam() {
      if (examTimer) {
        clearInterval(examTimer);
      }
      closeModal('examStudyModal');
      showQuestionResults();
    }
    
    function openLearningResourcesModal(courseId, subject, weekNum) {
      currentUploadContext = { courseId, subject, weekNum };
      document.getElementById('resourcesSubtitle').textContent = `Semana ${weekNum} - ${subject || coursesData[courseId].title}`;
      openModal('learningResourcesModal');
    }
    
    function openLearningResourcesModalSimple(courseId, weekNum) {
      currentUploadContext = { courseId, subject: null, weekNum };
      document.getElementById('resourcesSubtitle').textContent = `Semana ${weekNum} - ${coursesData[courseId].title}`;
      openModal('learningResourcesModal');
    }

    // Initialize
    showPage('login');
    updateUI();

    // Logo menu functions
    function showLogoMenu(event) {
      event.stopPropagation();
      const menu = document.getElementById('logoMenu');
      const changeBtn = document.getElementById('changeLogoBtn');
      
      // Always show change logo button if user is admin
      if (currentUser && currentUser.role === 'admin') {
        changeBtn.classList.remove('hidden');
      } else {
        changeBtn.classList.add('hidden');
      }
      
      menu.classList.toggle('hidden');
    }

    function viewLogo() {
      document.getElementById('logoMenu').classList.add('hidden');
      openModal('viewLogoModal');
    }

    function openChangeLogoModal() {
      document.getElementById('logoMenu').classList.add('hidden');
      openModal('changeLogoModal');
    }

    async function handleLogoChange(event) {
      event.preventDefault();
      
      const btn = document.getElementById('changeLogoBtnText');
      const spinner = document.getElementById('changeLogoSpinner');
      const fileInput = document.getElementById('logoFile');
      
      btn.classList.add('hidden');
      spinner.classList.remove('hidden');
      
      await new Promise(resolve => setTimeout(resolve, 1500));
      
      // In a real implementation, the logo would be uploaded and stored
      // For now, we'll just show a success message
      
      btn.classList.remove('hidden');
      spinner.classList.add('hidden');
      
      closeModal('changeLogoModal');
      fileInput.value = '';
      
      // Show success message in NOVI
      const messagesDiv = document.getElementById('noviMessages');
      const successMsg = document.createElement('div');
      successMsg.className = 'flex gap-2';
      successMsg.innerHTML = `
        <div class="w-8 h-8 rounded-full bg-gradient-to-br from-cyan-400 to-blue-500 flex items-center justify-center flex-shrink-0">
          <svg class="w-5 h-5" viewBox="0 0 64 64" fill="none">
            <ellipse cx="32" cy="36" rx="16" ry="14" fill="white"/>
            <circle cx="32" cy="20" r="10" fill="white"/>
          </svg>
        </div>
        <div class="glass-card rounded-2xl rounded-tl-none p-3 max-w-[80%]">
          <p class="text-sm">‚úÖ Logo actualizado exitosamente. Los cambios se ver√°n reflejados en toda la plataforma.</p>
        </div>
      `;
      messagesDiv.appendChild(successMsg);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    function showCourseIconMenu(event, courseId) {
      event.stopPropagation();
      event.preventDefault();
      
      // Close any other open menus
      document.querySelectorAll('.course-icon-menu').forEach(m => m.classList.add('hidden'));
      
      const menu = document.getElementById(`courseIconMenu-${courseId}`);
      const changeBtn = document.querySelector(`.change-icon-btn-${courseId}`);
      
      // Show or hide "Cambiar ÔøΩÔøΩcono" button based on admin status
      if (changeBtn) {
        if (currentUser && currentUser.role === 'admin') {
          changeBtn.style.display = 'flex';
        } else {
          changeBtn.style.display = 'none';
        }
      }
      
      if (menu) {
        menu.classList.toggle('hidden');
      }
    }

    function viewCourseIcon(courseId) {
      const course = coursesData[courseId];
      document.querySelectorAll('.course-icon-menu').forEach(m => m.classList.add('hidden'));
      
      // Show success message in NOVI
      const messagesDiv = document.getElementById('noviMessages');
      const iconMsg = document.createElement('div');
      iconMsg.className = 'flex gap-2';
      iconMsg.innerHTML = `
        <div class="w-8 h-8 rounded-full bg-gradient-to-br from-cyan-400 to-blue-500 flex items-center justify-center flex-shrink-0">
          <svg class="w-5 h-5" viewBox="0 0 64 64" fill="none">
            <ellipse cx="32" cy="36" rx="16" ry="14" fill="white"/>
            <circle cx="32" cy="20" r="10" fill="white"/>
          </svg>
        </div>
        <div class="glass-card rounded-2xl rounded-tl-none p-3 max-w-[80%]">
          <p class="text-sm font-semibold mb-2">üé® √çcono de ${course.title}</p>
          <p class="text-xs text-cyan-200/70">Este es el √≠cono actual del curso. Los administradores pueden cambiarlo desde el men√∫.</p>
        </div>
      `;
      messagesDiv.appendChild(iconMsg);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
      
      toggleNoviChat();
    }

    function openChangeCourseIconModal(courseId) {
      const course = coursesData[courseId];
      document.querySelectorAll('.course-icon-menu').forEach(m => m.classList.add('hidden'));
      
      document.getElementById('iconCourseId').value = courseId;
      document.getElementById('iconCourseName').textContent = course.title;
      openModal('changeCourseIconModal');
    }

    async function handleCourseIconChange(event) {
      event.preventDefault();
      
      const btn = document.getElementById('changeCourseIconBtnText');
      const spinner = document.getElementById('changeCourseIconSpinner');
      const fileInput = document.getElementById('courseIconFile');
      const courseId = document.getElementById('iconCourseId').value;
      
      btn.classList.add('hidden');
      spinner.classList.remove('hidden');
      
      await new Promise(resolve => setTimeout(resolve, 1500));
      
      // In a real implementation, the icon would be uploaded and stored
      // For now, we'll just show a success message
      
      btn.classList.remove('hidden');
      spinner.classList.add('hidden');
      
      closeModal('changeCourseIconModal');
      fileInput.value = '';
      
      // Show success message in NOVI
      const course = coursesData[courseId];
      const messagesDiv = document.getElementById('noviMessages');
      const successMsg = document.createElement('div');
      successMsg.className = 'flex gap-2';
      successMsg.innerHTML = `
        <div class="w-8 h-8 rounded-full bg-gradient-to-br from-cyan-400 to-blue-500 flex items-center justify-center flex-shrink-0">
          <svg class="w-5 h-5" viewBox="0 0 64 64" fill="none">
            <ellipse cx="32" cy="36" rx="16" ry="14" fill="white"/>
            <circle cx="32" cy="20" r="10" fill="white"/>
          </svg>
        </div>
        <div class="glass-card rounded-2xl rounded-tl-none p-3 max-w-[80%]">
          <p class="text-sm">‚úÖ √çcono de ${course.title} actualizado exitosamente.</p>
        </div>
      `;
      messagesDiv.appendChild(successMsg);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    // Close menus when clicking outside
    document.addEventListener('click', function(event) {
      if (!event.target.closest('#logoMenu') && !event.target.closest('.w-14.h-14.rounded-xl')) {
        document.getElementById('logoMenu').classList.add('hidden');
      }
      if (!event.target.closest('.course-icon-menu')) {
        document.querySelectorAll('.course-icon-menu').forEach(m => m.classList.add('hidden'));
      }
    });
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c7c6666b107c2d1',t:'MTc3MDA2Mzc0MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
