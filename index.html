<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NEUROVA P53 - Plataforma M√©dica</title>
  <style>
    :root { 
      --primary: #1e40af; --accent: #3b82f6; --bg: #f0f4f8; 
      --white: #ffffff; --danger: #ef4444; --success: #10b981;
      --gold: #f59e0b;
    }
    body { margin:0; font-family:'Segoe UI', system-ui, sans-serif; background: var(--bg); color: #1e293b; }
    
    /* HEADER PREMIUM */
    header { 
      background: var(--white); border-bottom: 3px solid var(--accent); 
      padding: 15px 40px; display: flex; align-items: center; 
      justify-content: space-between; position: sticky; top:0; z-index: 1000;
      box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
    }
    .logo-container { display: flex; align-items: center; gap: 12px; cursor: pointer; }
    .logo-img { 
      width: 45px; height: 45px; border-radius: 12px; background: var(--primary); 
      display: flex; align-items: center; justify-content: center; 
      color: white; font-weight: bold; font-size: 26px; border: 2px solid #bfdbfe;
    }
    .logo-text { font-size: 24px; font-weight: 800; letter-spacing: -1px; margin: 0; color: var(--primary); }
    .logo-text span { color: var(--accent); }

    /* CONTENEDORES */
    .container { max-width: 1100px; margin: 30px auto; padding: 0 20px; }
    .card { 
      background: var(--white); border-radius: 20px; padding: 25px; 
      box-shadow: 0 10px 25px rgba(0,0,0,0.05); margin-bottom: 20px; 
      border: 1px solid #e2e8f0; transition: 0.3s;
    }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; }

    /* BOTONES */
    button { cursor: pointer; border: none; border-radius: 12px; padding: 12px 20px; font-weight: 700; transition: all 0.2s; }
    button:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
    .btn-pdf { background: var(--success); color: white; }
    .btn-vid { background: #06b6d4; color: white; }
    .btn-ban { background: #8b5cf6; color: white; }
    .btn-admin-opt { background: var(--gold); color: white; width: 100%; margin-top: 10px; font-size: 13px; }
    
    .hidden { display: none; }

    /* VENTANAS MODALES (LOGICA JAMES) */
    .modal {
      position: fixed; top:0; left:0; width:100%; height:100%;
      background: rgba(15, 23, 42, 0.8); display: flex; align-items: center;
      justify-content: center; z-index: 2000; backdrop-filter: blur(4px);
    }
    .modal-content { background: white; width: 90%; max-width: 450px; padding: 30px; border-radius: 24px; text-align: center; }
    input[type="text"], input[type="file"] { width: 100%; padding: 12px; margin: 15px 0; border: 2px solid #e2e8f0; border-radius: 10px; }
  </style>
</head>
<body>

<header>
  <div class="logo-container" onclick="location.reload()">
    <div class="logo-img">N</div>
    <h1 class="logo-text">NEUROVA <span>P53</span></h1>
  </div>
  <div id="user-info" style="font-weight: 600;"></div>
</header>

<div id="vista-inicio" class="container">
  <div class="card" style="text-align:center; padding: 80px 20px;">
    <h2 style="font-size: 32px;">Bienvenido a la √âlite M√©dica</h2>
    <p>Accede a tus cursos, grabaciones y banqueos personalizados.</p>
    <button onclick="login()" style="background:var(--primary); color:white; padding:18px 40px; font-size:18px;">Iniciar Sesi√≥n con Google</button>
  </div>
</div>

<div id="vista-cursos" class="container hidden">
  <h2 style="border-left: 6px solid var(--primary); padding-left: 15px; margin-bottom: 25px;">Mis Cursos Especializados</h2>
  <div id="grid-cursos" class="grid"></div>
</div>

<div id="vista-semanas" class="container hidden">
  <button onclick="mostrarVistas('vista-cursos')" style="background:#64748b; color:white; margin-bottom:20px;">‚Üê Volver a Cursos</button>
  <div class="card" style="background: var(--primary); color: white;">
    <h2 id="titulo-materia" style="margin:0"></h2>
  </div>
  <div id="lista-semanas"></div>
</div>

<div id="modal-james" class="modal hidden">
  <div class="modal-content">
    <h2 id="modal-titulo" style="color: var(--primary);"></h2>
    <p id="modal-desc"></p>
    
    <div id="form-pdf" class="hidden">
      <input type="file" id="f-pdf" accept="application/pdf">
      <button onclick="ejecutarSubidaPDF()" class="btn-pdf" style="width:100%">SUBIR ARCHIVO</button>
    </div>

    <div id="form-link" class="hidden">
      <input type="text" id="f-link" placeholder="Pega el enlace de Zoom o Drive aqu√≠...">
      <button onclick="ejecutarGuardarLink()" class="btn-vid" style="width:100%">GUARDAR LINK</button>
    </div>

    <div id="form-banco" class="hidden">
      <p style="background: #f1f5f9; padding: 15px; border-radius: 10px;">Aqu√≠ se abrir√° el editor de preguntas m√∫ltiple opci√≥n.</p>
      <button onclick="alert('Editor de Banqueo Activado')" class="btn-ban" style="width:100%">CREAR BANQUEO</button>
    </div>

    <button onclick="cerrarModal()" style="margin-top:15px; background:none; color: #64748b; text-decoration: underline;">Cancelar</button>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDAmEVU8J-uk2Yg6bL5n28xbP1771cHGME",
    authDomain: "neurovap53-cdbcf.firebaseapp.com",
    projectId: "neurovap53-cdbcf",
    storageBucket: "neurovap53-cdbcf.appspot.com"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth();
  const db = getFirestore(app);
  const storage = getStorage(app);
  const provider = new GoogleAuthProvider();

  const JAMES_EMAIL = "jamesucribanco333@gmail.com";
  let curAct = ""; let subAct = ""; let semAct = 1;

  // TEMARIOS COMPLETOS INCLUYENDO ANATOM√çA GENERAL
  const TEMARIOS = {
    "Anatom√≠a General": {
      "Teor√≠a": [
        "S1: Generalidades de anatom√≠a, Hombro y Axila. Brazo y Codo.",
        "S2: Antebrazo. Mu√±eca y mano.",
        "S3: Regi√≥n Gl√∫tea y Cadera. Muslo y Rodilla.",
        "S4: Pierna y Regi√≥n Popl√≠tea. EXAMEN PARCIAL.",
        "S5: Tobillo y Pie. Vertebras Cervicales, Regiones y Tri√°ngulos del cuello.",
        "S6: V√≠sceras del cuello (faringe, laringe, es√≥fago, tr√°quea y tiroides). Cabeza √≥sea, viscerocr√°neo y neurocr√°neo.",
        "S7: M√∫sculos de la m√≠mica y de la masticaci√≥n. Regiones profundas de la cara.",
        "S8: Cavidad oral, fosas nasales y generalidades de pared de t√≥rax, abdomen y pelvis. EXAMEN FINAL."
      ]
    },
    "Morfofisiolog√≠a 1": {
      "Fisiolog√≠a": ["S1: Membrana", "S2: Se√±ales", "S3: M√∫sculo", "S4: PARCIAL", "S5: Sangre", "S6: Hemostasia", "S7: Inmunidad", "S8: FINAL"],
      "Histolog√≠a": ["S1: Organelas", "S2: Tejido √ìseo", "S3: Nervioso", "S4: PARCIAL", "S5: Epitelios", "S6: Conectivo", "S7: Linfoides", "S8: FINAL"]
    }
    // ... (puedes seguir agregando los otros aqu√≠)
  };

  window.mostrarVistas = (id) => {
    document.querySelectorAll('.container').forEach(v => v.classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
  };

  window.abrirMateria = (materia, curso) => {
    curAct = curso; subAct = materia;
    document.getElementById('titulo-materia').innerText = `${curso} - ${materia}`;
    renderSemanas();
    mostrarVistas('vista-semanas');
  };

  async function renderSemanas() {
    const contenedor = document.getElementById('lista-semanas');
    contenedor.innerHTML = "<p style='text-align:center'>Cargando contenido m√©dico...</p>";
    const temas = TEMARIOS[curAct][subAct];
    let html = "";

    for(let i=0; i<temas.length; i++) {
      const n = i+1;
      const snap = await getDoc(doc(db, "recursos", `${curAct}_${subAct}_S${n}`));
      const data = snap.exists() ? snap.data() : {};
      const esAdmin = auth.currentUser.email === JAMES_EMAIL;

      html += `
        <div class="card">
          <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px;">
            <div style="max-width:60%;">
              <span style="background:var(--accent); color:white; padding:2px 8px; border-radius:5px; font-size:12px;">SEMANA ${n}</span>
              <p style="margin:5px 0 0 0; font-weight:600;">${temas[i]}</p>
            </div>
            <div style="display:flex; gap:8px;">
              <button class="btn-pdf" onclick="accionBoton('pdf', ${n}, '${data.pdf}')" ${!data.pdf && !esAdmin ? 'disabled' : ''}>üìÑ PDF</button>
              <button class="btn-vid" onclick="accionBoton('link', ${n}, '${data.video}')" ${!data.video && !esAdmin ? 'disabled' : ''}>üé¨ Clase</button>
              <button class="btn-ban" onclick="accionBoton('banco', ${n}, '${data.banco}')" ${!data.banco && !esAdmin ? 'disabled' : ''}>‚úçÔ∏è Banco</button>
            </div>
          </div>
        </div>`;
    }
    contenedor.innerHTML = html;
  }

  // L√ìGICA DE CLIC (DIFERENCIA ENTRE JAMES Y ALUMNO)
  window.accionBoton = (tipo, n, urlExistente) => {
    semAct = n;
    const esAdmin = auth.currentUser.email === JAMES_EMAIL;

    if (esAdmin) {
      // SI ES JAMES: Abre la ventana de configuraci√≥n que pediste
      document.getElementById('modal-james').classList.remove('hidden');
      document.querySelectorAll('#modal-james div').forEach(d => d.classList.add('hidden'));
      document.querySelector('.modal-content').classList.remove('hidden');

      if(tipo === 'pdf') {
        document.getElementById('modal-titulo').innerText = "Subir Archivo PDF";
        document.getElementById('modal-desc').innerText = "Selecciona el documento de la Semana " + n;
        document.getElementById('form-pdf').classList.remove('hidden');
      } else if(tipo === 'link') {
        document.getElementById('modal-titulo').innerText = "Insertar Link de Grabaci√≥n";
        document.getElementById('modal-desc').innerText = "Pega el enlace de la clase grabada.";
        document.getElementById('form-link').classList.remove('hidden');
      } else {
        document.getElementById('modal-titulo').innerText = "Crear Banqueo";
        document.getElementById('form-banco').classList.remove('hidden');
      }
    } else {
      // SI ES ALUMNO: Solo abre el archivo si existe
      if(urlExistente && urlExistente !== 'undefined') window.open(urlExistente, '_blank');
      else alert("Material a√∫n no disponible.");
    }
  };

  window.cerrarModal = () => document.getElementById('modal-james').classList.add('hidden');

  window.ejecutarSubidaPDF = async () => {
    const file = document.getElementById('f-pdf').files[0];
    if(!file) return alert("Selecciona un archivo primero");
    const storageRef = ref(storage, `pdf/${curAct}/${subAct}/S${semAct}_${file.name}`);
    alert("Subiendo archivo a la nube...");
    await uploadBytes(storageRef, file);
    const url = await getDownloadURL(storageRef);
    await setDoc(doc(db, "recursos", `${curAct}_${subAct}_S${semAct}`), { pdf: url }, { merge: true });
    alert("¬°PDF subido y guardado!");
    cerrarModal(); renderSemanas();
  };

  window.ejecutarGuardarLink = async () => {
    const val = document.getElementById('f-link').value;
    if(!val) return alert("Pega un link v√°lido");
    await setDoc(doc(db, "recursos", `${curAct}_${subAct}_S${semAct}`), { video: val }, { merge: true });
    alert("¬°Link de grabaci√≥n guardado!");
    cerrarModal(); renderSemanas();
  };

  window.login = () => signInWithPopup(auth, provider);

  onAuthStateChanged(auth, (user) => {
    if(user) {
      document.getElementById('user-info').innerText = user.displayName;
      mostrarVistas('vista-cursos');
      const grid = document.getElementById('grid-cursos');
      grid.innerHTML = "";
      Object.keys(TEMARIOS).forEach(curso => {
        const div = document.createElement('div');
        div.className = "card";
        div.innerHTML = `<h3 style="color:var(--primary); margin-top:0;">${curso}</h3>`;
        Object.keys(TEMARIOS[curso]).forEach(sub => {
          div.innerHTML += `<button onclick="abrirMateria('${sub}', '${curso}')" style="margin:5px; background:var(--accent); color:white;">${sub}</button>`;
        });
        grid.appendChild(div);
      });
    }
  });
</script>
</body>
</html>
