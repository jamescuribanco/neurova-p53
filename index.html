<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Neurova P53 - Academia M√©dica</title>
  <style>
    :root { --primary: #1e40af; --secondary: #3b82f6; --bg: #f8fafc; --text: #0f172a; }
    body { margin:0; font-family:'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); }
    header { background: white; border-bottom: 2px solid #e2e8f0; padding: 15px 40px; display: flex; align-items: center; justify-content: space-between; position: sticky; top:0; z-index:100; }
    header h1 { font-size: 20px; color: var(--primary); margin:0; }
    nav a { margin-left: 20px; text-decoration: none; color: #64748b; font-weight: 600; cursor: pointer; }
    .container { max-width: 1000px; margin: 30px auto; padding: 0 20px; }
    .card { background: white; border-radius: 12px; padding: 25px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 20px; border: 1px solid #f1f5f9; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
    button { background: var(--primary); color: white; border: none; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: 0.2s; }
    button:hover { opacity: 0.9; transform: translateY(-1px); }
    button:disabled { background: #cbd5e1; cursor: not-allowed; transform: none; }
    .semana-card { background: white; border-radius: 12px; padding: 20px; margin-bottom: 15px; border-left: 5px solid var(--secondary); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    .recursos-row { display: flex; gap: 10px; margin-top: 15px; }
    .recursos-row button { font-size: 13px; background: #f1f5f9; color: var(--primary); border: 1px solid #e2e8f0; }
    .hidden { display: none; }
    .admin-box { background: #fff7ed; border: 1px solid #fed7aa; padding: 20px; border-radius: 12px; margin-bottom: 25px; }
    input, select { padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; margin-right: 5px; margin-bottom: 5px; }
  </style>
</head>
<body>

<header>
  <div style="display:flex; align-items:center;">
    <div style="width:40px; height:40px; background:var(--primary); border-radius:50%; margin-right:12px;"></div>
    <h1>NEUROVA P53</h1>
  </div>
  <nav>
    <a onclick="nav('inicio')">Inicio</a>
    <a onclick="nav('cursos-container')">Cursos</a>
    <a id="admin-nav" class="hidden" onclick="nav('admin-panel')">Admin</a>
  </nav>
</header>
<div id="inicio" class="container">
  <div class="card" style="text-align:center;">
    <h2>Bienvenido a tu Academia</h2>
    <div id="login-area">
      <button onclick="login()" style="font-size:18px; padding:15px 30px;">Entrar con Google</button>
    </div>
    <div id="user-info" class="hidden">
      <p id="user-name" style="font-weight:bold;"></p>
      <button onclick="logout()" style="background:#ef4444; font-size:12px;">Cerrar Sesi√≥n</button>
    </div>
  </div>
</div>

<div id="cursos-container" class="container hidden">
  <h2 style="margin-bottom:20px;">Explora tus Cursos</h2>
  <div id="lista-cursos" class="grid"></div>
</div>

<div id="submaterias-container" class="container hidden">
  <h2 id="txt-curso"></h2>
  <div id="lista-submaterias" class="grid"></div>
  <button onclick="nav('cursos-container')" style="background:#64748b; margin-top:20px;">‚Üê Volver</button>
</div>

<div id="semanas-container" class="container hidden">
  <h2 id="txt-submateria"></h2>

  <div id="panel-james" class="admin-box hidden">
    <h4 style="margin-top:0;">üõ† Panel de James</h4>
    <select id="sel-sem">
      <option value="1">Semana 1</option><option value="2">Semana 2</option><option value="3">Semana 3</option><option value="4">Semana 4</option>
      <option value="5">Semana 5</option><option value="6">Semana 6</option><option value="7">Semana 7</option><option value="8">Semana 8</option>
    </select>
    <input type="text" id="url-input" placeholder="Pega el enlace de Drive/Zoom aqu√≠" style="width:60%;">
    <div style="margin-top:10px;">
      <button onclick="subir('pdf')" style="background:#10b981;">Subir PDF</button>
      <button onclick="subir('video')" style="background:#06b6d4;">Subir Grabaci√≥n</button>
      <button onclick="subir('banco')" style="background:#f59e0b;">Subir Banqueo</button>
    </div>
  </div>

  <div id="lista-semanas"></div>
  <button onclick="nav('submaterias-container')" style="background:#64748b; margin-top:20px;">‚Üê Volver</button>
</div>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDAmEVU8J-uk2Yg6bL5n28xbP1771cHGME",
    authDomain: "neurovap53-cdbcf.firebaseapp.com",
    projectId: "neurovap53-cdbcf"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth();
  const db = getFirestore(app);
  const provider = new GoogleAuthProvider();

  const CURSOS = {
    "Morfofisiolog√≠a 1": {
      "Fisiolog√≠a": ["Membrana celular y potenciales.", "Se√±ales celulares y medio interno.", "Neurotransmisores y sinapsis.", "Metabolismo √≥seo y Parcial.", "Sangre y hematopoyesis.", "Fisiolog√≠a eritrocitaria y hemostasia.", "Inmunidad innata y adquirida.", "Respuesta inflamatoria y Final."],
      "Histolog√≠a": ["Procesamiento histol√≥gico y Embrio esqueleto.", "Tejido √≥seo y muscular.", "Tejido muscular II y nervioso.", "Sistema vascular y Parcial.", "Epitelios.", "Tejido conectivo y sangu√≠neo.", "√ìrganos linfoides.", "Sistema tegumentario y Final."]
    },
    "Morfofisiolog√≠a 2": {
      "Anatom√≠a": ["Pared tor√°cica y mama.", "Mediastino superior y pericardio.", "Morfolog√≠a interna cardiaca.", "Mediastino posterior y Parcial.", "Pulmones.", "Columna dorsal.", "Ri√±√≥n y v√≠as urinarias.", "Radioanatom√≠a renal y Final."],
      "Fisiolog√≠a": ["Hemodinamia y electrofisiolog√≠a.", "EKG y ciclo cardiaco.", "Presi√≥n arterial y gasto cardiaco.", "Mec√°nica respiratoria y Parcial.", "Intercambio de gases.", "Estructura renal y filtraci√≥n.", "Equilibrio √°cido-base.", "Fisiolog√≠a de altura y Final."],
      "Histolog√≠a y Embriolog√≠a": ["Embrio-histo coraz√≥n.", "Histolog√≠a vascular.", "Integraci√≥n cardiaca.", "Histolog√≠a vascular y Parcial.", "Embrio-histo respiratorio.", "Embrio-histo urinario.", "Vejiga y uretra.", "Histopatolog√≠a renal y Final."]
    },
    "Bioqu√≠mica": { "Teor√≠a": Array(8).fill("Temario de Bioqu√≠mica Teor√≠a"), "Laboratorio": Array(8).fill("Temario de Bioqu√≠mica Lab") },
    "Biolog√≠a Celular": { "Teor√≠a": Array(8).fill("Temario de Biolog√≠a Teor√≠a"), "Laboratorio": Array(8).fill("Temario de Biolog√≠a Lab") }
  };

  let cursoActivo = ""; let subActiva = "";
  const ADMIN_EMAIL = "jamesucribanco333@gmail.com";

  window.nav = (id) => {
    ['inicio', 'cursos-container', 'submaterias-container', 'semanas-container'].forEach(s => document.getElementById(s).classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
  };

  function renderCursos() {
    const cont = document.getElementById('lista-cursos');
    cont.innerHTML = "";
    Object.keys(CURSOS).forEach(c => {
      cont.innerHTML += `<div class="card"><h3>${c}</h3><button onclick="verSub('${c}')">Ver Contenido</button></div>`;
    });
  }

  window.verSub = (c) => {
    cursoActivo = c;
    document.getElementById('txt-curso').innerText = c;
    const cont = document.getElementById('lista-submaterias');
    cont.innerHTML = "";
    Object.keys(CURSOS[c]).forEach(sub => {
      cont.innerHTML += `<div class="card" style="border-top: 4px solid #3b82f6;"><h3>${sub}</h3><button onclick="verSemanas('${sub}')">Entrar</button></div>`;
    });
    nav('submaterias-container');
  };

  window.verSemanas = async (sub) => {
    subActiva = sub;
    document.getElementById('txt-submateria').innerText = `${cursoActivo} > ${sub}`;
    const cont = document.getElementById('lista-semanas');
    cont.innerHTML = "";
    nav('semanas-container');

    if(auth.currentUser?.email === ADMIN_EMAIL) document.getElementById('panel-james').classList.remove('hidden');

    const temas = CURSOS[cursoActivo][sub];
    for(let i=1; i<=8; i++) {
      const div = document.createElement('div');
      div.className = "semana-card";
      div.innerHTML = `
        <strong>Semana ${i}</strong>
        <p style="margin:5px 0; font-size:14px; color:#475569;">${temas[i-1] || "Tema por definir"}</p>
        <div class="recursos-row" id="links-${i}"><span>Cargando recursos...</span></div>`;
      cont.appendChild(div);
      cargarLinks(i);
    }
  };

  async function cargarLinks(sem) {
    const id = `${cursoActivo}_${subActiva}_S${sem}`;
    const snap = await getDoc(doc(db, "recursos", id));
    const data = snap.exists() ? snap.data() : {};
    const cont = document.getElementById(`links-${sem}`);
    cont.innerHTML = `
      <button onclick="abrir('${data.pdf}')" ${!data.pdf ? 'disabled' : ''}>üìÑ PDF</button>
      <button onclick="abrir('${data.video}')" ${!data.video ? 'disabled' : ''}>üé¨ Video</button>
      <button onclick="abrir('${data.banco}')" ${!data.banco ? 'disabled' : ''}>‚úçÔ∏è Banqueo</button>`;
  }

  window.abrir = (url) => { if(url && url !== "undefined") window.open(url, '_blank'); };

  window.subir = async (tipo) => {
    const sem = document.getElementById('sel-sem').value;
    const url = document.getElementById('url-input').value;
    if(!url) return alert("Pega un link");
    await setDoc(doc(db, "recursos", `${cursoActivo}_${subActiva}_S${sem}`), { [tipo]: url }, { merge: true });
    alert("¬°Guardado!");
    cargarLinks(sem);
  };

  window.login = () => signInWithPopup(auth, provider);
  window.logout = () => signOut(auth);

  onAuthStateChanged(auth, (user) => {
    if (user) {
      document.getElementById('login-area').classList.add('hidden');
      document.getElementById('user-info').classList.remove('hidden');
      document.getElementById('user-name').innerText = user.displayName;
      renderCursos();
      nav('cursos-container');
    } else {
      document.getElementById('login-area').classList.remove('hidden');
      document.getElementById('user-info').classList.add('hidden');
      nav('inicio');
    }
  });
</script>
</body>
</html>
