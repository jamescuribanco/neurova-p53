<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NEUROVA P53 - Premium</title>
  <style>
    :root { 
      --primary: #1e3a8a; --accent: #3b82f6; --bg: #f8fafc; 
      --white: #ffffff; --success: #10b981; --gray: #64748b;
    }
    body { margin:0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #1e293b; }

    /* HEADER */
    header { 
      background: var(--white); border-bottom: 2px solid #e2e8f0; 
      padding: 1rem 5%; display: flex; align-items: center; justify-content: space-between;
      position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .logo-box { display: flex; align-items: center; gap: 10px; cursor: pointer; }
    .logo-icon { background: var(--primary); color: white; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 8px; font-weight: bold; font-size: 22px; }
    .logo-text { font-size: 22px; font-weight: 800; color: var(--primary); margin: 0; }
    .logo-text span { color: var(--accent); }

    /* CONTENEDORES */
    .container { max-width: 1100px; margin: 2rem auto; padding: 0 1rem; }
    .card { background: var(--white); border-radius: 15px; padding: 1.5rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); border: 1px solid #f1f5f9; margin-bottom: 1rem; }
    .btn-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; }
    
    /* BOTONES */
    .btn-action { padding: 8px 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.2s; font-size: 13px; }
    .btn-pdf { background: #dcfce7; color: #166534; }
    .btn-grab { background: #ecfeff; color: #0891b2; }
    .btn-ban { background: #f5f3ff; color: #5b21b6; }
    .btn-main { background: var(--primary); color: white; border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; }

    /* MODAL CORREGIDO (Oculto por defecto con display: none) */
    #james-modal {
      position: fixed; top:0; left:0; width:100%; height:100%;
      background: rgba(15, 23, 42, 0.7); 
      display: none; /* ESTO EVITA QUE SALGA LA VENTANA SOLA */
      align-items: center; justify-content: center; z-index: 2000;
      backdrop-filter: blur(4px);
    }
    .modal-content { 
      background: white; padding: 2rem; border-radius: 20px; 
      width: 90%; max-width: 400px; text-align: center; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.2);
    }
    .hidden { display: none !important; }
    input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #cbd5e1; border-radius: 8px; box-sizing: border-box; }
  </style>
</head>
<body>

<header>
  <div class="logo-box" onclick="location.reload()">
    <div class="logo-icon">N</div>
    <h1 class="logo-text">NEUROVA <span>P53</span></h1>
  </div>
  <div id="auth-status">
    <button onclick="login()" class="btn-main">Entrar con Google</button>
  </div>
</header>

<div class="container" id="main-content">
  <div class="card" style="text-align: center; padding: 50px;">
    <h2>Cargando Plataforma M√©dica...</h2>
    <p>Si no has iniciado sesi√≥n, pulsa el bot√≥n de arriba.</p>
  </div>
</div>

<div id="james-modal">
  <div class="modal-content">
    <h3 id="modal-title" style="color:var(--primary)">Configuraci√≥n</h3>
    <hr style="border:0; border-top:1px solid #eee; margin: 15px 0;">
    
    <div id="box-pdf" class="hidden">
      <p><b>Subir archivo PDF</b></p>
      <input type="file" id="input-file-pdf" accept="application/pdf">
      <button class="btn-action btn-pdf" style="width:100%; padding:15px;" onclick="ejecutarSubidaPDF()">Subir Archivo</button>
    </div>

    <div id="box-grabacion" class="hidden">
      <p><b>Link de Grabaci√≥n</b></p>
      <input type="text" id="input-link-grabacion" placeholder="Pega el enlace de Zoom/Drive">
      <button class="btn-action btn-grab" style="width:100%; padding:15px;" onclick="ejecutarGuardarLink()">Insertar link y guardar</button>
    </div>

    <div id="box-banqueo" class="hidden">
      <p><b>A√±adir Pregunta</b></p>
      <input type="text" id="q-text" placeholder="Pregunta">
      <input type="text" id="q-o1" placeholder="Opci√≥n 1 (Correcta)">
      <input type="text" id="q-o2" placeholder="Opci√≥n 2">
      <button class="btn-action btn-ban" style="width:100%; padding:15px;" onclick="alert('Pregunta guardada')">Guardar Pregunta</button>
    </div>

    <button onclick="cerrarModal()" style="margin-top: 20px; background: none; border: none; color: var(--gray); cursor: pointer; text-decoration: underline;">Cerrar ventana</button>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDAmEVU8J-uk2Yg6bL5n28xbP1771cHGME",
    authDomain: "neurovap53-cdbcf.firebaseapp.com",
    projectId: "neurovap53-cdbcf",
    storageBucket: "neurovap53-cdbcf.appspot.com"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth();
  const db = getFirestore(app);
  const provider = new GoogleAuthProvider();

  const JAMES_EMAIL = "jamesucribanco333@gmail.com";
  let userActual = null;
  let cursoAct = ""; let subAct = ""; let semAct = 0;

  const TEMARIOS = {
    "Anatom√≠a General": { "Teor√≠a": ["S1: Generalidades, Hombro y Axila. Brazo y Codo.", "S2: Antebrazo. Mu√±eca y mano.", "S3: Regi√≥n Gl√∫tea y Cadera. Muslo y Rodilla.", "S4: PARCIAL", "S5: Tobillo y Pie. Cuello.", "S6: V√≠sceras del cuello. Cabeza √≥sea.", "S7: M√∫sculos m√≠mica y masticaci√≥n.", "S8: FINAL"] },
    "Morfofisiolog√≠a 1": { "Fisiolog√≠a": ["S1", "S2", "S3", "S4", "S5", "S6", "S7", "S8"], "Histolog√≠a": ["S1", "S2", "S3", "S4", "S5", "S6", "S7", "S8"] },
    "Morfofisiolog√≠a 2": { "Anatom√≠a": ["S1", "S2", "S3", "S4", "S5", "S6", "S7", "S8"], "Embriolog√≠a": ["S1", "S2", "S3", "S4", "S5", "S6", "S7", "S8"] },
    "Bioqu√≠mica": { "Teor√≠a": ["S1", "S2", "S3", "S4", "S5", "S6", "S7", "S8"] },
    "Biolog√≠a": { "Teor√≠a": ["S1", "S2", "S3", "S4", "S5", "S6", "S7", "S8"] }
  };

  window.login = () => signInWithPopup(auth, provider);

  onAuthStateChanged(auth, (user) => {
    if (user) {
      userActual = user;
      document.getElementById('auth-status').innerHTML = `<b>${user.displayName}</b>`;
      renderCursos();
    }
  });

  window.renderCursos = () => {
    const cont = document.getElementById('main-content');
    let html = `<h2>Mis Cursos Especializados</h2><div class="btn-grid">`;
    for (let c in TEMARIOS) {
      html += `<div class="card"><h3>${c}</h3>`;
      for (let s in TEMARIOS[c]) {
        html += `<button class="btn-main" onclick="verSemanas('${c}', '${s}')">Ver ${s}</button> `;
      }
      html += `</div>`;
    }
    cont.innerHTML = html + `</div>`;
  };

  window.verSemanas = (c, s) => {
    cursoAct = c; subAct = s;
    const cont = document.getElementById('main-content');
    let html = `<button onclick="renderCursos()" class="btn-action">‚Üê Volver</button><br><br><h2>${c} - ${s}</h2>`;
    TEMARIOS[c][s].forEach((tema, i) => {
      html += `
        <div class="card" style="display:flex; justify-content:space-between; align-items:center;">
          <div><b>S${i+1}</b>: ${tema}</div>
          <div style="display:flex; gap:10px;">
            <button class="btn-action btn-pdf" onclick="abrirOpcion('pdf', ${i+1})">üìÑ PDF</button>
            <button class="btn-action btn-grab" onclick="abrirOpcion('grabacion', ${i+1})">üé¨ Clase</button>
            <button class="btn-action btn-ban" onclick="abrirOpcion('banqueo', ${i+1})">‚úçÔ∏è Banco</button>
          </div>
        </div>`;
    });
    cont.innerHTML = html;
  };

  window.abrirOpcion = (tipo, sem) => {
    semAct = sem;
    if(userActual.email === JAMES_EMAIL) {
        document.getElementById('james-modal').style.display = 'flex';
        document.getElementById('box-pdf').classList.add('hidden');
        document.getElementById('box-grabacion').classList.add('hidden');
        document.getElementById('box-banqueo').classList.add('hidden');
        document.getElementById('box-' + tipo).classList.remove('hidden');
    } else {
        alert("Buscando material de la Semana " + sem + "...");
    }
  };

  window.cerrarModal = () => { document.getElementById('james-modal').style.display = 'none'; };
  
  window.ejecutarGuardarLink = async () => {
    const link = document.getElementById('input-link-grabacion').value;
    alert("Guardando link: " + link);
    cerrarModal();
  };
</script>
</body>
</html>
