<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Neurova P53 - Plataforma M√©dica</title>
  <style>
    :root { --primary: #1e40af; --accent: #3b82f6; --bg: #f8fafc; --white: #ffffff; }
    body { margin:0; font-family:'Segoe UI', Roboto, sans-serif; background: var(--bg); color: #1e293b; line-height: 1.5; }
    header { background: var(--white); border-bottom: 2px solid #e2e8f0; padding: 15px 30px; display: flex; align-items: center; justify-content: space-between; position: sticky; top:0; z-index: 1000; }
    .logo-container { display: flex; align-items: center; gap: 12px; }
    .logo-circle { width: 35px; height: 35px; background: var(--primary); border-radius: 50%; }
    nav a { margin-left: 20px; text-decoration: none; color: #64748b; font-weight: 600; cursor: pointer; }
    .container { max-width: 1100px; margin: 30px auto; padding: 0 20px; }
    .card { background: var(--white); border-radius: 15px; padding: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 20px; border: 1px solid #f1f5f9; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
    button { background: var(--primary); color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; }
    button:disabled { background: #cbd5e1; cursor: not-allowed; }
    .hidden { display: none; }
    .semana-item { background: white; border-radius: 12px; padding: 20px; margin-bottom: 15px; border-left: 6px solid var(--accent); box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .tema-titulo { font-weight: bold; color: #1e293b; display: block; font-size: 1.1em; }
    .tema-desc { font-size: 0.95em; color: #64748b; display: block; margin-top: 5px; }
    .btn-group { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; }
    .btn-rec { background: #f1f5f9; color: var(--primary); border: 1px solid #e2e8f0; padding: 8px 14px; border-radius: 6px; font-size: 12px; }
    .admin-zone { background: #fff7ed; border: 2px dashed #f97316; padding: 20px; border-radius: 12px; margin-bottom: 30px; }
  </style>
</head>
<body>
<header>
  <div class="logo-container">
    <div class="logo-circle"></div>
    <h1 style="font-size: 20px; margin:0;">NEUROVA <span style="color:var(--accent)">P53</span></h1>
  </div>
  <nav>
    <a onclick="nav('inicio')">Inicio</a>
    <a onclick="nav('cursos-container')">Cursos</a>
    <a id="admin-nav" class="hidden" onclick="nav('admin-panel')">Panel James</a>
  </nav>
</header>

<div id="inicio" class="container">
  <div class="card" style="text-align:center; padding: 60px 20px;">
    <h2>Plataforma de Estudio Neurova</h2>
    <div id="login-area">
      <p>Bienvenido. Por favor, identif√≠cate para continuar.</p>
      <button onclick="login()" style="font-size: 1.1em; padding: 15px 40px;">Entrar con Google</button>
    </div>
    <div id="user-info" class="hidden">
      <h3 id="welcome-msg"></h3>
      <button onclick="logout()" style="background:#ef4444;">Cerrar Sesi√≥n</button>
    </div>
  </div>
</div>

<div id="cursos-container" class="container hidden">
  <h2 style="margin-bottom:20px;">Mis Cursos</h2>
  <div id="lista-cursos" class="grid"></div>
</div>

<div id="submaterias-container" class="container hidden">
  <h2 id="display-curso"></h2>
  <div id="lista-submaterias" class="grid"></div>
  <button onclick="nav('cursos-container')" style="background:#64748b; margin-top:20px;">‚Üê Volver</button>
</div>

<div id="semanas-container" class="container hidden">
  <h2 id="display-submateria"></h2>
  
  <div id="panel-james" class="admin-zone hidden">
    <h4 style="margin:0 0 10px 0;">üõ† Panel de Control (James)</h4>
    <select id="f-sem" style="padding:8px; margin-bottom:10px;">
      <option value="1">Semana 1</option><option value="2">Semana 2</option><option value="3">Semana 3</option><option value="4">Semana 4</option>
      <option value="5">Semana 5</option><option value="6">Semana 6</option><option value="7">Semana 7</option><option value="8">Semana 8</option>
    </select>
    <input type="text" id="f-url" placeholder="Pega el enlace aqu√≠" style="width:50%; padding:8px;">
    <div style="margin-top:10px;">
      <button onclick="upload('pdf')" style="background:#10b981;">Subir PDF</button>
      <button onclick="upload('video')" style="background:#06b6d4;">Subir Grabaci√≥n</button>
      <button onclick="upload('banco')" style="background:#f59e0b;">Subir Banqueo</button>
    </div>
  </div>

  <div id="lista-semanas"></div>
  <button onclick="nav('submaterias-container')" style="background:#64748b; margin-top:20px;">‚Üê Volver</button>
</div>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDAmEVU8J-uk2Yg6bL5n28xbP1771cHGME",
    authDomain: "neurovap53-cdbcf.firebaseapp.com",
    projectId: "neurovap53-cdbcf"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth();
  const db = getFirestore(app);
  const provider = new GoogleAuthProvider();

  const TEMARIOS = {
    "Morfofisiolog√≠a 1": {
      "Fisiolog√≠a": [
        "Semana 1: Membrana celular, receptores y potenciales.",
        "Semana 2: Se√±ales celulares, medio interno y √≥smosis.",
        "Semana 3: Neurotransmisores y contracci√≥n muscular.",
        "Semana 4: Metabolismo √≥seo y Examen Parcial.",
        "Semana 5: Sangre, hematopoyesis y hemograma.",
        "Semana 6: Fisiolog√≠a eritrocitaria y hemostasia.",
        "Semana 7: Sistema inmunol√≥gico e inmunidad.",
        "Semana 8: Respuesta inflamatoria y Examen Final."
      ],
      "Histolog√≠a": [
        "Semana 1: Procesamiento histol√≥gico y organelas.",
        "Semana 2: Tejido √≥seo y osificaci√≥n.",
        "Semana 3: Tejido muscular y tejido nervioso.",
        "Semana 4: Sistema vascular y Examen Parcial.",
        "Semana 5: Epitelios de revestimiento y glandular.",
        "Semana 6: Tejido conectivo y sangu√≠neo.",
        "Semana 7: √ìrganos linfoides.",
        "Semana 8: Sistema tegumentario y Examen Final."
      ]
    },
    "Morfofisiolog√≠a 2": {
      "Anatom√≠a": [
        "Semana 1: Pared tor√°cica, mama y radioanatom√≠a.",
        "Semana 2: Mediastino superior y anterior.",
        "Semana 3: Morfolog√≠a interna cardiaca.",
        "Semana 4: Mediastino posterior y Examen Parcial.",
        "Semana 5: Pulmones y segmentaci√≥n.",
        "Semana 6: Columna vertebral dorsal.",
        "Semana 7: Ri√±√≥n y v√≠as urinarias.",
        "Semana 8: Radioanatom√≠a renal y Examen Final."
      ],
      "Fisiolog√≠a": [
        "Semana 1: Hemodinamia y electrofisiolog√≠a.",
        "Semana 2: EKG y ciclo cardiaco.",
        "Semana 3: Presi√≥n arterial y gasto cardiaco.",
        "Semana 4: Mec√°nica respiratoria y Examen Parcial.",
        "Semana 5: Intercambio gaseoso y transporte.",
        "Semana 6: Estructura renal y filtraci√≥n.",
        "Semana 7: Equilibrio √°cido-base.",
        "Semana 8: Fisiolog√≠a de altura y Examen Final."
      ],
      "Histolog√≠a y Embriolog√≠a": [
        "Semana 1: Embrio-histo del coraz√≥n.",
        "Semana 2: Histolog√≠a vascular.",
        "Semana 3: Integraci√≥n cardiaca.",
        "Semana 4: Patolog√≠a vascular y Examen Parcial.",
        "Semana 5: Embrio-histo respiratorio.",
        "Semana 6: Embrio-histo urinario.",
        "Semana 7: Vejiga y uretra.",
        "Semana 8: Histopatolog√≠a renal y Examen Final."
      ]
    },
    "Bioqu√≠mica": {
      "Teor√≠a": ["Semana 1: Bioelementos", "Semana 2: Prote√≠nas", "Semana 3: Enzimas", "Semana 4: Parcial", "Semana 5: Carbohidratos", "Semana 6: L√≠pidos", "Semana 7: √Åcidos Nucleicos", "Semana 8: Final"],
      "Laboratorio": ["Semana 1: Bioseguridad", "Semana 2: Espectrofotometr√≠a", "Semana 3: Amino√°cidos", "Semana 4: Parcial", "Semana 5: Glucosa", "Semana 6: Colesterol", "Semana 7: Orina", "Semana 8: Final"]
    },
    "Biolog√≠a Celular": {
      "Teor√≠a": ["Semana 1: La C√©lula", "Semana 2: Biomol√©culas", "Semana 3: Membrana", "Semana 4: Parcial", "Semana 5: Citosol", "Semana 6: Organelas", "Semana 7: N√∫cleo", "Semana 8: Final"],
      "Laboratorio": ["Semana 1: Microscopio", "Semana 2: C√©lula", "Semana 3: Transporte", "Semana 4: Parcial", "Semana 5: Mitosis", "Semana 6: Meiosis", "Semana 7: ADN", "Semana 8: Final"]
    }
  };
  let selC = ""; let selS = "";
  const JAMES = "jamesucribanco333@gmail.com";

  window.nav = (id) => {
    ['inicio', 'cursos-container', 'submaterias-container', 'semanas-container'].forEach(s => document.getElementById(s).classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
  };

  function renderCursos() {
    const box = document.getElementById('lista-cursos');
    box.innerHTML = "";
    Object.keys(TEMARIOS).forEach(c => {
      box.innerHTML += `<div class="card"><h3>${c}</h3><button onclick="verSub('${c}')">Entrar</button></div>`;
    });
  }

  window.verSub = (c) => {
    selC = c; document.getElementById('display-curso').innerText = c;
    const box = document.getElementById('lista-submaterias');
    box.innerHTML = "";
    Object.keys(TEMARIOS[c]).forEach(s => {
      box.innerHTML += `<div class="card" style="border-top:5px solid var(--primary)"><h3>${s}</h3><button onclick="verSem('${s}')">Ver 8 Semanas</button></div>`;
    });
    nav('submaterias-container');
  };

  window.verSem = async (sub) => {
    selS = sub; document.getElementById('display-submateria').innerText = `${selC} > ${sub}`;
    const box = document.getElementById('lista-semanas');
    box.innerHTML = ""; // Limpiar
    nav('semanas-container');

    if(auth.currentUser?.email === JAMES) document.getElementById('panel-james').classList.remove('hidden');

    const temas = TEMARIOS[selC][sub];
    temas.forEach((tema, index) => {
      const num = index + 1;
      const div = document.createElement('div');
      div.className = "semana-item";
      div.innerHTML = `
        <span class="tema-titulo">SEMANA ${num}</span>
        <span class="tema-desc">${tema}</span>
        <div class="btn-group" id="links-sem-${num}"><small>Cargando links...</small></div>`;
      box.appendChild(div);
      fetchLinks(num);
    });
  };

  async function fetchLinks(n) {
    const id = `${selC}_${selS}_S${n}`.replace(/ /g, "_");
    const snap = await getDoc(doc(db, "recursos", id));
    const d = snap.exists() ? snap.data() : {};
    const target = document.getElementById(`links-sem-${n}`);
    target.innerHTML = `
      <button class="btn-rec" onclick="openL('${d.pdf}')" ${!d.pdf ? 'disabled' : ''}>üìÑ PDF</button>
      <button class="btn-rec" onclick="openL('${d.video}')" ${!d.video ? 'disabled' : ''}>üé¨ Video</button>
      <button class="btn-rec" onclick="openL('${d.banco}')" ${!d.banco ? 'disabled' : ''}>‚úçÔ∏è Banco</button>`;
  }

  window.openL = (u) => { if(u && u !== "undefined") window.open(u, '_blank'); };
  window.upload = async (tipo) => {
    const s = document.getElementById('f-sem').value;
    const url = document.getElementById('f-url').value;
    if(!url) return alert("Escribe un link primero");
    const id = `${selC}_${selS}_S${s}`.replace(/ /g, "_");
    await setDoc(doc(db, "recursos", id), { [tipo]: url }, { merge: true });
    alert("¬°Semana " + s + " actualizada!");
    fetchLinks(s);
  };

  window.login = () => signInWithPopup(auth, provider);
  window.logout = () => signOut(auth);

  onAuthStateChanged(auth, (user) => {
    if (user) {
      document.getElementById('login-area').classList.add('hidden');
      document.getElementById('user-info').classList.remove('hidden');
      document.getElementById('welcome-msg').innerText = `Hola, ${user.displayName}`;
      renderCursos();
      nav('cursos-container');
    } else {
      document.getElementById('login-area').classList.remove('hidden');
      document.getElementById('user-info').classList.add('hidden');
      nav('inicio');
    }
  });
</script>
</body>
</html>
