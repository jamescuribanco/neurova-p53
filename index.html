<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Neurova P53 - Academia</title>
  <style>
    body { margin:0; font-family:'Segoe UI', sans-serif; background:#f0f4f8; color:#333; }
    header { background: linear-gradient(135deg, #1e3a8a, #2563eb); color: white; padding: 15px 40px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    nav a { color: white; margin-left: 20px; text-decoration: none; font-weight: bold; cursor: pointer; }
    .container { max-width: 1100px; margin: 30px auto; padding: 0 20px; }
    .card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px; text-align: center; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
    button { background: #2563eb; color: white; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; transition: 0.3s; font-weight: 600; }
    button:hover { background: #1d4ed8; }
    .btn-admin { background: #10b981; margin-top: 10px; }
    .hidden { display: none; }
    .semana-row { display: flex; align-items: center; justify-content: space-between; padding: 15px; border-bottom: 1px solid #eee; background: white; margin-bottom: 5px; border-radius: 8px; }
    .recursos-btns button { margin-left: 5px; font-size: 12px; background: #64748b; }
    .admin-upload-panel { background: #fef3c7; border: 1px solid #f59e0b; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
  </style>
</head>
<body>

<header>
  <div style="display:flex; align-items:center;">
    <img src="logo.jpeg" alt="Logo" style="height:50px; border-radius:50%; margin-right:10px;">
    <h1>Neurova P53</h1>
  </div>
  <nav>
    <a onclick="navegar('inicio')">Inicio</a>
    <a onclick="navegar('cursos-container')">Cursos</a>
    <a id="admin-nav" class="hidden" onclick="navegar('admin-panel')">Panel Admin</a>
  </nav>
</header>
<div id="inicio" class="container">
  <div class="card">
    <h2>Bienvenido Estudiante</h2>
    <div id="login-section">
      <button id="login-btn">Iniciar Sesión con Google</button>
    </div>
    <div id="user-info" class="hidden">
      <p id="user-name"></p>
      <button onclick="logout()" style="background:#dc2626;">Cerrar Sesión</button>
    </div>
  </div>
</div>

<div id="cursos-container" class="container hidden">
  <h2>Nuestros Cursos</h2>
  <div id="lista-cursos" class="grid"></div>
</div>

<div id="submaterias-container" class="container hidden">
  <h2 id="txt-curso-parent"></h2>
  <div id="lista-submaterias" class="grid"></div>
  <button onclick="navegar('cursos-container')" style="background:#64748b; margin-top:20px;">← Volver</button>
</div>

<div id="semanas-container" class="container hidden">
  <h2 id="txt-submateria-parent"></h2>
  
  <div id="admin-upload-area" class="admin-upload-panel hidden">
    <h3>Modo Administrador: Subir Recursos</h3>
    <small>Selecciona semana y pega el link:</small><br>
    <select id="sel-semana"><option value="1">Semana 1</option><option value="2">Semana 2</option><option value="3">Semana 3</option><option value="4">Semana 4</option><option value="5">Semana 5</option><option value="6">Semana 6</option><option value="7">Semana 7</option><option value="8">Semana 8</option></select>
    <input type="text" id="link-url" placeholder="URL del archivo/video">
    <button onclick="guardarRecurso('pdf')" class="btn-admin">Subir PDF</button>
    <button onclick="guardarRecurso('video')" class="btn-admin">Subir Grabación</button>
  </div>

  <div id="lista-semanas"></div>
  <button onclick="navegar('submaterias-container')" style="background:#64748b; margin-top:20px;">← Volver</button>
</div>

<div id="admin-panel" class="container hidden">
  <div class="card">
    <h2>Resultados de Usuarios</h2>
    <div id="resultados-admin"></div>
  </div>
</div>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDAmEVU8J-uk2Yg6bL5n28xbP1771cHGME",
    authDomain: "neurovap53-cdbcf.firebaseapp.com",
    projectId: "neurovap53-cdbcf"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth();
  const db = getFirestore(app);
  const provider = new GoogleAuthProvider();

  // --- CONFIGURACIÓN DE CURSOS ---
  const DATA_ACADEMIA = {
    "Morfofisiología 1": ["Fisiología", "Histología"],
    "Morfofisiología 2": ["Fisiología", "Histología"],
    "Anatomía General": ["Anatomía"],
    "Bioquímica": ["Bioquímica"],
    "Biología Celular y Molecular": ["Biología Celular"]
  };

  let cursoActivo = "";
  let submateriaActiva = "";
  const ADMIN_EMAIL = "jamesucribanco333@gmail.com";

  window.navegar = (id) => {
    ['inicio', 'cursos-container', 'submaterias-container', 'semanas-container', 'admin-panel'].forEach(s => {
      document.getElementById(s).classList.add('hidden');
    });
    document.getElementById(id).classList.remove('hidden');
  };

  // 1. Mostrar Cursos
  function renderCursos() {
    const cont = document.getElementById('lista-cursos');
    cont.innerHTML = "";
    Object.keys(DATA_ACADEMIA).forEach(c => {
      cont.innerHTML += `<div class="card"><h3>${c}</h3><button onclick="verSubmaterias('${c}')">Entrar</button></div>`;
    });
  }

  // 2. Mostrar Submaterias (Fisio/Histo)
  window.verSubmaterias = (curso) => {
    cursoActivo = curso;
    document.getElementById('txt-curso-parent').innerText = curso;
    const cont = document.getElementById('lista-submaterias');
    cont.innerHTML = "";
    DATA_ACADEMIA[curso].forEach(sub => {
      cont.innerHTML += `<div class="card" style="border-top:5px solid #2563eb"><h3>${sub}</h3><button onclick="verSemanas('${sub}')">Ver 8 Semanas</button></div>`;
    });
    navegar('submaterias-container');
  };

  // 3. Mostrar las 8 semanas
  window.verSemanas = async (sub) => {
    submateriaActiva = sub;
    document.getElementById('txt-submateria-parent').innerText = `${cursoActivo} > ${sub}`;
    const cont = document.getElementById('lista-semanas');
    cont.innerHTML = "Cargando semanas...";
    navegar('semanas-container');

    // Revisar si James está logueado para mostrar panel de subida
    if(auth.currentUser?.email === ADMIN_EMAIL) {
      document.getElementById('admin-upload-area').classList.remove('hidden');
    }

    let html = "";
    for(let i=1; i<=8; i++) {
      // Intentar traer links de Firebase
      const docRef = doc(db, "recursos", `${cursoActivo}_${sub}_S${i}`);
      const docSnap = await getDoc(docRef);
      const data = docSnap.exists() ? docSnap.data() : {};

      html += `
        <div class="semana-row">
          <span><strong>Semana ${i}</strong></span>
          <div class="recursos-btns">
            <button onclick="window.open('${data.pdf || '#'}')">PDF</button>
            <button onclick="window.open('${data.video || '#'}')">Grabación</button>
            <button onclick="alert('Próximamente banqueo')">Banqueo</button>
          </div>
        </div>`;
    }
    cont.innerHTML = html;
  };

  // 4. Guardar links (Solo James)
  window.guardarRecurso = async (tipo) => {
    const sem = document.getElementById('sel-semana').value;
    const url = document.getElementById('link-url').value;
    if(!url) return alert("Pega un link primero");

    const idDoc = `${cursoActivo}_${submateriaActiva}_S${sem}`;
    await setDoc(doc(db, "recursos", idDoc), { [tipo]: url }, { merge: true });
    alert("¡Guardado! Recarga la sección para ver los cambios.");
  };

  // --- AUTH ---
  document.getElementById('login-btn').onclick = () => signInWithPopup(auth, provider);
  window.logout = () => signOut(auth);

  onAuthStateChanged(auth, (user) => {
    if (user) {
      document.getElementById('login-section').classList.add('hidden');
      document.getElementById('user-info').classList.remove('hidden');
      document.getElementById('user-name').innerText = `Hola, ${user.displayName}`;
      if(user.email === ADMIN_EMAIL) document.getElementById('admin-nav').classList.remove('hidden');
      renderCursos();
      navegar('cursos-container');
    } else {
      document.getElementById('login-section').classList.remove('hidden');
      document.getElementById('user-info').classList.add('hidden');
      document.getElementById('admin-nav').classList.add('hidden');
      navegar('inicio');
    }
  });
</script>
</body>
</html>
